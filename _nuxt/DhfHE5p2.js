const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DAdsJkXC.js","./Dy8pk1Vq.js","./entry.BB4FY8V8.css","./Lightbox.DUZZNB3u.css"])))=>i.map(i=>d[i]);
import{z as w,A as M,B as ae,C as ce,D as ue,E as de,G as he,y as pe,H as me,I as fe,J as _e,r as q,K as se,L as W,M as ge,d as p,e as h,h as n,f as B,g as x,N as ve,O as ye,P as be,Q as u,R as xe,n as G,S as Y,U as $e,F as O,V as R,t as $,W as ke,X as we,Y as Ee,Z as Ce,$ as Me,b as Ie,_ as Se}from"./Dy8pk1Vq.js";import{t as ze}from"./BJqtdQVK.js";import{h as L}from"./CaXNj9xS.js";import"./CYIRVW0k.js";function ne(_,a,i){const[l={},d]=typeof a=="string"?[{},a]:[a,i],c=w(()=>M(_)),r=w(()=>M(l.key)||"$f"+L([d,typeof c.value=="string"?c.value:"",...Te(l)]));if(!l.baseURL&&typeof c.value=="string"&&c.value[0]==="/"&&c.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:v,lazy:E,default:I,transform:T,pick:S,watch:z,immediate:m,getCachedData:b,deep:D,dedupe:N,timeout:F,...J}=l,k=ae({...ce,...J,cache:typeof l.cache=="boolean"?void 0:l.cache}),K={server:v,lazy:E,default:I,transform:T,pick:S,immediate:m,getCachedData:b,deep:D,dedupe:N,timeout:F,watch:z===!1?[]:[...z||[],k]};return ue(z===!1?r.value:r,(H,{signal:P})=>(l.$fetch||globalThis.$fetch)(c.value,{signal:P,...k}),K)}function Te(_){const a=[M(_.method)?.toUpperCase()||"GET",M(_.baseURL)];for(const i of[_.query||_.params]){const l=M(i);if(!l)continue;const d={};for(const[c,r]of Object.entries(l))d[M(c)]=M(r);a.push(d)}if(_.body){const i=M(_.body);if(!i)a.push(L(i));else if(i instanceof ArrayBuffer)a.push(L(Object.fromEntries([...new Uint8Array(i).entries()].map(([l,d])=>[l,d.toString()]))));else if(i instanceof FormData){const l={};for(const d of i.entries()){const[c,r]=d;l[c]=r instanceof File?r.name:r}a.push(L(l))}else if(de(i))a.push(L(ae(i)));else try{a.push(L(i))}catch{console.warn("[useFetch] Failed to hash body",i)}}return a}function Be(_){const a=_.split(`
`),i=[];let l=!1,d="",c=[],r=0;for(;r<a.length;){const v=a[r];if(v.trimStart().match(/^```/)){if(l){const m=c.join(`
`);i.push(`<pre><code${d?` class="language-${d}"`:""}>${V(m)}</code></pre>`),l=!1,c=[],d=""}else{l=!0;const m=v.trimStart().match(/^```(.*)$/);d=m?m[1].trim():"",c=[]}r++;continue}if(l){c.push(v),r++;continue}if(!v.trim()){r++;continue}const E=v.trimStart().match(/^(#{1,6}) (.+)$/);if(E){const m=E[1].length,b=E[2],D=A(b);i.push(`<h${m}>${D}</h${m}>`),r++;continue}const I=v.trimStart().match(/^> (.+)$/);if(I){const m=I[1],b=A(m);i.push(`<blockquote>${b}</blockquote>`),r++;continue}const T=v.trimStart().match(/^[*\-] (.+)$/);if(T){const m=T[1],b=A(m);i.push(`<ul><li>${b}</li></ul>`),r++;continue}const S=v.trimStart().match(/^\d+\. (.+)$/);if(S){const m=S[1],b=A(m);i.push(`<ol><li>${b}</li></ol>`),r++;continue}const z=A(v);i.push(`<p>${z}</p>`),r++}if(l&&c.length>0){const v=c.join(`
`);i.push(`<pre><code${d?` class="language-${d}"`:""}>${V(v)}</code></pre>`)}return i.join("")}function A(_){let a=_;const i=[],l="\0CODE";return a=a.replace(/`([^`]+)`/g,d=>{const c=i.length;return i.push(`<code>${V(d.slice(1,-1))}</code>`),`${l}${c}${l}`}),a=a.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(d,c,r)=>`<a href="${V(r)}" target="_blank" rel="noopener noreferrer">${c}</a>`),a=a.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),a=a.replace(/~~([^~]+)~~/g,"<del>$1</del>"),a=a.replace(/\*([^*\n]+)\*/g,"<em>$1</em>"),a=a.replace(/_([^_\n]+)_/g,"<em>$1</em>"),i.forEach((d,c)=>{a=a.replace(`${l}${c}${l}`,d)}),a}function V(_){const a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return _.replace(/[&<>"']/g,i=>a[i]||i)}const Le=Me(()=>Ie(()=>import("./DAdsJkXC.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(_=>_.default||_)),De={class:"echo-container"},Ne={class:"echo-toolbar"},Pe={class:"echo-search"},Ue=["disabled","title"],We=["href"],Oe={key:0,class:"echo-heatmap-section"},Re={class:"heatmap-header"},Ae={class:"heatmap-title"},Fe={class:"heatmap-content"},He={class:"heatmap-left"},je=["title"],qe={class:"heatmap-legend"},Ge={class:"legend-cells"},Ve={class:"heatmap-stats"},Je={class:"stat-item"},Ke={class:"stat-value"},Qe={class:"stat-item"},Xe={class:"stat-value"},Ye={class:"stat-item"},Ze={class:"stat-value"},et={key:1,class:"echo-loading"},tt={key:2,class:"echo-empty"},st={key:3,class:"echo-empty"},nt={key:4,class:"echo-list"},at=["innerHTML"],ot={key:1,class:"echo-extension"},it={class:"extension-label"},lt={class:"extension-type-text"},rt=["href"],ct={class:"website-content"},ut={class:"website-title"},dt={class:"website-url"},ht=["href"],pt={class:"extension-url"},mt={key:2,class:"echo-images"},ft=["onClick"],_t={class:"echo-card-footer"},gt={class:"echo-footer-info"},vt={class:"echo-time-tag"},yt={class:"echo-tags-likes-tag"},bt=["href","title"],xt={class:"tag-item"},$t=["href"],kt={key:5,class:"echo-load-more"},wt=["disabled"],Et=10,Ct=he({__name:"echo",async setup(_){let a,i;const l=pe(),d=me(),c=fe();d.setAside(["blog-stats","blog-log"]),_e({title:"动态",meta:[{property:"og:type",content:"website"},{name:"description",content:`${l?.author?.name||"用户"} 的动态分享，记录最新的想法、观点和日常动态。`},{name:"keywords",content:"动态,分享,想法,日记,思考"}]});const r=q(""),v=q(1),{data:E,pending:I,refresh:T}=([a,i]=se(()=>ne(`${W.echo.apiBase}${W.echo.apiEndpoint}?page=1&pageSize=100`,{watch:!1,default:()=>({data:{items:[]}})},"$h5c9zGxgMR")),a=await a,i(),a),{data:S,pending:z}=([a,i]=se(()=>ne(`${W.echo.apiBase}/api/heatmap`,{watch:!1,default:()=>({code:0,msg:"",data:[]})},"$cewwBWa4WN")),a=await a,i(),a),m=w(()=>{const s=E.value?.data?.items;return s?.length?s.filter(e=>!e.private).sort((e,o)=>{try{const f=new Date(e.created_at),g=new Date(o.created_at);return Number.isNaN(f.getTime())||Number.isNaN(g.getTime())?0:g.getTime()-f.getTime()}catch(f){return console.error(`Invalid date comparison: ${e.created_at}, ${o.created_at}`,f),0}}):[]}),b=q(!1);async function D(){if(!b.value){b.value=!0;try{v.value=1,r.value="",await T()}catch(s){console.error("Failed to refresh echos:",s)}finally{b.value=!1}}}const N=w(()=>{const s=r.value.trim().toLowerCase();return s?m.value.filter(e=>{if(!e)return!1;const o=e.content?.toLowerCase()||"",f=e.username?.toLowerCase()||"";return o.includes(s)||f.includes(s)}):m.value}),F=w(()=>{const s=v.value*Et;return N.value.slice(0,s)}),J=w(()=>F.value.length<N.value.length),k=q(!1);async function K(){k.value||(k.value=!0,await new Promise(s=>setTimeout(s,300)),v.value++,k.value=!1)}const Z={GITHUBPROJ:{label:"GitHub 项目",icon:"mdi:github"},GITHUB:{label:"GitHub",icon:"mdi:github"},MUSIC:{label:"音乐",icon:"mdi:music"},WEBSITE:{label:"网站",icon:"mdi:globe"},LINK:{label:"链接",icon:"mdi:link"}},H=s=>Z[s]||{label:s,icon:"mdi:link"},P=new Map;function ee(s){if(!s||typeof s!="string")return{title:"无效链接",site:"#",hostname:"无效链接"};if(P.has(s))return P.get(s);let e;try{const o=JSON.parse(s);if(!o||typeof o!="object")throw new Error("Invalid data structure");let f="",g=o.site||"";if(g)try{const t=new URL(g);if(t.protocol!=="http:"&&t.protocol!=="https:")throw new Error("Invalid protocol");f=t.hostname}catch{g="#",f="无效链接"}e={title:(o.title||"").toString().trim()||"无标题",site:g,hostname:f}}catch{e={title:"解析失败",site:"#",hostname:"解析失败"}}return P.set(s,e),e}const{parseMusicExtension:oe}=ge(),te=w(()=>F.value.map(s=>({...s,parsedWebsiteExtension:s.extension&&s.extension_type==="WEBSITE"?ee(s.extension):null,parsedMusicExtension:s.extension&&s.extension_type==="MUSIC"&&W.meting?.enabled?oe(s.extension):null})));function ie(s,e,o){try{const f=s.currentTarget||null;let g=null,t=[],y=0;if(o){const C=te.value.find(U=>U.id===o);C&&C.images?.length&&(t=C.images.map(U=>U.image_url),e&&(y=t.findIndex(U=>U===e),y===-1&&(y=0)))}if(f&&(g=f.querySelector("img")),!g&&e){if(!e.trim()||!e.startsWith("http://")&&!e.startsWith("https://")){console.warn("Invalid image source:",e);return}const C=new Image;C.src=e,g=C}if(!g){console.warn("No valid image element found for lightbox");return}const{open:j}=c.use(()=>Ce(Le,{el:g,images:t.length>0?t:void 0,currentIndex:t.length>0?y:void 0}));j()}catch(f){console.error("Failed to open image lightbox:",f)}}function le(s,e){if(s===0||e===0)return 0;const o=Math.ceil(s/e*4);return Math.min(o,4)}const Q=w(()=>{const s=S.value?.data||[];if(s.length===0)return[];const e=Math.max(...s.map(o=>o.count),1);return s.map(o=>({date:o.date,count:o.count,level:le(o.count,e)}))}),re=w(()=>Q.value.length>=30?{rows:2,cols:15}:{rows:3,cols:10}),X=w(()=>{const s=S.value?.data||[],e=E.value?.data?.total??0;if(s.length===0)return{total:e,average:0,maxCount:0,maxDate:""};const o=s.reduce((t,y)=>t+y.count,0),f=Math.round(o/30),g=s.reduce((t,y)=>y.count>t.count?y:t);return{total:e,average:f,maxCount:g.count,maxDate:g.date}});return(s,e)=>{const o=ye,f=we,g=Ee;return h(),p("div",De,[n("div",Ne,[n("div",Pe,[x(o,{name:"mdi:magnify",size:"20",class:"search-icon"}),ve(n("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>xe(r)?r.value=t:null),type:"text",placeholder:"搜索动态...",class:"search-input"},null,512),[[be,u(r)]])]),n("button",{disabled:u(b)||u(I),class:"echo-refresh-btn",title:u(b)?"刷新中...":"手动刷新动态",onClick:D},[x(o,{name:"mdi:refresh",size:"18",class:G({spin:u(b)})},null,8,["class"])],8,Ue),n("a",{href:u(W).echo.rss,target:"_blank",rel:"noopener noreferrer",class:"echo-rss-btn",title:"订阅动态 RSS 源"},[x(o,{name:"mdi:rss",size:"18"})],8,We)]),!u(z)&&u(Q).length>0?(h(),p("div",Oe,[n("div",Re,[n("h3",Ae,[x(o,{name:"mdi:fire",size:"20"}),e[1]||(e[1]=Y(" 热力图 ",-1))])]),n("div",Fe,[n("div",He,[n("div",{class:"heatmap-grid",style:$e({gridTemplateColumns:`repeat(${u(re).cols}, 1fr)`})},[(h(!0),p(O,null,R(u(Q),t=>(h(),p("div",{key:t.date,class:G(["heatmap-cell",[`heatmap-level-${t.level}`]]),title:`${t.date}: ${t.count} 条动态`},null,10,je))),128))],4),n("div",qe,[e[2]||(e[2]=n("span",{class:"legend-label"},"少",-1)),n("div",Ge,[(h(),p(O,null,R(5,t=>n("div",{key:t,class:G(["legend-cell",[`heatmap-level-${t-1}`]])},null,2)),64))]),e[3]||(e[3]=n("span",{class:"legend-label"},"多",-1))])]),n("div",Ve,[n("div",Je,[e[4]||(e[4]=n("span",{class:"stat-label"},"总动态数",-1)),n("span",Ke,$(u(X).total),1)]),n("div",Qe,[e[5]||(e[5]=n("span",{class:"stat-label"},"日均动态",-1)),n("span",Xe,$(u(X).average),1)]),n("div",Ye,[e[6]||(e[6]=n("span",{class:"stat-label"},"单日最多",-1)),n("span",Ze,$(u(X).maxCount),1)])])])])):B("",!0),u(I)?(h(),p("div",et,[x(o,{name:"eos-icons:loading",size:"32"}),e[7]||(e[7]=n("p",null,"加载中...",-1))])):u(m).length===0?(h(),p("div",tt,[x(o,{name:"solar:inbox-line-duotone",size:"48"}),e[8]||(e[8]=n("p",null,"暂无动态",-1))])):u(N).length===0?(h(),p("div",st,[x(o,{name:"solar:magnifer-line-duotone",size:"48"}),e[9]||(e[9]=n("p",null,"未找到匹配的动态",-1))])):(h(),p("div",nt,[(h(!0),p(O,null,R(u(te),t=>(h(),p("article",{key:t.id,class:"echo-card card"},[t.content?(h(),p("div",{key:0,class:"echo-content-text",innerHTML:u(Be)(t.content)},null,8,at)):B("",!0),t.extension&&t.extension_type?(h(),p("div",ot,[n("div",it,[e[10]||(e[10]=Y(" 分享了 ",-1)),n("span",lt,$(H(t.extension_type).label),1)]),t.extension_type==="WEBSITE"&&t.parsedWebsiteExtension?(h(),p("a",{key:0,href:t.parsedWebsiteExtension.site,target:"_blank",rel:"noopener noreferrer",class:"extension-link website-link"},[x(o,{name:H(t.extension_type).icon,size:"20"},null,8,["name"]),n("div",ct,[n("div",ut,$(t.parsedWebsiteExtension.title),1),n("div",dt,$(t.parsedWebsiteExtension.hostname),1)]),x(o,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,rt)):t.extension_type==="MUSIC"&&t.parsedMusicExtension?(h(),ke(f,{key:1,music:t.parsedMusicExtension},null,8,["music"])):(h(),p("a",{key:2,href:t.extension,target:"_blank",rel:"noopener noreferrer",class:"extension-link"},[x(o,{name:H(t.extension_type).icon,size:"20"},null,8,["name"]),n("span",pt,$(t.extension),1),x(o,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,ht))])):B("",!0),t.images?.length?(h(),p("div",mt,[(h(!0),p(O,null,R(t.images,(y,j)=>(h(),p("button",{key:j,class:"echo-image-button",onClick:C=>ie(C,y.image_url,t.id)},[x(g,{src:y.image_url,alt:`Echo image ${j+1}`,class:"echo-image",loading:"lazy",fit:"cover"},null,8,["src","alt"])],8,ft))),128))])):B("",!0),n("div",_t,[n("div",gt,[n("div",vt,[x(o,{name:"ph:calendar-dots-bold",size:"12"}),n("span",null,$(u(ze)(t.created_at)),1)]),n("div",yt,[t.tags?.length?(h(!0),p(O,{key:0},R(t.tags,y=>(h(),p("span",{key:y.id,class:"tag-item"},[n("a",{href:`https://echo.sotkg.com/?tag=${encodeURIComponent(y.name)}`,target:"_blank",rel:"noopener noreferrer",class:"tag-link",title:`使用数: ${y.usage_count}`}," #"+$(y.name),9,bt)]))),128)):B("",!0),n("span",xt,[x(o,{name:"mdi:heart",size:"12"}),Y(" "+$(t.fav_count),1)])])]),n("a",{href:`https://echo.sotkg.com/echo/${t.id}`,target:"_blank",class:"echo-read-more-tag"}," 查看原文 → ",8,$t)])]))),128))])),u(J)?(h(),p("div",kt,[n("button",{class:"load-more-btn",disabled:u(k),onClick:K},[x(o,{name:u(k)?"eos-icons:loading":"mdi:chevron-down",size:"20",class:G({spin:u(k)})},null,8,["name","class"]),n("span",null,$(u(k)?"装填中...":"继续装填"),1)],8,wt)])):B("",!0)])}}}),Tt=Se(Ct,[["__scopeId","data-v-46ed57dc"]]);export{Tt as default};
