import{bi as nt,z as q,D as at,r as H,bj as it,y as h,ae as Y,d as w,e as m,g as p,w as L,f as x,T as N,U as ot,V as st,aU as lt,O as d,h as C,t as P,M as ct,bk as rt,_ as ut}from"./BCEXwt-N.js";function ht(a){return a instanceof Element?a.getBoundingClientRect():a}const I=a=>typeof a=="number"?`${a}px`:a;function X(a,B,o){const g=nt(B).map(s=>ht(q(s)));return q(a).animate(g.map(s=>({left:I(s.left),top:I(s.top),width:I(s.width),height:I(s.height)})),{duration:100,fill:"forwards",...o})}const dt={class:"z-lightbox"},gt={key:0,class:"tooltip"},ft={key:0,class:"caption"},vt={key:1,class:"image-controls"},mt=["disabled","title"],pt={class:"image-counter"},bt=["disabled","title"],F=.8,wt=at({__name:"Lightbox",props:{el:{},caption:{},show:{type:Boolean},images:{},currentIndex:{}},emits:["close","navigate"],setup(a,{emit:B}){const o=a,g=B,s=o.el.getBoundingClientRect(),T=H(),y=it(T),{width:M,height:R}=rt(),c=H(o.currentIndex??0),k=h(()=>o.images||[]),J=h(()=>k.value.length>1),K=h(()=>k.value[c.value]||o.el.src),W=h(()=>c.value>0),$=h(()=>c.value<k.value.length-1);function j(){W.value&&(c.value--,g("navigate",c.value))}function O(){$.value&&(c.value++,g("navigate",c.value))}let b,E,V;const f=H({}),D=h(()=>Object.values(f.value).slice(0,2)),_=h(()=>G("current")),Q=h(()=>U("current"));function S(t,e,n){if(n<1)return t<Math.min(M.value,s.width,o.el.naturalWidth)&&e<Math.min(R.value,s.height,o.el.naturalHeight);if(n>1)return t>Math.max(M.value,s.width,o.el.naturalWidth)&&e>Math.max(R.value,s.height,o.el.naturalHeight)}function Z(t){const{left:e,top:n,width:i,height:l}=y.value.getBoundingClientRect();if(S(i,l,1-t.deltaY))return;const r=Math.abs(t.deltaY)<8?Math.abs(t.deltaY)*.05:.5,u=t.deltaY>0?1/(1+r):1+r;X(y,{left:e-(t.clientX-e)*(u-1),top:n-(t.clientY-n)*(u-1),width:i*u,height:l*u})}function A(){for(const t of Object.values(f.value))t.startX=t.currentX,t.startY=t.currentY;b=y.value.getBoundingClientRect(),E=G("start"),V=U("start")}function G(t){const e=D.value;return{x:e.reduce((n,i)=>n+i[`${t}X`],0)/e.length,y:e.reduce((n,i)=>n+i[`${t}Y`],0)/e.length}}function U(t){const[e,n]=D.value;return!e||!n?0:Math.hypot(e[`${t}X`]-n[`${t}X`],e[`${t}Y`]-n[`${t}Y`])}Y("pointerdown",t=>{f.value[t.pointerId]={startX:t.clientX,startY:t.clientY,currentX:t.clientX,currentY:t.clientY},A()}),Y("pointermove",t=>{const e=f.value[t.pointerId];if(!e)return;e.currentX=t.clientX,e.currentY=t.clientY;const n=Q.value/V||1,i=b.width*n,l=b.height*n;if(S(i,l,n))return;const v=b.left+_.value.x-E.x,r=b.top+_.value.y-E.y,u=v-(_.value.x-v)*(n-1),z=r-(_.value.y-r)*(n-1);X(y,{left:u,top:z,width:i,height:l},{duration:0})}),Y("pointerup",t=>{delete f.value[t.pointerId],Object.keys(f.value).length&&A()});function tt(t,e){const n=window.innerWidth*F,i=window.innerHeight*F,l=o.el.naturalWidth/o.el.naturalHeight,[v,r]=n/i>l?[i*l,i]:[n,n/l],u=(M.value-v)/2,z=(R.value-r)/2;X(t,[s,{left:u,top:z,width:v,height:r}]).onfinish=e}function et(t,e){X(t,o.el).onfinish=e}return Y("keydown",t=>{t.key==="Escape"?g("close"):t.key==="ArrowLeft"?j():t.key==="ArrowRight"&&O()}),(t,e)=>{const n=st,i=ct;return m(),w("div",dt,[p(N,null,{default:L(()=>[a.show?(m(),w("div",{key:0,id:"z-lightbox-bgmask",onClick:e[0]||(e[0]=l=>g("close"))})):x("",!0)]),_:1}),p(N,{onEnter:tt,onLeave:et},{default:L(()=>[a.show?(m(),ot(n,{key:0,ref_key:"lightbox",ref:T,class:"image",alt:a.el.alt,width:a.el.width,height:a.el.height,src:d(K),draggable:"false",onWheel:lt(Z,["prevent"])},null,8,["alt","width","height","src"])):x("",!0)]),_:1}),p(N,null,{default:L(()=>[a.show?(m(),w("div",gt,[a.caption?(m(),w("span",ft,P(a.caption),1)):x("",!0),d(J)?(m(),w("div",vt,[C("button",{class:"nav-button",disabled:!d(W),title:d(W)?"上一张 (←)":"没有上一张了",onClick:j},[p(i,{name:"ph:caret-left-bold",size:"16"})],8,mt),C("div",pt,P(d(c)+1)+" / "+P(d(k).length),1),C("button",{class:"nav-button",disabled:!d($),title:d($)?"下一张 (→)":"没有下一张了",onClick:O},[p(i,{name:"ph:caret-right-bold",size:"16"})],8,bt)])):x("",!0),C("button",{class:"close","aria-label":"关闭灯箱",onClick:e[1]||(e[1]=l=>g("close"))},[p(i,{name:"ph:x-bold"})])])):x("",!0)]),_:1})])}}}),yt=Object.assign(ut(wt,[["__scopeId","data-v-0e017d4d"]]),{__name:"PopoverLightbox"});export{yt as default};
