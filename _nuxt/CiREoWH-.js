const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CN60iLGL.js","./Dr9yELMz.js","./entry.aXXMqmcI.css","./Lightbox.CBHK7Kjn.css"])))=>i.map(i=>d[i]);
import{ae as M,aj as b,d as L,B as K,a5 as C,al as X,am as $,o as S,an as p,N as T,ao as A,$ as I,k as N,h as q,j as f,i as w,y,q as O,a9 as P,z}from"#entry";const B=M(()=>b(()=>import("./CN60iLGL.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(l=>l.default||l.default||l)),j={class:"z-comment"},V={class:"text-creative"},D={id:"artalk"},R={class:"loading-box"},H=L({__name:"Comment",setup(l){const m=K(),u=C(),h=X(),g=A.getInstance(),E=$();function x(){return new Promise((e,n)=>{if(typeof window<"u"&&window.katex){e(window.katex);return}const o=document.querySelector('script[src*="katex"]');if(o){o.addEventListener("load",()=>e(window.katex)),o.addEventListener("error",()=>{console.warn("[KaTeX] 加载失败"),n(new Error("KaTeX 加载失败"))});return}const t=document.createElement("script");t.src="https://lib.baomitu.com/KaTeX/0.16.9/katex.min.js",t.onload=()=>{console.debug("[KaTeX] 加载成功"),e(window.katex)},t.onerror=()=>{console.warn("[KaTeX] 加载失败"),n(new Error("KaTeX 脚本加载失败"))},document.head.appendChild(t)})}async function d(){try{await x();const e=typeof window<"u"?window.katex:void 0;if(!e){console.warn("[KaTeX] 未检测到 KaTeX 实例，稍后重试"),setTimeout(()=>d(),1e3);return}document.querySelectorAll("#artalk .atk-content:not(.math-processed)").forEach(o=>{o.classList.add("math-processed");let t=o.innerHTML;const c=t;t=t.replace(/\$\$([^$]+)\$\$/g,(a,r)=>{try{return`<span class="math-display">${e.renderToString(r.trim(),{displayMode:!0})}</span>`}catch(i){return console.warn("KaTeX display render error:",i),a}}),t=t.replace(/\$([^$\n]+)\$/g,(a,r)=>{if(a.includes('<span class="math-'))return a;try{return`<span class="math-inline">${e.renderToString(r.trim(),{displayMode:!1})}</span>`}catch(i){return console.warn("KaTeX inline render error:",i),a}}),t=t.replace(/```math\s*([\s\S]*?)```/g,(a,r)=>{try{return`<div class="math-block">${e.renderToString(r.trim(),{displayMode:!0})}</div>`}catch(i){return console.warn("KaTeX math block render error:",i),a}}),t!==c&&(o.innerHTML=t)})}catch(e){console.error("Failed to load KaTeX:",e),setTimeout(()=>d(),1e3)}}function k(){document.querySelectorAll("#artalk .atk-content img").forEach(n=>{const o=n;o.style.cursor!=="zoom-in"&&(o.style.cursor="zoom-in",o.addEventListener("click",()=>{const{open:t}=E.use(()=>P(B,{el:o}));t()}))})}let s=null;function v(){const e=document.getElementById("artalk");e&&(s&&s.disconnect(),s=new MutationObserver(n=>{let o=!1,t=!1;n.forEach(c=>{c.type==="childList"&&c.addedNodes.length>0&&c.addedNodes.forEach(a=>{if(a.nodeType===Node.ELEMENT_NODE){const r=a;(r.tagName==="IMG"||r.querySelector("img"))&&(o=!0),(r.classList?.contains("atk-content")||r.querySelector(".atk-content"))&&(t=!0)}})}),o&&setTimeout(()=>k(),100),t&&setTimeout(()=>d(),500)}),s.observe(e,{childList:!0,subtree:!0}))}async function _(){try{console.debug("[Artalk] 开始初始化...",{path:u.path}),await g.init({el:"#artalk",pageKey:u.path,pageTitle:document.title.replace(` | ${m.title}`,""),server:m.artalk?.server,site:m.artalk?.site,emoticons:"/assets/Owo-Artalk.json",darkMode:h.value==="dark"}),console.debug("[Artalk] 初始化完成"),await p(()=>{setTimeout(()=>{k(),setTimeout(()=>d(),1e3),v()},500)})}catch(e){console.error("[Artalk] 初始化失败:",e instanceof Error?e.message:e)}}return S(()=>{p(()=>{setTimeout(_,100)})}),T(()=>u.path,()=>{p(()=>{setTimeout(_,100)})}),T(()=>h.value,e=>{g.setDarkMode(e==="dark")}),I(()=>{s&&(s.disconnect(),s=null)}),(e,n)=>{const o=O;return q(),N("section",j,[f("h3",V,[w(o,{name:"i-hugeicons:comment-01",class:"comment-tip"}),n[0]||(n[0]=y("评论 ",-1))]),f("div",D,[f("p",R,[w(o,{name:"line-md:loading-twotone-loop",class:"loadig-img"}),n[1]||(n[1]=y("评论加载中... ",-1))])])])}}}),F=Object.assign(z(H,[["__scopeId","data-v-576a22cd"]]),{__name:"PostComment"});export{B as L,F as _};
