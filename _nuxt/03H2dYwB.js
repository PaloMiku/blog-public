import{bk as K,z as j,D as Q,r as M,bl as Z,y as h,ag as w,d as W,e as x,g as b,bg as tt,w as D,U as et,f as $,W as nt,aX as at,T as O,h as ot,t as it,M as st,F as lt,bm as ct,_ as rt}from"./D4rvfVLF.js";function ut(a){return a instanceof Element?a.getBoundingClientRect():a}const y=a=>typeof a=="number"?`${a}px`:a;function Y(a,k,i){const g=K(k).map(s=>ut(j(s)));return j(a).animate(g.map(s=>({left:y(s.left),top:y(s.top),width:y(s.width),height:y(s.height)})),{duration:100,fill:"forwards",...i})}const ht={key:0,class:"tooltip"},gt={key:0,class:"caption"},V=.8,dt=Q({__name:"Lightbox",props:{el:{},caption:{},show:{type:Boolean},images:{},currentIndex:{}},emits:["close","navigate"],setup(a,{emit:k}){const i=a,g=k,s=i.el.getBoundingClientRect(),R=M(),p=Z(R),{width:_,height:X}=ct(),d=M(i.currentIndex??0),C=h(()=>i.images||[]);h(()=>C.value.length>1),h(()=>C.value[d.value]||i.el.src);const A=h(()=>d.value>0),S=h(()=>d.value<C.value.length-1);function z(){A.value&&(d.value--,g("navigate",d.value))}function F(){S.value&&(d.value++,g("navigate",d.value))}let v,I,E;const f=M({}),H=h(()=>Object.values(f.value).slice(0,2)),m=h(()=>P("current")),G=h(()=>T("current"));function L(t,e,n){if(n<1)return t<Math.min(_.value,s.width,i.el.naturalWidth)&&e<Math.min(X.value,s.height,i.el.naturalHeight);if(n>1)return t>Math.max(_.value,s.width,i.el.naturalWidth)&&e>Math.max(X.value,s.height,i.el.naturalHeight)}function U(t){const{left:e,top:n,width:o,height:l}=p.value.getBoundingClientRect();if(L(o,l,1-t.deltaY))return;const r=Math.abs(t.deltaY)<8?Math.abs(t.deltaY)*.05:.5,u=t.deltaY>0?1/(1+r):1+r;Y(p,{left:e-(t.clientX-e)*(u-1),top:n-(t.clientY-n)*(u-1),width:o*u,height:l*u})}function N(){for(const t of Object.values(f.value))t.startX=t.currentX,t.startY=t.currentY;v=p.value.getBoundingClientRect(),I=P("start"),E=T("start")}function P(t){const e=H.value;return{x:e.reduce((n,o)=>n+o[`${t}X`],0)/e.length,y:e.reduce((n,o)=>n+o[`${t}Y`],0)/e.length}}function T(t){const[e,n]=H.value;return!e||!n?0:Math.hypot(e[`${t}X`]-n[`${t}X`],e[`${t}Y`]-n[`${t}Y`])}w("pointerdown",t=>{f.value[t.pointerId]={startX:t.clientX,startY:t.clientY,currentX:t.clientX,currentY:t.clientY},N()}),w("pointermove",t=>{const e=f.value[t.pointerId];if(!e)return;e.currentX=t.clientX,e.currentY=t.clientY;const n=G.value/E||1,o=v.width*n,l=v.height*n;if(L(o,l,n))return;const c=v.left+m.value.x-I.x,r=v.top+m.value.y-I.y,u=c-(m.value.x-c)*(n-1),B=r-(m.value.y-r)*(n-1);Y(p,{left:u,top:B,width:o,height:l},{duration:0})}),w("pointerup",t=>{delete f.value[t.pointerId],Object.keys(f.value).length&&N()});function q(t,e){const n=window.innerWidth*V,o=window.innerHeight*V,l=i.el.naturalWidth/i.el.naturalHeight,[c,r]=n/o>l?[o*l,o]:[n,n/l],u=(_.value-c)/2,B=(X.value-r)/2;Y(t,[s,{left:u,top:B,width:c,height:r}]).onfinish=e}function J(t,e){Y(t,i.el).onfinish=e}return w("keydown",t=>{t.key==="Escape"?g("close"):t.key==="ArrowLeft"?z():t.key==="ArrowRight"&&F()}),(t,e)=>{const n=tt,o=nt,l=st;return x(),W(lt,null,[b(n,{show:a.show,blur:"",onClick:e[0]||(e[0]=c=>g("close"))},null,8,["show"]),b(O,{onEnter:q,onLeave:J},{default:D(()=>[a.show?(x(),et(o,{key:0,ref_key:"lightbox",ref:R,class:"image",alt:a.el.alt,width:a.el.width,height:a.el.height,src:a.el.src,draggable:"false",onWheel:at(U,["prevent"])},null,8,["alt","width","height","src"])):$("",!0)]),_:1}),b(O,null,{default:D(()=>[a.show?(x(),W("div",ht,[a.caption?(x(),W("span",gt,it(a.caption),1)):$("",!0),ot("button",{class:"close","aria-label":"关闭灯箱",onClick:e[1]||(e[1]=c=>g("close"))},[b(l,{name:"ph:x-bold"})])])):$("",!0)]),_:1})],64)}}}),vt=Object.assign(rt(dt,[["__scopeId","data-v-e35eebc2"]]),{__name:"PopoverLightbox"});export{vt as default};
