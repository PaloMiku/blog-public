const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DbJJb6iD.js","./CDBNL-Sb.js","./M33mzaW3.js","./entry.BDocIaql.css","./Lightbox.CBHK7Kjn.css"])))=>i.map(i=>d[i]);
import{J as M,N as C,s as u,q as T,aE as K,Q as X,aN as $,b5 as p,aR as w,b7 as y,M as L,ai as S,a8 as A,b4 as I}from"./CDBNL-Sb.js";import{c as N,b as P,B as q,e as z,C as O,_ as B}from"./M33mzaW3.js";const R=S(()=>A(()=>import("./DbJJb6iD.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(d=>d.default||d)),V={class:"z-comment"},D={class:"text-creative"},j={id:"artalk"},H={class:"loading-box"},U=M({__name:"Comment",setup(d){const m=N(),f=P(),_=q(),h=O.getInstance(),E=z();function x(e){return!e||e==="/"||e.endsWith("/")?e:`${e}/`}function b(){return new Promise((e,o)=>{if(typeof window<"u"&&window.katex){e(window.katex);return}const n=document.querySelector('script[src*="katex"]');if(n){n.addEventListener("load",()=>e(window.katex)),n.addEventListener("error",()=>{console.warn("[KaTeX] 加载失败"),o(new Error("KaTeX 加载失败"))});return}const t=document.createElement("script");t.src="https://lib.baomitu.com/KaTeX/0.16.9/katex.min.js",t.onload=()=>{console.debug("[KaTeX] 加载成功"),e(window.katex)},t.onerror=()=>{console.warn("[KaTeX] 加载失败"),o(new Error("KaTeX 脚本加载失败"))},document.head.appendChild(t)})}async function l(){try{await b();const e=typeof window<"u"?window.katex:void 0;if(!e){console.warn("[KaTeX] 未检测到 KaTeX 实例，稍后重试"),setTimeout(()=>l(),1e3);return}document.querySelectorAll("#artalk .atk-content:not(.math-processed)").forEach(n=>{n.classList.add("math-processed");let t=n.innerHTML;const i=t;t=t.replace(/\$\$([^$]+)\$\$/g,(a,r)=>{try{return`<span class="math-display">${e.renderToString(r.trim(),{displayMode:!0})}</span>`}catch(c){return console.warn("KaTeX display render error:",c),a}}),t=t.replace(/\$([^$\n]+)\$/g,(a,r)=>{if(a.includes('<span class="math-'))return a;try{return`<span class="math-inline">${e.renderToString(r.trim(),{displayMode:!1})}</span>`}catch(c){return console.warn("KaTeX inline render error:",c),a}}),t=t.replace(/```math\s*([\s\S]*?)```/g,(a,r)=>{try{return`<div class="math-block">${e.renderToString(r.trim(),{displayMode:!0})}</div>`}catch(c){return console.warn("KaTeX math block render error:",c),a}}),t!==i&&(n.innerHTML=t)})}catch(e){console.error("Failed to load KaTeX:",e),setTimeout(()=>l(),1e3)}}function g(){document.querySelectorAll("#artalk .atk-content img").forEach(o=>{const n=o;n.style.cursor!=="zoom-in"&&(n.style.cursor="zoom-in",n.addEventListener("click",()=>{const{open:t}=E.use(()=>L(R,{el:n}));t()}))})}let s=null;function v(){const e=document.getElementById("artalk");e&&(s&&s.disconnect(),s=new MutationObserver(o=>{let n=!1,t=!1;o.forEach(i=>{i.type==="childList"&&i.addedNodes.length>0&&i.addedNodes.forEach(a=>{if(a.nodeType===Node.ELEMENT_NODE){const r=a;(r.tagName==="IMG"||r.querySelector("img"))&&(n=!0),(r.classList?.contains("atk-content")||r.querySelector(".atk-content"))&&(t=!0)}})}),n&&setTimeout(()=>g(),100),t&&setTimeout(()=>l(),500)}),s.observe(e,{childList:!0,subtree:!0}))}async function k(){try{const e=x(f.path);console.debug("[Artalk] 开始初始化...",{path:e}),await h.init({el:"#artalk",pageKey:e,pageTitle:document.title.replace(` | ${m.title}`,""),server:m.artalk?.server,site:m.artalk?.site,emoticons:"/assets/Owo-Artalk.json",darkMode:_.value==="dark"}),console.debug("[Artalk] 初始化完成"),await u(()=>{setTimeout(()=>{g(),setTimeout(()=>l(),1e3),v()},500)})}catch(e){console.error("[Artalk] 初始化失败:",e instanceof Error?e.message:e)}}return C(()=>{u(()=>{setTimeout(k,100)})}),T(()=>f.path,()=>{u(()=>{setTimeout(k,100)})}),T(()=>_.value,e=>{h.setDarkMode(e==="dark")}),K(()=>{s&&(s.disconnect(),s=null)}),(e,o)=>{const n=B;return $(),X("section",V,[p("h3",D,[w(n,{name:"i-hugeicons:comment-01",class:"comment-tip"}),o[0]||(o[0]=y("评论 ",-1))]),p("div",j,[p("p",H,[w(n,{name:"line-md:loading-twotone-loop",class:"loadig-img"}),o[1]||(o[1]=y("评论加载中... ",-1))])])])}}}),J=Object.assign(I(U,[["__scopeId","data-v-3206c485"]]),{__name:"PostComment"});export{J as _};
