import{z as C,E as G,r as h,ad as w,ac as x,G as z,d as r,f as u,L as a,e as c,h as s,t as m,g as p,J as $,n as B,aV as E,_ as N}from"./BBMwgywy.js";const V=["title"],D={class:"game-header"},P=["src","alt"],S={class:"game-content"},j={class:"game-name"},F={class:"game-meta"},I={class:"meta-item"},L={class:"value"},M={key:0,class:"meta-item"},T={class:"value"},W={key:1,class:"meta-item"},J={class:"value"},O={class:"achievements-header"},U={class:"value"},Z={key:1,class:"game-card game-card-error"},q={key:2,class:"game-card game-card-loading"},A=C({__name:"GameCard",props:{game:{default:void 0},appid:{default:void 0}},setup(f){const _=f,b=`${G.steam?.apiBase}/steam-game`,v=new Map,d=h(!1),l=h(!1),g=h(null);let i=null;w(()=>_.appid,async n=>{if(n&&!_.game){if(v.has(n)){g.value=v.get(n)??null,d.value=!1,l.value=!1;return}d.value=!0,l.value=!1,i&&i.abort(),i=new AbortController;try{const e=await fetch(`${b}?appid=${n}`,{signal:i.signal});if(e.ok){const o=await e.json();o.success&&o.data?.game?(g.value=o.data.game,v.set(n,o.data.game)):l.value=!0}else l.value=!0}catch(e){e instanceof Error&&e.name!=="AbortError"&&(console.error("[GameCard] Fetch error:",e),l.value=!0)}finally{d.value=!1}}},{immediate:!0}),x(()=>{i&&i.abort()});const t=z(()=>_.game||g.value);function y(n){window.open(`https://store.steampowered.com/app/${n}`,"_blank")}return(n,e)=>{const o=$,k=E;return!a(d)&&a(t)?(c(),r("div",{key:0,class:"game-card",title:`点击查看 ${a(t).name} 的 Steam 页面`,onClick:e[0]||(e[0]=H=>y(a(t).appid))},[s("div",D,[s("img",{src:a(t).images.headerImage,alt:a(t).name,class:"header-image",loading:"lazy"},null,8,P),e[1]||(e[1]=s("div",{class:"game-overlay"},null,-1))]),s("div",S,[s("h3",j,m(a(t).name),1),s("div",F,[s("div",I,[p(o,{name:"ph:hourglass-bold",size:"16",class:"meta-icon"}),e[2]||(e[2]=s("span",{class:"label"},"总时长:",-1)),s("span",L,m(a(t).playtimeForever)+"h",1)]),a(t).playtimeTwoWeeks!==void 0?(c(),r("div",M,[p(o,{name:"ph:calendar-bold",size:"16",class:"meta-icon"}),e[3]||(e[3]=s("span",{class:"label"},"两周内时长:",-1)),s("span",T,m(a(t).playtimeTwoWeeks)+"h",1)])):u("",!0),a(t).price?(c(),r("div",W,[p(o,{name:"ph:tag-bold",size:"16",class:"meta-icon"}),e[4]||(e[4]=s("span",{class:"label"},"价格:",-1)),s("span",J,m(a(t).price.displayPrice),1)])):u("",!0)]),a(t).achievements?(c(),r("div",{key:0,class:B(["achievements-section",{"no-price":!a(t).price}])},[s("div",O,[p(o,{name:"ph:medal-bold",size:"16",class:"achievement-icon"}),e[5]||(e[5]=s("span",{class:"label"},"成就:",-1)),s("span",U,m(a(t).achievements.unlocked)+"/"+m(a(t).achievements.total),1)]),p(k,{percent:a(t).achievements.percentage,"show-time":!1,height:"3px","bar-color":a(t).achievements.percentage===100?"#4ade80":void 0},null,8,["percent","bar-color"])],2)):u("",!0)])],8,V)):a(l)?(c(),r("div",Z,[...e[6]||(e[6]=[s("div",{class:"error-content"},[s("p",null,"游戏加载失败"),s("small",null,"请检查游戏 ID 是否正确")],-1)])])):a(d)?(c(),r("div",q,[...e[7]||(e[7]=[s("div",{class:"loading-skeleton"},null,-1)])])):u("",!0)}}}),Q=Object.assign(N(A,[["__scopeId","data-v-de6527b4"]]),{__name:"GameCard"});export{Q as default};
