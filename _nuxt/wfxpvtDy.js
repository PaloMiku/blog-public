const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BkOj-w_l.js","./D6ajeznB.js","./D_HPzWS8.js","./entry.BOobB3Nu.css","./Lightbox.BjXgNHbX.css"])))=>i.map(i=>d[i]);
import{x as w,_ as C,g as ae,bn as ce,bo as ue,J as de,ah as he,r as H,bp as se,Q as p,aN as d,b5 as a,aQ as L,aR as y,aP as pe,bq as me,K as u,l as fe,aZ as G,b7 as X,a_ as _e,aU as R,aV as N,b8 as $,aM as ge,br as ve,M as be,ai as ye,a8 as xe,b4 as $e}from"./D6ajeznB.js";import{c as ke,d as we,e as Ee,f as O,_ as Ce}from"./D_HPzWS8.js";import{u as Me,_ as Ie}from"./BuDaulsk.js";import{t as Se}from"./DkiCSWdc.js";import{h as B}from"./CVHHKwOH.js";import{u as ze}from"./pHMlZn-_.js";function ne(f,n,i){const[l={},h]=typeof n=="string"?[{},n]:[n,i],c=w(()=>C(f)),r=w(()=>C(l.key)||"$f"+B([h,typeof c.value=="string"?c.value:"",...Te(l)]));if(!l.baseURL&&typeof c.value=="string"&&c.value[0]==="/"&&c.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:_,lazy:M,default:I,transform:T,pick:S,watch:z,immediate:m,getCachedData:v,deep:D,dedupe:P,timeout:q,...J}=l,k=ae({...ce,...J,cache:typeof l.cache=="boolean"?void 0:l.cache}),K={server:_,lazy:M,default:I,transform:T,pick:S,immediate:m,getCachedData:v,deep:D,dedupe:P,timeout:q,watch:z===!1?[]:[...z||[],k]};return ze(z===!1?r.value:r,(A,{signal:U})=>(l.$fetch||globalThis.$fetch)(c.value,{signal:U,...k}),K)}function Te(f){const n=[C(f.method)?.toUpperCase()||"GET",C(f.baseURL)];for(const i of[f.params||f.query]){const l=C(i);if(!l)continue;const h={};for(const[c,r]of Object.entries(l))h[C(c)]=C(r);n.push(h)}if(f.body){const i=C(f.body);if(!i)n.push(B(i));else if(i instanceof ArrayBuffer)n.push(B(Object.fromEntries([...new Uint8Array(i).entries()].map(([l,h])=>[l,h.toString()]))));else if(i instanceof FormData){const l={};for(const h of i.entries()){const[c,r]=h;l[c]=r instanceof File?r.name:r}n.push(B(l))}else if(ue(i))n.push(B(ae(i)));else try{n.push(B(i))}catch{console.warn("[useFetch] Failed to hash body",i)}}return n}function Le(f){const n=f.split(`
`),i=[];let l=!1,h="",c=[],r=0;for(;r<n.length;){const _=n[r];if(_.trimStart().match(/^```/)){if(l){const m=c.join(`
`);i.push(`<pre><code${h?` class="language-${h}"`:""}>${V(m)}</code></pre>`),l=!1,c=[],h=""}else{l=!0;const m=_.trimStart().match(/^```(.*)$/);h=m?m[1].trim():"",c=[]}r++;continue}if(l){c.push(_),r++;continue}if(!_.trim()){r++;continue}const M=_.trimStart().match(/^(#{1,6})\s+(.+)$/);if(M){const m=M[1].length,v=M[2],D=j(v);i.push(`<h${m}>${D}</h${m}>`),r++;continue}const I=_.trimStart().match(/^>\s+(.+)$/);if(I){const m=I[1],v=j(m);i.push(`<blockquote>${v}</blockquote>`),r++;continue}const T=_.trimStart().match(/^[\*\-]\s+(.+)$/);if(T){const m=T[1],v=j(m);i.push(`<ul><li>${v}</li></ul>`),r++;continue}const S=_.trimStart().match(/^\d+\.\s+(.+)$/);if(S){const m=S[1],v=j(m);i.push(`<ol><li>${v}</li></ol>`),r++;continue}const z=j(_);i.push(`<p>${z}</p>`),r++}if(l&&c.length>0){const _=c.join(`
`);i.push(`<pre><code${h?` class="language-${h}"`:""}>${V(_)}</code></pre>`)}return i.join("")}function j(f){let n=f;const i=[],l="\0CODE";return n=n.replace(/`([^`]+)`/g,h=>{const c=i.length;return i.push(`<code>${V(h.slice(1,-1))}</code>`),`${l}${c}${l}`}),n=n.replace(/\[([^\]]+)\]\(([^\)]+)\)/g,(h,c,r)=>`<a href="${V(r)}" target="_blank" rel="noopener noreferrer">${c}</a>`),n=n.replace(/\*\*([^\*]+)\*\*/g,"<strong>$1</strong>"),n=n.replace(/~~([^~]+)~~/g,"<del>$1</del>"),n=n.replace(/\*([^\*\n]+)\*/g,"<em>$1</em>"),n=n.replace(/_([^_\n]+)_/g,"<em>$1</em>"),i.forEach((h,c)=>{n=n.replace(`${l}${c}${l}`,h)}),n}function V(f){const n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return f.replace(/[&<>"']/g,i=>n[i]||i)}const Be=ye(()=>xe(()=>import("./BkOj-w_l.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(f=>f.default||f)),De={class:"echo-container"},Pe={class:"echo-toolbar"},Ue={class:"echo-search"},We=["disabled","title"],Re=["href"],Ne={key:0,class:"echo-heatmap-section"},Oe={class:"heatmap-header"},je={class:"heatmap-title"},qe={class:"heatmap-content"},Ae={class:"heatmap-left"},Fe=["title"],He={class:"heatmap-legend"},Ge={class:"legend-cells"},Ve={class:"heatmap-stats"},Je={class:"stat-item"},Ke={class:"stat-value"},Qe={class:"stat-item"},Ze={class:"stat-value"},Xe={class:"stat-item"},Ye={class:"stat-value"},et={key:1,class:"echo-loading"},tt={key:2,class:"echo-empty"},st={key:3,class:"echo-empty"},nt={key:4,class:"echo-list"},at={class:"echo-time"},ot=["innerHTML"],it={key:1,class:"echo-tags"},lt=["href","title"],rt={key:2,class:"echo-extension"},ct={class:"extension-label"},ut={class:"extension-type-text"},dt=["href"],ht={class:"website-content"},pt={class:"website-title"},mt={class:"website-url"},ft=["href"],_t={class:"extension-url"},gt={key:3,class:"echo-images"},vt=["onClick"],bt={class:"echo-card-footer"},yt={class:"echo-likes"},xt=["href"],$t={key:5,class:"echo-load-more"},kt=["disabled"],wt=10,Et=de({__name:"echo",async setup(f){let n,i;const l=ke(),h=we(),c=Ee();h.setAside(["blog-stats","blog-log"]),he({meta:[{name:"description",content:`${l?.title||"Echo"}的最新动态和短想法记录。`}]});const r=H(""),_=H(1),{data:M,pending:I,refresh:T}=([n,i]=se(()=>ne(`${O.echo.apiBase}${O.echo.apiEndpoint}?page=1&pageSize=100`,{watch:!1,default:()=>({data:{items:[]}})},"$h5c9zGxgMR")),n=await n,i(),n),{data:S,pending:z}=([n,i]=se(()=>ne(`${O.echo.apiBase}/api/heatmap`,{watch:!1,default:()=>({code:0,msg:"",data:[]})},"$cewwBWa4WN")),n=await n,i(),n),m=w(()=>{const s=M.value?.data?.items;return s?.length?s.filter(e=>!e.private).sort((e,o)=>new Date(o.created_at).getTime()-new Date(e.created_at).getTime()):[]}),v=H(!1),D=async()=>{if(!v.value){v.value=!0;try{_.value=1,r.value="",await T()}catch(s){console.error("Failed to refresh echos:",s)}finally{v.value=!1}}},P=w(()=>{const s=r.value.trim().toLowerCase();return s?m.value.filter(e=>{if(!e)return!1;const o=e.content?.toLowerCase()||"",b=e.username?.toLowerCase()||"";return o.includes(s)||b.includes(s)}):m.value}),q=w(()=>{const s=_.value*wt;return P.value.slice(0,s)}),J=w(()=>q.value.length<P.value.length),k=H(!1),K=async()=>{k.value||(k.value=!0,await new Promise(s=>setTimeout(s,300)),_.value++,k.value=!1)},Y={GITHUBPROJ:{label:"GitHub 项目",icon:"mdi:github"},GITHUB:{label:"GitHub",icon:"mdi:github"},MUSIC:{label:"音乐",icon:"mdi:music"},WEBSITE:{label:"网站",icon:"mdi:globe"},LINK:{label:"链接",icon:"mdi:link"}},A=s=>Y[s]||{label:s,icon:"mdi:link"},U=new Map,ee=s=>{if(!s||typeof s!="string")return{title:"无效链接",site:"#",hostname:"无效链接"};if(U.has(s))return U.get(s);let e;try{const o=JSON.parse(s);if(!o||typeof o!="object")throw new Error("Invalid data structure");let b="",g=o.site||"";if(g)try{const t=new URL(g);if(t.protocol!=="http:"&&t.protocol!=="https:")throw new Error("Invalid protocol");b=t.hostname}catch{g="#",b="无效链接"}e={title:(o.title||"").toString().trim()||"无标题",site:g,hostname:b}}catch{e={title:"解析失败",site:"#",hostname:"解析失败"}}return U.set(s,e),e},oe=(s,e,o)=>{try{const b=s.currentTarget||null;let g=null,t=[],x=0;if(o){const E=te.value.find(W=>W.id===o);E&&E.images?.length&&(t=E.images.map(W=>W.image_url),e&&(x=t.findIndex(W=>W===e),x===-1&&(x=0)))}if(b&&(g=b.querySelector("img")),!g&&e){if(!e.trim()||!e.startsWith("http://")&&!e.startsWith("https://")){console.warn("Invalid image source:",e);return}const E=new Image;E.src=e,g=E}if(!g){console.warn("No valid image element found for lightbox");return}const{open:F}=c.use(()=>be(Be,{el:g,images:t.length>0?t:void 0,currentIndex:t.length>0?x:void 0}));F()}catch(b){console.error("Failed to open image lightbox:",b)}},{parseMusicExtension:ie}=Me(),te=w(()=>q.value.map(s=>({...s,parsedWebsiteExtension:s.extension&&s.extension_type==="WEBSITE"?ee(s.extension):null,parsedMusicExtension:s.extension&&s.extension_type==="MUSIC"&&O.meting?.enabled?ie(s.extension):null}))),le=(s,e)=>{if(s===0||e===0)return 0;const o=Math.ceil(s/e*4);return Math.min(o,4)},Q=w(()=>{const s=S.value?.data||[];if(s.length===0)return[];const e=Math.max(...s.map(o=>o.count),1);return s.map(o=>({date:o.date,count:o.count,level:le(o.count,e)}))}),re=w(()=>Q.value.length>=30?{rows:2,cols:15}:{rows:3,cols:10}),Z=w(()=>{const s=S.value?.data||[];if(s.length===0)return{total:0,average:0,maxCount:0,maxDate:""};const e=s.reduce((g,t)=>g+t.count,0),o=Math.round(e/s.length),b=s.reduce((g,t)=>t.count>g.count?t:g);return{total:e,average:o,maxCount:b.count,maxDate:b.date}});return(s,e)=>{const o=Ce,b=Ie,g=ve;return d(),p("div",De,[a("div",Pe,[a("div",Ue,[y(o,{name:"mdi:magnify",size:"20",class:"search-icon"}),pe(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>fe(r)?r.value=t:null),type:"text",placeholder:"搜索动态...",class:"search-input"},null,512),[[me,u(r)]])]),a("button",{disabled:u(v)||u(I),class:"echo-refresh-btn",title:u(v)?"刷新中...":"手动刷新动态",onClick:D},[y(o,{name:"mdi:refresh",size:"18",class:G({spin:u(v)})},null,8,["class"])],8,We),a("a",{href:u(O).echo.rss,target:"_blank",rel:"noopener noreferrer",class:"echo-rss-btn",title:"订阅动态 RSS 源"},[y(o,{name:"mdi:rss",size:"18"})],8,Re)]),!u(z)&&u(Q).length>0?(d(),p("div",Ne,[a("div",Oe,[a("h3",je,[y(o,{name:"mdi:fire",size:"20"}),e[1]||(e[1]=X(" 热力图 ",-1))])]),a("div",qe,[a("div",Ae,[a("div",{class:"heatmap-grid",style:_e({gridTemplateColumns:`repeat(${u(re).cols}, 1fr)`})},[(d(!0),p(R,null,N(u(Q),t=>(d(),p("div",{key:t.date,class:G(["heatmap-cell",`heatmap-level-${t.level}`]),title:`${t.date}: ${t.count} 条动态`},null,10,Fe))),128))],4),a("div",He,[e[2]||(e[2]=a("span",{class:"legend-label"},"少",-1)),a("div",Ge,[(d(),p(R,null,N(5,t=>a("div",{key:t,class:G(["legend-cell",`heatmap-level-${t-1}`])},null,2)),64))]),e[3]||(e[3]=a("span",{class:"legend-label"},"多",-1))])]),a("div",Ve,[a("div",Je,[e[4]||(e[4]=a("span",{class:"stat-label"},"总动态数",-1)),a("span",Ke,$(u(Z).total),1)]),a("div",Qe,[e[5]||(e[5]=a("span",{class:"stat-label"},"日均动态",-1)),a("span",Ze,$(u(Z).average),1)]),a("div",Xe,[e[6]||(e[6]=a("span",{class:"stat-label"},"单日最多",-1)),a("span",Ye,$(u(Z).maxCount),1)])])])])):L("",!0),u(I)?(d(),p("div",et,[y(o,{name:"eos-icons:loading",size:"32"}),e[7]||(e[7]=a("p",null,"加载中...",-1))])):u(m).length===0?(d(),p("div",tt,[y(o,{name:"solar:inbox-line-duotone",size:"48"}),e[8]||(e[8]=a("p",null,"暂无动态",-1))])):u(P).length===0?(d(),p("div",st,[y(o,{name:"solar:magnifer-line-duotone",size:"48"}),e[9]||(e[9]=a("p",null,"未找到匹配的动态",-1))])):(d(),p("div",nt,[(d(!0),p(R,null,N(u(te),t=>(d(),p("article",{key:t.id,class:"echo-card card"},[a("div",at,[y(o,{name:"ph:calendar-dots-bold",size:"18"}),a("span",null,$(u(Se)(t.created_at)),1)]),t.content?(d(),p("div",{key:0,class:"echo-card-content",innerHTML:u(Le)(t.content)},null,8,ot)):L("",!0),t.tags?.length?(d(),p("div",it,[(d(!0),p(R,null,N(t.tags,x=>(d(),p("a",{key:x.id,href:`https://echo.sotkg.com/?tag=${encodeURIComponent(x.name)}`,target:"_blank",rel:"noopener noreferrer",class:"echo-tag",title:`使用数: ${x.usage_count}`}," #"+$(x.name),9,lt))),128))])):L("",!0),t.extension&&t.extension_type?(d(),p("div",rt,[a("div",ct,[e[10]||(e[10]=X(" 分享了 ",-1)),a("span",ut,$(A(t.extension_type).label),1)]),t.extension_type==="WEBSITE"&&t.parsedWebsiteExtension?(d(),p("a",{key:0,href:t.parsedWebsiteExtension.site,target:"_blank",rel:"noopener noreferrer",class:"extension-link website-link"},[y(o,{name:A(t.extension_type).icon,size:"20"},null,8,["name"]),a("div",ht,[a("div",pt,$(t.parsedWebsiteExtension.title),1),a("div",mt,$(t.parsedWebsiteExtension.hostname),1)]),y(o,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,dt)):t.extension_type==="MUSIC"&&t.parsedMusicExtension?(d(),ge(b,{key:1,music:t.parsedMusicExtension},null,8,["music"])):(d(),p("a",{key:2,href:t.extension,target:"_blank",rel:"noopener noreferrer",class:"extension-link"},[y(o,{name:A(t.extension_type).icon,size:"20"},null,8,["name"]),a("span",_t,$(t.extension),1),y(o,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,ft))])):L("",!0),t.images?.length?(d(),p("div",gt,[(d(!0),p(R,null,N(t.images,(x,F)=>(d(),p("button",{key:F,class:"echo-image-button",onClick:E=>oe(E,x.image_url,t.id)},[y(g,{src:x.image_url,alt:`Echo image ${F+1}`,class:"echo-image",loading:"lazy",fit:"cover"},null,8,["src","alt"])],8,vt))),128))])):L("",!0),a("div",bt,[a("span",yt,[y(o,{name:"mdi:heart",size:"16"}),X(" "+$(t.fav_count),1)]),a("a",{href:`https://echo.sotkg.com/echo/${t.id}`,target:"_blank",class:"echo-read-more"}," 查看原文 → ",8,xt)])]))),128))])),u(J)?(d(),p("div",$t,[a("button",{class:"load-more-btn",disabled:u(k),onClick:K},[y(o,{name:u(k)?"eos-icons:loading":"mdi:chevron-down",size:"20",class:G({spin:u(k)})},null,8,["name","class"]),a("span",null,$(u(k)?"装填中...":"继续装填"),1)],8,kt)])):L("",!0)])}}}),Lt=$e(Et,[["__scopeId","data-v-9f1a7597"]]);export{Lt as default};
