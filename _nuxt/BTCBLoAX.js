import{c as E,t as b,r as q,f as H,i as V,d as J,u as K,a as Q,b as Z,e as N,w as W,g as X,h as y,o as m,j as c,k as L,l as g,m as Y,_ as ee,v as te,n as z,p as se,q as ne,F as I,s as P,x as k,y as R,I as oe,z as re,A as ie}from"#entry";import{u as ae}from"./BHiOEjGm.js";import{L as ce}from"./CaiwunYR.js";function le(h){return typeof h=="string"?`'${h}'`:new ue().serialize(h)}const ue=(function(){class h{#e=new Map;compare(e,t){const n=typeof e,o=typeof t;return n==="string"&&o==="string"?e.localeCompare(t):n==="number"&&o==="number"?e-t:String.prototype.localeCompare.call(this.serialize(e,!0),this.serialize(t,!0))}serialize(e,t){if(e===null)return"null";switch(typeof e){case"string":return t?e:`'${e}'`;case"bigint":return`${e}n`;case"object":return this.$object(e);case"function":return this.$function(e)}return String(e)}serializeObject(e){const t=Object.prototype.toString.call(e);if(t!=="[object Object]")return this.serializeBuiltInType(t.length<10?`unknown:${t}`:t.slice(8,-1),e);const n=e.constructor,o=n===Object||n===void 0?"":n.name;if(o!==""&&globalThis[o]===n)return this.serializeBuiltInType(o,e);if(typeof e.toJSON=="function"){const r=e.toJSON();return o+(r!==null&&typeof r=="object"?this.$object(r):`(${this.serialize(r)})`)}return this.serializeObjectEntries(o,Object.entries(e))}serializeBuiltInType(e,t){const n=this["$"+e];if(n)return n.call(this,t);if(typeof t?.entries=="function")return this.serializeObjectEntries(e,t.entries());throw new Error(`Cannot serialize ${e}`)}serializeObjectEntries(e,t){const n=Array.from(t).sort((r,p)=>this.compare(r[0],p[0]));let o=`${e}{`;for(let r=0;r<n.length;r++){const[p,f]=n[r];o+=`${this.serialize(p,!0)}:${this.serialize(f)}`,r<n.length-1&&(o+=",")}return o+"}"}$object(e){let t=this.#e.get(e);return t===void 0&&(this.#e.set(e,`#${this.#e.size}`),t=this.serializeObject(e),this.#e.set(e,t)),t}$function(e){const t=Function.prototype.toString.call(e);return t.slice(-15)==="[native code] }"?`${e.name||""}()[native]`:`${e.name}(${e.length})${t.replace(/\s*\n\s*/g,"")}`}$Array(e){let t="[";for(let n=0;n<e.length;n++)t+=this.serialize(e[n]),n<e.length-1&&(t+=",");return t+"]"}$Date(e){try{return`Date(${e.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(e){return`ArrayBuffer[${new Uint8Array(e).join(",")}]`}$Set(e){return`Set${this.$Array(Array.from(e).sort((t,n)=>this.compare(t,n)))}`}$Map(e){return this.serializeObjectEntries("Map",e.entries())}}for(const s of["Error","RegExp","URL"])h.prototype["$"+s]=function(e){return`${s}(${e})`};for(const s of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])h.prototype["$"+s]=function(e){return`${s}[${e.join(",")}]`};for(const s of["BigInt64Array","BigUint64Array"])h.prototype["$"+s]=function(e){return`${s}[${e.join("n,")}${e.length>0?"n":""}]`};return h})(),he=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],de=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],fe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",A=[];class pe{_data=new M;_hash=new M([...he]);_nDataBytes=0;_minBufferSize=0;finalize(s){s&&this._append(s);const e=this._nDataBytes*8,t=this._data.sigBytes*8;return this._data.words[t>>>5]|=128<<24-t%32,this._data.words[(t+64>>>9<<4)+14]=Math.floor(e/4294967296),this._data.words[(t+64>>>9<<4)+15]=e,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(s,e){const t=this._hash.words;let n=t[0],o=t[1],r=t[2],p=t[3],f=t[4],v=t[5],w=t[6],$=t[7];for(let d=0;d<64;d++){if(d<16)A[d]=s[e+d]|0;else{const l=A[d-15],i=(l<<25|l>>>7)^(l<<14|l>>>18)^l>>>3,u=A[d-2],_=(u<<15|u>>>17)^(u<<13|u>>>19)^u>>>10;A[d]=i+A[d-7]+_+A[d-16]}const x=f&v^~f&w,B=n&o^n&r^o&r,S=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),D=(f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25),j=$+D+x+de[d]+A[d],C=S+B;$=w,w=v,v=f,f=p+j|0,p=r,r=o,o=n,n=j+C|0}t[0]=t[0]+n|0,t[1]=t[1]+o|0,t[2]=t[2]+r|0,t[3]=t[3]+p|0,t[4]=t[4]+f|0,t[5]=t[5]+v|0,t[6]=t[6]+w|0,t[7]=t[7]+$|0}_append(s){typeof s=="string"&&(s=M.fromUtf8(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes}_process(s){let e,t=this._data.sigBytes/64;s?t=Math.ceil(t):t=Math.max((t|0)-this._minBufferSize,0);const n=t*16,o=Math.min(n*4,this._data.sigBytes);if(n){for(let r=0;r<n;r+=16)this._doProcessBlock(this._data.words,r);e=this._data.words.splice(0,n),this._data.sigBytes-=o}return new M(e,o)}}class M{words;sigBytes;constructor(s,e){s=this.words=s||[],this.sigBytes=e===void 0?s.length*4:e}static fromUtf8(s){const e=unescape(encodeURIComponent(s)),t=e.length,n=[];for(let o=0;o<t;o++)n[o>>>2]|=(e.charCodeAt(o)&255)<<24-o%4*8;return new M(n,t)}toBase64(){const s=[];for(let e=0;e<this.sigBytes;e+=3){const t=this.words[e>>>2]>>>24-e%4*8&255,n=this.words[e+1>>>2]>>>24-(e+1)%4*8&255,o=this.words[e+2>>>2]>>>24-(e+2)%4*8&255,r=t<<16|n<<8|o;for(let p=0;p<4&&e*8+p*6<this.sigBytes*8;p++)s.push(fe.charAt(r>>>6*(3-p)&63))}return s.join("")}concat(s){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let e=0;e<s.sigBytes;e++){const t=s.words[e>>>2]>>>24-e%4*8&255;this.words[this.sigBytes+e>>>2]|=t<<24-(this.sigBytes+e)%4*8}else for(let e=0;e<s.sigBytes;e+=4)this.words[this.sigBytes+e>>>2]=s.words[e>>>2];this.sigBytes+=s.sigBytes}}function ye(h){return new pe().finalize(h).toBase64()}function O(h){return ye(le(h))}function me(h,s,e){const[t={},n]=typeof s=="string"?[{},s]:[s,e],o=E(()=>b(h)),r=E(()=>b(t.key)||"$f"+O([n,typeof o.value=="string"?o.value:"",...ge(t)]));if(!t.baseURL&&typeof o.value=="string"&&o.value[0]==="/"&&o.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:p,lazy:f,default:v,transform:w,pick:$,watch:d,immediate:x,getCachedData:B,deep:S,dedupe:D,...j}=t,C=q({...H,...j,cache:typeof t.cache=="boolean"?void 0:t.cache}),l={server:p,lazy:f,default:v,transform:w,pick:$,immediate:x,getCachedData:B,deep:S,dedupe:D,watch:d===!1?[]:[...d||[],C]};let i;return ae(d===!1?r.value:r,()=>{i?.abort?.(new DOMException("Request aborted as another request to the same endpoint was initiated.","AbortError")),i=typeof AbortController<"u"?new AbortController:{};const _=b(t.timeout);let a;return _&&(a=setTimeout(()=>i.abort(new DOMException("Request aborted due to timeout.","AbortError")),_),i.signal.onabort=()=>clearTimeout(a)),(t.$fetch||globalThis.$fetch)(o.value,{signal:i.signal,...C}).finally(()=>{clearTimeout(a)})},l)}function ge(h){const s=[b(h.method)?.toUpperCase()||"GET",b(h.baseURL)];for(const e of[h.params||h.query]){const t=b(e);if(!t)continue;const n={};for(const[o,r]of Object.entries(t))n[b(o)]=b(r);s.push(n)}if(h.body){const e=b(h.body);if(!e)s.push(O(e));else if(e instanceof ArrayBuffer)s.push(O(Object.fromEntries([...new Uint8Array(e).entries()].map(([t,n])=>[t,n.toString()]))));else if(e instanceof FormData){const t={};for(const n of e.entries()){const[o,r]=n;t[o]=r instanceof File?r.name:r}s.push(O(t))}else if(V(e))s.push(O(q(e)));else try{s.push(O(e))}catch{console.warn("[useFetch] Failed to hash body",e)}}return s}const _e={class:"echo-container"},be={class:"echo-toolbar"},we={class:"echo-search"},ve=["href"],$e={key:0,class:"echo-loading"},xe={key:1,class:"echo-empty"},Be={key:2,class:"echo-empty"},ze={key:3,class:"timeline echo-timeline"},ke={class:"timeline-caption echo-time-caption"},Ae={class:"timeline-body echo-card card"},Se={key:0,class:"echo-card-content"},je={key:1,class:"echo-extension"},Ce=["href"],Ie={class:"extension-url"},Oe=["href"],Ee={class:"extension-url"},Me={class:"extension-label"},De={class:"extension-type-text"},Ue=["href"],Te={class:"extension-url"},Le={key:2,class:"echo-images"},Re=["onClick"],Fe={class:"echo-card-footer"},Ge={class:"echo-likes"},Ne=["href"],Pe={key:4,class:"echo-load-more"},qe=20,He=J({__name:"echo",async setup(h){let s,e;const t=K();Q().setAside(["blog-stats","blog-log"]),Z({title:"动态",meta:[{name:"description",content:`${t.title}的最新动态和短想法记录。`}]});const o=N(""),r=N(1),{data:p,pending:f,error:v}=([s,e]=W(()=>me("/api/echo",{watch:!1},"$h5c9zGxgMR")),s=await s,e(),s),w=l=>{const u=new Date().getTime()-l.getTime(),_=Math.floor(u/1e3),a=Math.floor(_/60),U=Math.floor(a/60),T=Math.floor(U/24);if(_<60)return"刚刚";if(a<60)return`${a}分钟前`;if(U<24)return`${U}小时前`;if(T<7)return`${T}天前`;const G=["周日","周一","周二","周三","周四","周五","周六"][l.getDay()];return`${l.toLocaleDateString("zh-CN")} ${G}`},$=X(),d=l=>{const i=new Image;i.src=l;const{open:u}=$.use(()=>re(ce,{el:i}));u()},x=E(()=>p.value?.map(l=>({...l,relativeTime:w(new Date(l.created_at))}))||[]),B=E(()=>{if(!o.value.trim())return x.value;const l=o.value.toLowerCase();return x.value.filter(i=>i.content.toLowerCase().includes(l)||i.username.toLowerCase().includes(l))}),S=E(()=>{const i=r.value*qe;return B.value.slice(0,i)}),D=E(()=>S.value.length<B.value.length),j=()=>{r.value++},C=l=>({GITHUBPROJ:"GitHub 项目",GITHUB:"GitHub",MUSIC:"音乐",LINK:"链接"})[l]||l;return(l,i)=>{const u=ee,_=oe;return m(),y("div",_e,[c("div",be,[c("div",we,[g(u,{name:"mdi:magnify",size:"20",class:"search-icon"}),Y(c("input",{"onUpdate:modelValue":i[0]||(i[0]=a=>se(o)?o.value=a:null),type:"text",placeholder:"搜索动态...",class:"search-input"},null,512),[[te,z(o)]])]),c("a",{href:z(ne).echo.rss,target:"_blank",rel:"noopener noreferrer",class:"echo-rss-btn",title:"订阅动态 RSS 源"},[g(u,{name:"mdi:rss",size:"18"})],8,ve)]),z(f)?(m(),y("div",$e,[g(u,{name:"eos-icons:loading",size:"32"}),i[1]||(i[1]=c("p",null,"加载中...",-1))])):z(x).length===0?(m(),y("div",xe,[g(u,{name:"solar:inbox-line-duotone",size:"48"}),i[2]||(i[2]=c("p",null,"暂无动态",-1))])):z(B).length===0?(m(),y("div",Be,[g(u,{name:"solar:magnifer-line-duotone",size:"48"}),i[3]||(i[3]=c("p",null,"未找到匹配的动态",-1))])):(m(),y("dl",ze,[(m(!0),y(I,null,P(z(S),(a,U)=>(m(),y(I,{key:a.id},[c("dt",ke,[c("span",null,k(a.relativeTime),1)]),c("dd",Ae,[a.content?(m(),y("div",Se,k(a.content),1)):L("",!0),a.extension&&a.extension_type?(m(),y("div",je,[a.extension_type==="GITHUBPROJ"?(m(),y(I,{key:0},[i[4]||(i[4]=c("div",{class:"extension-label"},[R(" 分享了 "),c("span",{class:"extension-type-text"},"GitHub 项目")],-1)),c("a",{href:a.extension,target:"_blank",rel:"noopener noreferrer",class:"extension-link"},[g(u,{name:"mdi:github",size:"20"}),c("span",Ie,k(a.extension),1),g(u,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,Ce)],64)):a.extension_type==="MUSIC"?(m(),y(I,{key:1},[i[5]||(i[5]=c("div",{class:"extension-label"},[R(" 分享了 "),c("span",{class:"extension-type-text"},"音乐")],-1)),c("a",{href:a.extension,target:"_blank",rel:"noopener noreferrer",class:"extension-link"},[g(u,{name:"mdi:music",size:"20"}),c("span",Ee,k(a.extension),1),g(u,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,Oe)],64)):(m(),y(I,{key:2},[c("div",Me,[i[6]||(i[6]=R(" 分享了 ",-1)),c("span",De,k(C(a.extension_type)),1)]),c("a",{href:a.extension,target:"_blank",rel:"noopener noreferrer",class:"extension-link"},[g(u,{name:"mdi:link",size:"20"}),c("span",Te,k(a.extension),1),g(u,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,Ue)],64))])):L("",!0),a.images&&a.images.length>0?(m(),y("div",Le,[(m(!0),y(I,null,P(a.images,(T,F)=>(m(),y("button",{key:F,class:"echo-image-button",onClick:G=>d(T.image_url)},[g(_,{src:T.image_url,alt:`Echo image ${F+1}`,class:"echo-image",loading:"lazy",fit:"cover"},null,8,["src","alt"])],8,Re))),128))])):L("",!0),c("div",Fe,[c("span",Ge,[g(u,{name:"mdi:heart",size:"16"}),R(" "+k(a.fav_count),1)]),c("a",{href:`https://memo.sotkg.com/echo/${a.id}`,target:"_blank",class:"echo-read-more"}," 查看 → ",8,Ne)])])],64))),128))])),z(D)?(m(),y("div",Pe,[c("button",{class:"load-more-btn",onClick:j},[g(u,{name:"mdi:chevron-down",size:"20"}),i[7]||(i[7]=c("span",null,"加载更多",-1))])])):L("",!0)])}}}),Ze=ie(He,[["__scopeId","data-v-efc4bda6"]]);export{Ze as default};
