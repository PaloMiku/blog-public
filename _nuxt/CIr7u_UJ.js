import{K as J,L as X,v as Y,_ as Z}from"./VuNmkfQC.js";import{J as ee,x as D,r as te,bd as ne,N as oe,Q as G,aN as I,aQ as L,b5 as F,K as E,b8 as H,aR as K,b4 as se}from"./D6ajeznB.js";import"./D-deoX8n.js";function ae(t,n){let e=0;for(;e<t.length;e++){const{text:a,ranges:i}=n[e]??{};if(t[e]!==a||i?.some(f=>f.collapsed))break}let o=t.length-1,r=n.length-1;for(;o>=0&&r>=0;o--,r--){const{text:a,ranges:i}=n[r]??{};if(t[o]!==a||i?.some(f=>f.collapsed))break}return e>o&&([e,o]=[o,e]),e=Math.max(0,e),o=Math.min(t.length-1,o)+1,t.length===n.length&&e+1===o?[e,o]:re(t,e,o)}function re(t,n,e){const o=r(Math.max(0,n+e-t.length));n-=o,e+=o;function r(u){const l=t.slice(0,n).indexOf(t[e],u);if(l===-1)return 0;for(let c=l,s=e;c<n-1;s++,c++)if(t[c+1]!==t[s+1])return r(u+1);return n-l}const a=t.join(`
`),i=t.slice(0,n).join(`
`).length,f=t.slice(0,e).join(`
`).length;let p=0;for(let u=n-1,l=f-1;u<e&&l>=i;u--){const c=t[u],s=a.lastIndexOf(c,l);if(s!==-1&&s>=i)p++,l=s-1;else break}let x=0;for(let u=e,l=i;u>=n&&l<f;u++){const c=t[u],s=a.indexOf(c,l);if(s!==-1&&s<f)x++,l=s+1;else break}return[n-p,e+x]}function ce(t,n){let e=0,o;return function(...r){o&&(clearTimeout(o),o=void 0);const a=performance.now();!e||a-e>=n?(t.apply(this,r),e=a):o=setTimeout(()=>{t.apply(this,r),e=performance.now(),o=void 0},n+e-a)}}function le(t){let n=!1;return function(...e){return n?!1:(n=!0,t.apply(this,e),!0)}}function ie(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}function fe(t){return{mount:n};function n(e,o){const{lang:r,themes:a={light:"min-light",dark:"min-dark"},defaultTheme:i="light",selector:f=m=>`.${m}`,defaultSelector:p=":root",watch:x=!0,delay:u=33.4}=o,l=new CSSStyleSheet;document.adoptedStyleSheets.push(l);const c=new Map,s=[];function y(m){for(const{range:d,name:k}of m)CSS.highlights.get(k)?.delete(d),c.get(k)?.delete(d)}function M(m){for(const{range:d,color:k,theme:S,name:g}of m){const v=S===i;let b=CSS.highlights.get(g);b||(CSS.highlights.set(g,b=new Highlight),b.priority=v?0:1);let C=c.get(g);if(!C){c.set(g,C=new Set);const _=`${v?p:f(S)}::highlight(${g}) { color: ${k}; }`;l.insertRule(_)}b.add(d),C.add(d)}}const N=ce(()=>{const{innerText:m}=e,d=m.split(`
`),k=ue(e),[S,g]=ae(d,s),v=g-d.length+s.length,b=s.splice(v);for(let h=S;h<v;h++)y(s[h].info);const C=s.at(-1)?.lastGrammarState;s.length=g-1,s.fill(null,S,g-1),s.push(de({lastGrammarState:C}),...b);let _=d.slice(0,S).reduce((h,w)=>h+w.length+1,0);const R=pe(m,k,_);for(let h=S;h<d.length;h++){const w=d[h],$=s[h],j=t.codeToTokens(w,{lang:r,themes:a,cssVariablePrefix:"",defaultColor:!1,grammarState:s[h-1]?.lastGrammarState}),P=[],B=[];for(const T of j.tokens[0]){if(!T.content.trim().length)continue;const[U,W]=R(_+T.offset),[q,z]=R(_+T.offset+T.content.length),O=document.createRange();O.setStart(U,W),O.setEnd(q,z),P.push(O),B.push(...he(T,O))}$&&y($.info),M(B);const V=$?.lastGrammarState?.getScopes(),A=j.grammarState?.getScopes(),Q=V&&A&&ie(V,A);if(s[h]={text:w,offset:_,lastGrammarState:j.grammarState,ranges:P,info:B},!Q)_+=w.length+1;else break}},u);return x&&e.addEventListener("input",N),N(),{dispose:le(()=>{x&&e.removeEventListener("input",N);const m=document.adoptedStyleSheets.indexOf(l);document.adoptedStyleSheets.splice(m,1);for(const[d,k]of c){const S=CSS.highlights.get(d);for(const g of k)S?.delete(g)}}),update:N}}}function ue(t){const n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT),e=[];let o;for(;o=n.nextNode();)e.push(o);return e}function de(t={}){return{text:"",offset:0,lastGrammarState:void 0,ranges:[],info:[],...t}}function*he(t,n){if(typeof t.htmlStyle=="object")for(const e in t.htmlStyle){const o=t.htmlStyle[e];yield{range:n,color:o,theme:e,name:`shiki-${e}-${o.slice(1).toLowerCase()}`}}}function pe(t,n,e){let o=0,r=0,a=!1;return e>0&&i(e),i;function i(f){for(;o<n.length;o++){const{textContent:p}=n[o];if(p)if(a||(r=t.indexOf(p,r),a=!0),r+p.length<f)r+=p.length,a=!1;else break}return[n[o],f-r]}}const ge={class:"copy"},me={key:0,class:"prompt"},Se=["textContent"],ke=ee({__name:"Copy",props:{prompt:{type:[String,Boolean],default:"$"},code:{},lang:{}},setup(t){const n=t,e=D(()=>n.prompt!==!0),o=D(()=>n.lang??J(n.prompt)),r=te(!1),a=ne("code-input"),i=X(),{copy:f,copied:p}=Y(a);function x(){a.value&&(a.value.textContent=n.code??"",a.value.dispatchEvent(new Event("input")),r.value=!1)}function u(c){const{data:s,inputType:y}=c;(s?.includes(`
`)||y==="insertLineBreak")&&c.preventDefault()}function l(c){r.value=n.code!==c.target.textContent}return oe(async()=>{const c=await i.load();await i.loadLang(o.value),fe(c).mount(a.value,i.getOptions(o.value))}),(c,s)=>{const y=Z;return I(),G("code",ge,[E(e)?(I(),G("span",me,H(t.prompt),1)):L("",!0),F("div",{ref:"code-input",contenteditable:"plaintext-only",class:"code scrollcheck-x",spellcheck:"false",onBeforeinput:u,onInput:l,textContent:H(t.code)},null,40,Se),E(r)?(I(),G("button",{key:1,class:"operation","aria-label":"恢复原始内容",onClick:x},[K(y,{name:"ph:arrow-u-up-left-bold"})])):L("",!0),F("button",{class:"operation","aria-label":"复制",onClick:s[0]||(s[0]=M=>E(f)())},[K(y,{name:E(p)?"ph:check-bold":"ph:copy-bold"},null,8,["name"])])])}}}),be=Object.assign(se(ke,[["__scopeId","data-v-18637e47"]]),{__name:"Copy"});export{be as default};
