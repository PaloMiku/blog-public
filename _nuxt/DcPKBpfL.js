const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Dv2d8Nm5.js","./CDBNL-Sb.js","./D57pCl1w.js","./entry.lQ5QTwvN.css","./Lightbox.CBHK7Kjn.css"])))=>i.map(i=>d[i]);
import{k as S,_ as E,n as Q,bn as X,bo as Y,J as ee,ah as te,r as P,bp as se,Q as h,aN as p,b5 as u,aQ as B,aR as v,aP as ne,bq as oe,K as _,l as ae,aZ as J,aU as U,aV as F,b8 as x,b7 as K,br as re,M as ie,ai as ce,a8 as le,b4 as ue}from"./CDBNL-Sb.js";import{c as de,d as he,e as pe,f as H,_ as me}from"./D57pCl1w.js";import{t as fe}from"./D0ZX89Dr.js";import{h as T}from"./2Ceb-OSG.js";import{u as _e}from"./BGsXIK8L.js";function ge(d,e,t){const[a={},l]=typeof e=="string"?[{},e]:[e,t],c=S(()=>E(d)),r=S(()=>E(a.key)||"$f"+T([l,typeof c.value=="string"?c.value:"",...be(a)]));if(!a.baseURL&&typeof c.value=="string"&&c.value[0]==="/"&&c.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:m,lazy:C,default:I,transform:M,pick:w,watch:k,immediate:f,getCachedData:b,deep:z,dedupe:j,timeout:$,...q}=a,R=Q({...X,...q,cache:typeof a.cache=="boolean"?void 0:a.cache}),L={server:m,lazy:C,default:I,transform:M,pick:w,immediate:f,getCachedData:b,deep:z,dedupe:j,timeout:$,watch:k===!1?[]:[...k||[],R]};return _e(k===!1?r.value:r,(V,{signal:A})=>(a.$fetch||globalThis.$fetch)(c.value,{signal:A,...R}),L)}function be(d){const e=[E(d.method)?.toUpperCase()||"GET",E(d.baseURL)];for(const t of[d.params||d.query]){const a=E(t);if(!a)continue;const l={};for(const[c,r]of Object.entries(a))l[E(c)]=E(r);e.push(l)}if(d.body){const t=E(d.body);if(!t)e.push(T(t));else if(t instanceof ArrayBuffer)e.push(T(Object.fromEntries([...new Uint8Array(t).entries()].map(([a,l])=>[a,l.toString()]))));else if(t instanceof FormData){const a={};for(const l of t.entries()){const[c,r]=l;a[c]=r instanceof File?r.name:r}e.push(T(a))}else if(Y(t))e.push(T(Q(t)));else try{e.push(T(t))}catch{console.warn("[useFetch] Failed to hash body",t)}}return e}function ye(d){const e=d.split(`
`),t=[];let a=!1,l="",c=[],r=0;for(;r<e.length;){const m=e[r];if(m.trimStart().match(/^```/)){if(a){const f=c.join(`
`);t.push(`<pre><code${l?` class="language-${l}"`:""}>${N(f)}</code></pre>`),a=!1,c=[],l=""}else{a=!0;const f=m.trimStart().match(/^```(.*)$/);l=f?f[1].trim():"",c=[]}r++;continue}if(a){c.push(m),r++;continue}if(!m.trim()){r++;continue}const C=m.trimStart().match(/^(#{1,6})\s+(.+)$/);if(C){const f=C[1].length,b=C[2],z=D(b);t.push(`<h${f}>${z}</h${f}>`),r++;continue}const I=m.trimStart().match(/^>\s+(.+)$/);if(I){const f=I[1],b=D(f);t.push(`<blockquote>${b}</blockquote>`),r++;continue}const M=m.trimStart().match(/^[\*\-]\s+(.+)$/);if(M){const f=M[1],b=D(f);t.push(`<ul><li>${b}</li></ul>`),r++;continue}const w=m.trimStart().match(/^\d+\.\s+(.+)$/);if(w){const f=w[1],b=D(f);t.push(`<ol><li>${b}</li></ol>`),r++;continue}const k=D(m);t.push(`<p>${k}</p>`),r++}if(a&&c.length>0){const m=c.join(`
`);t.push(`<pre><code${l?` class="language-${l}"`:""}>${N(m)}</code></pre>`)}return t.join("")}function D(d){let e=d;const t=[],a="\0CODE";return e=e.replace(/`([^`]+)`/g,l=>{const c=t.length;return t.push(`<code>${N(l.slice(1,-1))}</code>`),`${a}${c}${a}`}),e=e.replace(/\[([^\]]+)\]\(([^\)]+)\)/g,(l,c,r)=>`<a href="${N(r)}" target="_blank" rel="noopener noreferrer">${c}</a>`),e=e.replace(/\*\*([^\*]+)\*\*/g,"<strong>$1</strong>"),e=e.replace(/~~([^~]+)~~/g,"<del>$1</del>"),e=e.replace(/\*([^\*\n]+)\*/g,"<em>$1</em>"),e=e.replace(/_([^_\n]+)_/g,"<em>$1</em>"),t.forEach((l,c)=>{e=e.replace(`${a}${c}${a}`,l)}),e}function N(d){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return d.replace(/[&<>"']/g,t=>e[t]||t)}const ve=ce(()=>le(()=>import("./Dv2d8Nm5.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(d=>d.default||d)),ke={class:"echo-container"},$e={class:"echo-toolbar"},we={class:"echo-search"},xe=["disabled","title"],Ee=["href"],Ce={key:0,class:"echo-loading"},Ie={key:1,class:"echo-empty"},Se={key:2,class:"echo-empty"},Me={key:3,class:"timeline echo-timeline"},ze={class:"timeline-caption"},Te={class:"timeline-body echo-card card"},Le=["innerHTML"],Be={key:1,class:"echo-tags"},De=["href","title"],Re={key:2,class:"echo-extension"},Oe={class:"extension-label"},Pe={class:"extension-type-text"},Ue=["href"],Ne={class:"website-content"},je={class:"website-title"},qe={class:"website-url"},Ae=["href"],Fe={class:"extension-url"},He={key:3,class:"echo-images"},Ve=["onClick"],Ge={class:"echo-card-footer"},We={class:"echo-likes"},Je=["href"],Ke={key:4,class:"echo-load-more"},Qe=["disabled"],Ze=10,Xe=ee({__name:"echo",async setup(d){let e,t;const a=de(),l=he(),c=pe();l.setAside(["blog-stats","blog-log"]),te({meta:[{name:"description",content:`${a?.title||"Echo"}的最新动态和短想法记录。`}]});const r=P(""),m=P(1),{data:C,pending:I,refresh:M}=([e,t]=se(()=>ge(`${H.echo.apiBase}${H.echo.apiEndpoint}?page=1&pageSize=100`,{watch:!1,default:()=>({data:{items:[]}})},"$h5c9zGxgMR")),e=await e,t(),e),w=S(()=>{const n=C.value?.data?.items;return n?.length?n.filter(o=>!o.private).sort((o,i)=>new Date(i.created_at).getTime()-new Date(o.created_at).getTime()):[]}),k=P(!1),f=async()=>{if(!k.value){k.value=!0;try{m.value=1,r.value="",await M()}catch(n){console.error("Failed to refresh echos:",n)}finally{k.value=!1}}},b=S(()=>{const n=r.value.trim().toLowerCase();return n?w.value.filter(o=>{if(!o)return!1;const i=o.content?.toLowerCase()||"",y=o.username?.toLowerCase()||"";return i.includes(n)||y.includes(n)}):w.value}),z=S(()=>{const n=m.value*Ze;return b.value.slice(0,n)}),j=S(()=>z.value.length<b.value.length),$=P(!1),q=async()=>{$.value||($.value=!0,await new Promise(n=>setTimeout(n,300)),m.value++,$.value=!1)},R={GITHUBPROJ:{label:"GitHub 项目",icon:"mdi:github"},GITHUB:{label:"GitHub",icon:"mdi:github"},MUSIC:{label:"音乐",icon:"mdi:music"},WEBSITE:{label:"网站",icon:"mdi:globe"},LINK:{label:"链接",icon:"mdi:link"}},L=n=>R[n]||{label:n,icon:"mdi:link"},O=new Map,V=n=>{if(!n||typeof n!="string")return{title:"无效链接",site:"#",hostname:"无效链接"};if(O.has(n))return O.get(n);let o;try{const i=JSON.parse(n);if(!i||typeof i!="object")throw new Error("Invalid data structure");let y="",s=i.site||"";if(s)try{const g=new URL(s);if(g.protocol!=="http:"&&g.protocol!=="https:")throw new Error("Invalid protocol");y=g.hostname}catch{s="#",y="无效链接"}o={title:(i.title||"").toString().trim()||"无标题",site:s,hostname:y}}catch{o={title:"解析失败",site:"#",hostname:"解析失败"}}return O.set(n,o),o},A=(n,o)=>{try{const i=n.currentTarget||null;let y=null;if(i&&(y=i.querySelector("img")),!y&&o){if(!o.trim()||!o.startsWith("http://")&&!o.startsWith("https://")){console.warn("Invalid image source:",o);return}const g=new Image;g.src=o,y=g}if(!y){console.warn("No valid image element found for lightbox");return}const{open:s}=c.use(()=>ie(ve,{el:y}));s()}catch(i){console.error("Failed to open image lightbox:",i)}},G=S(()=>z.value.map(n=>({...n,parsedExtension:n.extension&&n.extension_type==="WEBSITE"?V(n.extension):null})));return(n,o)=>{const i=me,y=re;return p(),h("div",ke,[u("div",$e,[u("div",we,[v(i,{name:"mdi:magnify",size:"20",class:"search-icon"}),ne(u("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>ae(r)?r.value=s:null),type:"text",placeholder:"搜索动态...",class:"search-input"},null,512),[[oe,_(r)]])]),u("button",{disabled:_(k)||_(I),class:"echo-refresh-btn",title:_(k)?"刷新中...":"手动刷新动态",onClick:f},[v(i,{name:"mdi:refresh",size:"18",class:J({spin:_(k)})},null,8,["class"])],8,xe),u("a",{href:_(H).echo.rss,target:"_blank",rel:"noopener noreferrer",class:"echo-rss-btn",title:"订阅动态 RSS 源"},[v(i,{name:"mdi:rss",size:"18"})],8,Ee)]),_(I)?(p(),h("div",Ce,[v(i,{name:"eos-icons:loading",size:"32"}),o[1]||(o[1]=u("p",null,"加载中...",-1))])):_(w).length===0?(p(),h("div",Ie,[v(i,{name:"solar:inbox-line-duotone",size:"48"}),o[2]||(o[2]=u("p",null,"暂无动态",-1))])):_(b).length===0?(p(),h("div",Se,[v(i,{name:"solar:magnifer-line-duotone",size:"48"}),o[3]||(o[3]=u("p",null,"未找到匹配的动态",-1))])):(p(),h("dl",Me,[(p(!0),h(U,null,F(_(G),s=>(p(),h(U,{key:s.id},[u("dt",ze,[u("span",null,x(_(fe)(s.created_at)),1)]),u("dd",Te,[s.content?(p(),h("div",{key:0,class:"echo-card-content",innerHTML:_(ye)(s.content)},null,8,Le)):B("",!0),s.tags?.length?(p(),h("div",Be,[(p(!0),h(U,null,F(s.tags,g=>(p(),h("a",{key:g.id,href:`https://echo.sotkg.com/?tag=${encodeURIComponent(g.name)}`,target:"_blank",rel:"noopener noreferrer",class:"echo-tag",title:`使用数: ${g.usage_count}`}," #"+x(g.name),9,De))),128))])):B("",!0),s.extension&&s.extension_type?(p(),h("div",Re,[u("div",Oe,[o[4]||(o[4]=K(" 分享了 ",-1)),u("span",Pe,x(L(s.extension_type).label),1)]),s.extension_type==="WEBSITE"&&s.parsedExtension?(p(),h("a",{key:0,href:s.parsedExtension.site,target:"_blank",rel:"noopener noreferrer",class:"extension-link website-link"},[v(i,{name:L(s.extension_type).icon,size:"20"},null,8,["name"]),u("div",Ne,[u("div",je,x(s.parsedExtension.title),1),u("div",qe,x(s.parsedExtension.hostname),1)]),v(i,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,Ue)):(p(),h("a",{key:1,href:s.extension,target:"_blank",rel:"noopener noreferrer",class:"extension-link"},[v(i,{name:L(s.extension_type).icon,size:"20"},null,8,["name"]),u("span",Fe,x(s.extension),1),v(i,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,Ae))])):B("",!0),s.images?.length?(p(),h("div",He,[(p(!0),h(U,null,F(s.images,(g,W)=>(p(),h("button",{key:W,class:"echo-image-button",onClick:Z=>A(Z,g.image_url)},[v(y,{src:g.image_url,alt:`Echo image ${W+1}`,class:"echo-image",loading:"lazy",fit:"cover"},null,8,["src","alt"])],8,Ve))),128))])):B("",!0),u("div",Ge,[u("span",We,[v(i,{name:"mdi:heart",size:"16"}),K(" "+x(s.fav_count),1)]),u("a",{href:`https://echo.sotkg.com/echo/${s.id}`,target:"_blank",class:"echo-read-more"}," 查看原文 → ",8,Je)])])],64))),128))])),_(j)?(p(),h("div",Ke,[u("button",{class:"load-more-btn",disabled:_($),onClick:q},[v(i,{name:_($)?"eos-icons:loading":"mdi:chevron-down",size:"20",class:J({spin:_($)})},null,8,["name","class"]),u("span",null,x(_($)?"装填中...":"继续装填"),1)],8,Qe)])):B("",!0)])}}}),ot=ue(Xe,[["__scopeId","data-v-929b3457"]]);export{ot as default};
