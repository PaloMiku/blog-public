import{_ as j,J as Q,r as O,k as M,Q as m,aN as g,aR as w,aT as R,aQ as b,T as W,aM as A,br as J,b6 as q,b5 as F,b8 as G,b4 as K}from"./CDBNL-Sb.js";import{a9 as U,aa as Z,o as x,_ as tt,ab as et}from"./B4WoWNIM.js";function nt(a){return a instanceof Element?a.getBoundingClientRect():a}const Y=a=>typeof a=="number"?`${a}px`:a;function y(a,k,l){const d=U(k).map(o=>nt(j(o)));return j(a).animate(d.map(o=>({left:Y(o.left),top:Y(o.top),width:Y(o.width),height:Y(o.height)})),{duration:100,fill:"forwards",...l})}const at={class:"z-lightbox"},it={key:0,class:"tooltip"},ot={key:0,class:"caption"},P=.8,st=Q({__name:"Lightbox",props:{el:{},caption:{},show:{type:Boolean}},emits:["close"],setup(a,{emit:k}){const l=a,d=k,o=l.el.getBoundingClientRect(),$=O(),p=Z($),{width:X,height:C}=et();let f,B,E;const u=O({}),I=M(()=>Object.values(u.value).slice(0,2)),v=M(()=>N("current")),V=M(()=>T("current"));function H(t,e,n){if(n<1)return t<Math.min(X.value,o.width,l.el.naturalWidth)&&e<Math.min(C.value,o.height,l.el.naturalHeight);if(n>1)return t>Math.max(X.value,o.width,l.el.naturalWidth)&&e>Math.max(C.value,o.height,l.el.naturalHeight)}function z(t){const{left:e,top:n,width:i,height:s}=p.value.getBoundingClientRect();if(H(i,s,1-t.deltaY))return;const c=Math.abs(t.deltaY)<8?Math.abs(t.deltaY)*.05:.5,r=t.deltaY>0?1/(1+c):1+c;y(p,{left:e-(t.clientX-e)*(r-1),top:n-(t.clientY-n)*(r-1),width:i*r,height:s*r})}function L(){for(const t of Object.values(u.value))t.startX=t.currentX,t.startY=t.currentY;f=p.value.getBoundingClientRect(),B=N("start"),E=T("start")}function N(t){const e=I.value;return{x:e.reduce((n,i)=>n+i[`${t}X`],0)/e.length,y:e.reduce((n,i)=>n+i[`${t}Y`],0)/e.length}}function T(t){const[e,n]=I.value;return!e||!n?0:Math.hypot(e[`${t}X`]-n[`${t}X`],e[`${t}Y`]-n[`${t}Y`])}x("pointerdown",t=>{u.value[t.pointerId]={startX:t.clientX,startY:t.clientY,currentX:t.clientX,currentY:t.clientY},L()}),x("pointermove",t=>{const e=u.value[t.pointerId];if(!e)return;e.currentX=t.clientX,e.currentY=t.clientY;const n=V.value/E||1,i=f.width*n,s=f.height*n;if(H(i,s,n))return;const h=f.left+v.value.x-B.x,c=f.top+v.value.y-B.y,r=h-(v.value.x-h)*(n-1),_=c-(v.value.y-c)*(n-1);y(p,{left:r,top:_,width:i,height:s},{duration:0})}),x("pointerup",t=>{delete u.value[t.pointerId],Object.keys(u.value).length&&L()});function D(t,e){const n=window.innerWidth*P,i=window.innerHeight*P,s=l.el.naturalWidth/l.el.naturalHeight,[h,c]=n/i>s?[i*s,i]:[n,n/s],r=(X.value-h)/2,_=(C.value-c)/2;y(t,[o,{left:r,top:_,width:h,height:c}]).onfinish=e}function S(t,e){y(t,l.el).onfinish=e}return x("keydown",t=>{t.key==="Escape"&&d("close")}),(t,e)=>{const n=J,i=tt;return g(),m("div",at,[w(W,null,{default:R(()=>[a.show?(g(),m("div",{key:0,id:"z-lightbox-bgmask",onClick:e[0]||(e[0]=s=>d("close"))})):b("",!0)]),_:1}),w(W,{onEnter:D,onLeave:S},{default:R(()=>[a.show?(g(),A(n,{key:0,ref_key:"lightbox",ref:$,class:"image",alt:a.el.alt,width:a.el.width,height:a.el.height,src:a.el.src,draggable:"false",onWheel:q(z,["prevent"])},null,8,["alt","width","height","src"])):b("",!0)]),_:1}),w(W,null,{default:R(()=>[a.show?(g(),m("div",it,[a.caption?(g(),m("span",ot,G(a.caption),1)):b("",!0),F("button",{class:"close","aria-label":"关闭灯箱",onClick:e[1]||(e[1]=s=>d("close"))},[w(i,{name:"ph:x-bold"})])])):b("",!0)]),_:1})])}}}),rt=Object.assign(K(st,[["__scopeId","data-v-7453ca20"]]),{__name:"PopoverLightbox"});export{rt as default};
