const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CEWyZUFz.js","./D6ajeznB.js","./DFr_1crl.js","./D-deoX8n.js","./entry.B3t-9a59.css","./Lightbox.Bo6Lg9Gu.css"])))=>i.map(i=>d[i]);
import{x as w,_ as C,g as ae,bn as ce,bo as ue,J as de,ah as he,r as H,bp as se,Q as p,aN as d,b5 as a,aQ as B,aR as y,aP as pe,bq as me,K as u,l as fe,aZ as G,b7 as X,a_ as _e,aU as W,aV as R,b8 as $,aM as ge,br as ve,M as be,ai as ye,a8 as xe,b4 as $e}from"./D6ajeznB.js";import{c as ke,d as we,e as Ee,f as O,_ as Ce}from"./DFr_1crl.js";import{u as Me,_ as Ie}from"./DrhTrq0-.js";import{t as Se}from"./Cw19IxjC.js";import{h as L}from"./CGVv1Zha.js";import{u as ze}from"./Cz3yjcKc.js";import"./D-deoX8n.js";function ne(g,n,i){const[r={},h]=typeof n=="string"?[{},n]:[n,i],c=w(()=>C(g)),l=w(()=>C(r.key)||"$f"+L([h,typeof c.value=="string"?c.value:"",...Te(r)]));if(!r.baseURL&&typeof c.value=="string"&&c.value[0]==="/"&&c.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:v,lazy:M,default:I,transform:T,pick:S,watch:z,immediate:_,getCachedData:b,deep:N,dedupe:D,timeout:j,...J}=r,k=ae({...ce,...J,cache:typeof r.cache=="boolean"?void 0:r.cache}),K={server:v,lazy:M,default:I,transform:T,pick:S,immediate:_,getCachedData:b,deep:N,dedupe:D,timeout:j,watch:z===!1?[]:[...z||[],k]};return ze(z===!1?l.value:l,(q,{signal:P})=>(r.$fetch||globalThis.$fetch)(c.value,{signal:P,...k}),K)}function Te(g){const n=[C(g.method)?.toUpperCase()||"GET",C(g.baseURL)];for(const i of[g.params||g.query]){const r=C(i);if(!r)continue;const h={};for(const[c,l]of Object.entries(r))h[C(c)]=C(l);n.push(h)}if(g.body){const i=C(g.body);if(!i)n.push(L(i));else if(i instanceof ArrayBuffer)n.push(L(Object.fromEntries([...new Uint8Array(i).entries()].map(([r,h])=>[r,h.toString()]))));else if(i instanceof FormData){const r={};for(const h of i.entries()){const[c,l]=h;r[c]=l instanceof File?l.name:l}n.push(L(r))}else if(ue(i))n.push(L(ae(i)));else try{n.push(L(i))}catch{console.warn("[useFetch] Failed to hash body",i)}}return n}function Be(g){const n=g.split(`
`),i=[];let r=!1,h="",c=[],l=0;for(;l<n.length;){const v=n[l];if(v.trimStart().match(/^```/)){if(r){const _=c.join(`
`);i.push(`<pre><code${h?` class="language-${h}"`:""}>${V(_)}</code></pre>`),r=!1,c=[],h=""}else{r=!0;const _=v.trimStart().match(/^```(.*)$/);h=_?_[1].trim():"",c=[]}l++;continue}if(r){c.push(v),l++;continue}if(!v.trim()){l++;continue}const M=v.trimStart().match(/^(#{1,6}) (.+)$/);if(M){const _=M[1].length,b=M[2],N=A(b);i.push(`<h${_}>${N}</h${_}>`),l++;continue}const I=v.trimStart().match(/^> (.+)$/);if(I){const _=I[1],b=A(_);i.push(`<blockquote>${b}</blockquote>`),l++;continue}const T=v.trimStart().match(/^[*\-] (.+)$/);if(T){const _=T[1],b=A(_);i.push(`<ul><li>${b}</li></ul>`),l++;continue}const S=v.trimStart().match(/^\d+\. (.+)$/);if(S){const _=S[1],b=A(_);i.push(`<ol><li>${b}</li></ol>`),l++;continue}const z=A(v);i.push(`<p>${z}</p>`),l++}if(r&&c.length>0){const v=c.join(`
`);i.push(`<pre><code${h?` class="language-${h}"`:""}>${V(v)}</code></pre>`)}return i.join("")}function A(g){let n=g;const i=[],r="\0CODE";return n=n.replace(/`([^`]+)`/g,h=>{const c=i.length;return i.push(`<code>${V(h.slice(1,-1))}</code>`),`${r}${c}${r}`}),n=n.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(h,c,l)=>`<a href="${V(l)}" target="_blank" rel="noopener noreferrer">${c}</a>`),n=n.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),n=n.replace(/~~([^~]+)~~/g,"<del>$1</del>"),n=n.replace(/\*([^*\n]+)\*/g,"<em>$1</em>"),n=n.replace(/_([^_\n]+)_/g,"<em>$1</em>"),i.forEach((h,c)=>{n=n.replace(`${r}${c}${r}`,h)}),n}function V(g){const n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return g.replace(/[&<>"']/g,i=>n[i]||i)}const Le=ye(()=>xe(()=>import("./CEWyZUFz.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(g=>g.default||g)),Ne={class:"echo-container"},De={class:"echo-toolbar"},Pe={class:"echo-search"},Ue=["disabled","title"],We=["href"],Re={key:0,class:"echo-heatmap-section"},Oe={class:"heatmap-header"},Ae={class:"heatmap-title"},je={class:"heatmap-content"},qe={class:"heatmap-left"},Fe=["title"],He={class:"heatmap-legend"},Ge={class:"legend-cells"},Ve={class:"heatmap-stats"},Je={class:"stat-item"},Ke={class:"stat-value"},Qe={class:"stat-item"},Ze={class:"stat-value"},Xe={class:"stat-item"},Ye={class:"stat-value"},et={key:1,class:"echo-loading"},tt={key:2,class:"echo-empty"},st={key:3,class:"echo-empty"},nt={key:4,class:"echo-list"},at={class:"echo-time"},ot=["innerHTML"],it={key:1,class:"echo-tags"},rt=["href","title"],lt={key:2,class:"echo-extension"},ct={class:"extension-label"},ut={class:"extension-type-text"},dt=["href"],ht={class:"website-content"},pt={class:"website-title"},mt={class:"website-url"},ft=["href"],_t={class:"extension-url"},gt={key:3,class:"echo-images"},vt=["onClick"],bt={class:"echo-card-footer"},yt={class:"echo-likes"},xt=["href"],$t={key:5,class:"echo-load-more"},kt=["disabled"],wt=10,Et=de({__name:"echo",async setup(g){let n,i;const r=ke(),h=we(),c=Ee();h.setAside(["blog-stats","blog-log"]),he({title:"动态",meta:[{property:"og:type",content:"website"},{name:"description",content:`${r.author.name} 的动态分享，记录最新的想法、观点和日常动态。`},{name:"keywords",content:"动态,分享,想法,日记,思考"}]});const l=H(""),v=H(1),{data:M,pending:I,refresh:T}=([n,i]=se(()=>ne(`${O.echo.apiBase}${O.echo.apiEndpoint}?page=1&pageSize=100`,{watch:!1,default:()=>({data:{items:[]}})},"$h5c9zGxgMR")),n=await n,i(),n),{data:S,pending:z}=([n,i]=se(()=>ne(`${O.echo.apiBase}/api/heatmap`,{watch:!1,default:()=>({code:0,msg:"",data:[]})},"$cewwBWa4WN")),n=await n,i(),n),_=w(()=>{const s=M.value?.data?.items;return s?.length?s.filter(e=>!e.private).sort((e,o)=>{try{const m=new Date(e.created_at),f=new Date(o.created_at);return Number.isNaN(m.getTime())||Number.isNaN(f.getTime())?0:f.getTime()-m.getTime()}catch(m){return console.error(`Invalid date comparison: ${e.created_at}, ${o.created_at}`,m),0}}):[]}),b=H(!1);async function N(){if(!b.value){b.value=!0;try{v.value=1,l.value="",await T()}catch(s){console.error("Failed to refresh echos:",s)}finally{b.value=!1}}}const D=w(()=>{const s=l.value.trim().toLowerCase();return s?_.value.filter(e=>{if(!e)return!1;const o=e.content?.toLowerCase()||"",m=e.username?.toLowerCase()||"";return o.includes(s)||m.includes(s)}):_.value}),j=w(()=>{const s=v.value*wt;return D.value.slice(0,s)}),J=w(()=>j.value.length<D.value.length),k=H(!1);async function K(){k.value||(k.value=!0,await new Promise(s=>setTimeout(s,300)),v.value++,k.value=!1)}const Y={GITHUBPROJ:{label:"GitHub 项目",icon:"mdi:github"},GITHUB:{label:"GitHub",icon:"mdi:github"},MUSIC:{label:"音乐",icon:"mdi:music"},WEBSITE:{label:"网站",icon:"mdi:globe"},LINK:{label:"链接",icon:"mdi:link"}},q=s=>Y[s]||{label:s,icon:"mdi:link"},P=new Map;function ee(s){if(!s||typeof s!="string")return{title:"无效链接",site:"#",hostname:"无效链接"};if(P.has(s))return P.get(s);let e;try{const o=JSON.parse(s);if(!o||typeof o!="object")throw new Error("Invalid data structure");let m="",f=o.site||"";if(f)try{const t=new URL(f);if(t.protocol!=="http:"&&t.protocol!=="https:")throw new Error("Invalid protocol");m=t.hostname}catch{f="#",m="无效链接"}e={title:(o.title||"").toString().trim()||"无标题",site:f,hostname:m}}catch{e={title:"解析失败",site:"#",hostname:"解析失败"}}return P.set(s,e),e}const{parseMusicExtension:oe}=Me(),te=w(()=>j.value.map(s=>({...s,parsedWebsiteExtension:s.extension&&s.extension_type==="WEBSITE"?ee(s.extension):null,parsedMusicExtension:s.extension&&s.extension_type==="MUSIC"&&O.meting?.enabled?oe(s.extension):null})));function ie(s,e,o){try{const m=s.currentTarget||null;let f=null,t=[],x=0;if(o){const E=te.value.find(U=>U.id===o);E&&E.images?.length&&(t=E.images.map(U=>U.image_url),e&&(x=t.findIndex(U=>U===e),x===-1&&(x=0)))}if(m&&(f=m.querySelector("img")),!f&&e){if(!e.trim()||!e.startsWith("http://")&&!e.startsWith("https://")){console.warn("Invalid image source:",e);return}const E=new Image;E.src=e,f=E}if(!f){console.warn("No valid image element found for lightbox");return}const{open:F}=c.use(()=>be(Le,{el:f,images:t.length>0?t:void 0,currentIndex:t.length>0?x:void 0}));F()}catch(m){console.error("Failed to open image lightbox:",m)}}function re(s,e){if(s===0||e===0)return 0;const o=Math.ceil(s/e*4);return Math.min(o,4)}const Q=w(()=>{const s=S.value?.data||[];if(s.length===0)return[];const e=Math.max(...s.map(o=>o.count),1);return s.map(o=>({date:o.date,count:o.count,level:re(o.count,e)}))}),le=w(()=>Q.value.length>=30?{rows:2,cols:15}:{rows:3,cols:10}),Z=w(()=>{const s=S.value?.data||[];if(s.length===0)return{total:0,average:0,maxCount:0,maxDate:""};const e=s.reduce((f,t)=>f+t.count,0),o=Math.round(e/s.length),m=s.reduce((f,t)=>t.count>f.count?t:f);return{total:e,average:o,maxCount:m.count,maxDate:m.date}});return(s,e)=>{const o=Ce,m=Ie,f=ve;return d(),p("div",Ne,[a("div",De,[a("div",Pe,[y(o,{name:"mdi:magnify",size:"20",class:"search-icon"}),pe(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>fe(l)?l.value=t:null),type:"text",placeholder:"搜索动态...",class:"search-input"},null,512),[[me,u(l)]])]),a("button",{disabled:u(b)||u(I),class:"echo-refresh-btn",title:u(b)?"刷新中...":"手动刷新动态",onClick:N},[y(o,{name:"mdi:refresh",size:"18",class:G({spin:u(b)})},null,8,["class"])],8,Ue),a("a",{href:u(O).echo.rss,target:"_blank",rel:"noopener noreferrer",class:"echo-rss-btn",title:"订阅动态 RSS 源"},[y(o,{name:"mdi:rss",size:"18"})],8,We)]),!u(z)&&u(Q).length>0?(d(),p("div",Re,[a("div",Oe,[a("h3",Ae,[y(o,{name:"mdi:fire",size:"20"}),e[1]||(e[1]=X(" 热力图 ",-1))])]),a("div",je,[a("div",qe,[a("div",{class:"heatmap-grid",style:_e({gridTemplateColumns:`repeat(${u(le).cols}, 1fr)`})},[(d(!0),p(W,null,R(u(Q),t=>(d(),p("div",{key:t.date,class:G(["heatmap-cell",[`heatmap-level-${t.level}`]]),title:`${t.date}: ${t.count} 条动态`},null,10,Fe))),128))],4),a("div",He,[e[2]||(e[2]=a("span",{class:"legend-label"},"少",-1)),a("div",Ge,[(d(),p(W,null,R(5,t=>a("div",{key:t,class:G(["legend-cell",[`heatmap-level-${t-1}`]])},null,2)),64))]),e[3]||(e[3]=a("span",{class:"legend-label"},"多",-1))])]),a("div",Ve,[a("div",Je,[e[4]||(e[4]=a("span",{class:"stat-label"},"总动态数",-1)),a("span",Ke,$(u(Z).total),1)]),a("div",Qe,[e[5]||(e[5]=a("span",{class:"stat-label"},"日均动态",-1)),a("span",Ze,$(u(Z).average),1)]),a("div",Xe,[e[6]||(e[6]=a("span",{class:"stat-label"},"单日最多",-1)),a("span",Ye,$(u(Z).maxCount),1)])])])])):B("",!0),u(I)?(d(),p("div",et,[y(o,{name:"eos-icons:loading",size:"32"}),e[7]||(e[7]=a("p",null,"加载中...",-1))])):u(_).length===0?(d(),p("div",tt,[y(o,{name:"solar:inbox-line-duotone",size:"48"}),e[8]||(e[8]=a("p",null,"暂无动态",-1))])):u(D).length===0?(d(),p("div",st,[y(o,{name:"solar:magnifer-line-duotone",size:"48"}),e[9]||(e[9]=a("p",null,"未找到匹配的动态",-1))])):(d(),p("div",nt,[(d(!0),p(W,null,R(u(te),t=>(d(),p("article",{key:t.id,class:"echo-card card"},[a("div",at,[y(o,{name:"ph:calendar-dots-bold",size:"18"}),a("span",null,$(u(Se)(t.created_at)),1)]),t.content?(d(),p("div",{key:0,class:"echo-card-content",innerHTML:u(Be)(t.content)},null,8,ot)):B("",!0),t.tags?.length?(d(),p("div",it,[(d(!0),p(W,null,R(t.tags,x=>(d(),p("a",{key:x.id,href:`https://echo.sotkg.com/?tag=${encodeURIComponent(x.name)}`,target:"_blank",rel:"noopener noreferrer",class:"echo-tag",title:`使用数: ${x.usage_count}`}," #"+$(x.name),9,rt))),128))])):B("",!0),t.extension&&t.extension_type?(d(),p("div",lt,[a("div",ct,[e[10]||(e[10]=X(" 分享了 ",-1)),a("span",ut,$(q(t.extension_type).label),1)]),t.extension_type==="WEBSITE"&&t.parsedWebsiteExtension?(d(),p("a",{key:0,href:t.parsedWebsiteExtension.site,target:"_blank",rel:"noopener noreferrer",class:"extension-link website-link"},[y(o,{name:q(t.extension_type).icon,size:"20"},null,8,["name"]),a("div",ht,[a("div",pt,$(t.parsedWebsiteExtension.title),1),a("div",mt,$(t.parsedWebsiteExtension.hostname),1)]),y(o,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,dt)):t.extension_type==="MUSIC"&&t.parsedMusicExtension?(d(),ge(m,{key:1,music:t.parsedMusicExtension},null,8,["music"])):(d(),p("a",{key:2,href:t.extension,target:"_blank",rel:"noopener noreferrer",class:"extension-link"},[y(o,{name:q(t.extension_type).icon,size:"20"},null,8,["name"]),a("span",_t,$(t.extension),1),y(o,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,ft))])):B("",!0),t.images?.length?(d(),p("div",gt,[(d(!0),p(W,null,R(t.images,(x,F)=>(d(),p("button",{key:F,class:"echo-image-button",onClick:E=>ie(E,x.image_url,t.id)},[y(f,{src:x.image_url,alt:`Echo image ${F+1}`,class:"echo-image",loading:"lazy",fit:"cover"},null,8,["src","alt"])],8,vt))),128))])):B("",!0),a("div",bt,[a("span",yt,[y(o,{name:"mdi:heart",size:"16"}),X(" "+$(t.fav_count),1)]),a("a",{href:`https://echo.sotkg.com/echo/${t.id}`,target:"_blank",class:"echo-read-more"}," 查看原文 → ",8,xt)])]))),128))])),u(J)?(d(),p("div",$t,[a("button",{class:"load-more-btn",disabled:u(k),onClick:K},[y(o,{name:u(k)?"eos-icons:loading":"mdi:chevron-down",size:"20",class:G({spin:u(k)})},null,8,["name","class"]),a("span",null,$(u(k)?"装填中...":"继续装填"),1)],8,kt)])):B("",!0)])}}}),Lt=$e(Et,[["__scopeId","data-v-78431d00"]]);export{Lt as default};
