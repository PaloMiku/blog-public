import{J as V,r as h,o as j,S as A,x as b,aM as k,aN as s,aT as E,Q as n,K as e,b5 as o,aQ as l,br as L,aR as g,b8 as c,aU as B,aV as N,b7 as w,b4 as S}from"./D6ajeznB.js";import{f as z,_ as F,k as O}from"./Ck0C0w3y.js";import"./D-deoX8n.js";const Q=["data-source","title"],U={class:"card-header"},q={class:"card-cover"},J={key:1,class:"cover-placeholder"},K={key:2,class:"rating-badge"},P={class:"card-info"},R={class:"info-header"},G={class:"title-section"},H={class:"media-title"},W={key:0,class:"original-title"},X={key:0,class:"source-info"},Y={class:"info-label"},Z={class:"info-value"},ee={key:1,class:"date-range"},ae={key:0,class:"date-item"},te={key:1,class:"date-item"},se={key:0,class:"media-description"},ne={key:1,class:"tags-container"},oe={class:"card-footer"},ie={class:"source-badge"},re={class:"source-name"},le={key:1,class:"media-card media-card-error"},ce={key:2,class:"media-card media-card-loading"},de={key:3,class:"media-card media-card-loading"},ue=V({__name:"index",props:{bangumiId:{}},setup($){const I=$,f=new Map,m=h(!1),d=h(!1),a=h(null);let _=null;j(()=>I.bangumiId,async r=>{if(r){if(f.has(r)){a.value=f.get(r)??null,m.value=!1,d.value=!1;return}m.value=!0,d.value=!1,_&&_.abort(),_=new AbortController;try{const i=z.bangumi?.apiBase;if(!i){d.value=!0,console.error("[MediaCard] Bangumi API base not configured");return}const v=await fetch(`${i}/api/subject?id=${r}`,{signal:_.signal});if(v.ok){const t=await v.json();if(t.id){const p={source:"bangumi",title:t.name||"未命名作品",originalTitle:t.name_cn||void 0,description:t.summary||void 0,cover:t.images?.large||t.images?.common||void 0,rating:t.rating?.score||void 0,episode:t.eps||void 0,status:t.status==="Air"?"on-air":t.status==="End"?"finished":"planned",airDate:t.date||void 0,link:`https://bangumi.tv/subject/${t.id}`,rank:t.rank||void 0,tags:t.tags?.map(u=>u.name).slice(0,5)||void 0,metadata:{bangumiId:t.id,ratingCount:t.rating?.total||void 0}};a.value=p,f.set(r,p)}else d.value=!0}else d.value=!0}catch(i){i instanceof Error&&i.name!=="AbortError"&&(console.error("[MediaCard] Fetch error:",i),d.value=!0)}finally{m.value=!1}}},{immediate:!0}),A(()=>{_&&_.abort()});const y=b(()=>"Bangumi"),C=b(()=>"ri:bilibili-line"),D=b(()=>{if(!a.value)return[];const r=[];return a.value.episode&&r.push({label:"话数",value:a.value.episode}),a.value.rank&&r.push({label:"排名",value:`#${a.value.rank}`}),r});function M(){a.value?.link&&window.open(a.value.link,"_blank")}function x(r){return r?new Date(r).toLocaleDateString("zh-CN"):""}return(r,i)=>{const v=L,t=F,p=O;return s(),k(p,null,{default:E(()=>[!e(m)&&!e(d)&&e(a)?(s(),n("div",{key:0,class:"media-card","data-source":e(a).source,title:`点击查看${e(y)}页面`},[o("div",U,[o("div",q,[e(a).cover?(s(),k(v,{key:0,src:e(a).cover,alt:e(a).title,class:"cover-image",loading:"lazy"},null,8,["src","alt"])):(s(),n("div",J,[g(t,{name:"ph:image-square-bold",class:"placeholder-icon"})])),e(a).rating?(s(),n("div",K," ⭐ "+c(e(a).rating),1)):l("",!0)]),o("div",P,[o("div",R,[o("div",G,[o("h3",H,c(e(a).title),1),e(a).originalTitle?(s(),n("p",W,c(e(a).originalTitle),1)):l("",!0)]),e(D).length>0?(s(),n("div",X,[(s(!0),n(B,null,N(e(D),(u,T)=>(s(),n("div",{key:`${u.label}-${T}`,class:"info-item"},[o("span",Y,c(u.label)+":",1),o("span",Z,c(u.value),1)]))),128))])):l("",!0),e(a).airDate||e(a).endDate?(s(),n("div",ee,[e(a).airDate?(s(),n("span",ae,[g(t,{name:"clarity:date-line",class:"date-icon"}),w(" "+c(x(e(a).airDate)),1)])):l("",!0),e(a).endDate?(s(),n("span",te,[g(t,{name:"clarity:date-line",class:"date-icon"}),w(" "+c(x(e(a).endDate)),1)])):l("",!0)])):l("",!0)]),e(a).description?(s(),n("p",se,c(e(a).description),1)):l("",!0),e(a).tags&&e(a).tags.length>0?(s(),n("div",ne,[(s(!0),n(B,null,N(e(a).tags,u=>(s(),n("span",{key:u,class:"tag"},c(u),1))),128))])):l("",!0),o("div",oe,[o("div",ie,[e(C)?(s(),k(t,{key:0,name:e(C),class:"source-icon"},null,8,["name"])):l("",!0),o("span",re,c(e(y)),1)]),e(a).link?(s(),n("button",{key:0,class:"view-button",onClick:M},[i[0]||(i[0]=o("span",null,"查看详情",-1)),g(t,{name:"ri:arrow-right-line",class:"button-icon"})])):l("",!0)])])])],8,Q)):e(d)?(s(),n("div",le,[...i[1]||(i[1]=[o("div",{class:"error-content"},[o("p",null,"加载失败"),o("small",null,"请检查 ID 是否正确或稍后重试")],-1)])])):e(m)?(s(),n("div",ce,[...i[2]||(i[2]=[o("div",{class:"loading-skeleton"},null,-1)])])):(s(),n("div",de,[...i[3]||(i[3]=[o("div",{class:"loading-skeleton"},null,-1)])]))]),_:1})}}}),pe=Object.assign(S(ue,[["__scopeId","data-v-90c92d23"]]),{__name:"MediaCard"});export{pe as default};
