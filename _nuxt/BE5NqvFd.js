const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DbJJb6iD.js","./CDBNL-Sb.js","./M33mzaW3.js","./entry.BDocIaql.css","./Lightbox.CBHK7Kjn.css"])))=>i.map(i=>d[i]);
import{k as x,_ as w,n as ee,bn as oe,bo as le,J as ie,ah as re,r as j,bp as X,Q as h,aN as p,b5 as a,aQ as z,aR as y,aP as ce,bq as de,K as d,l as ue,aZ as q,b7 as G,aU as P,aV as R,b8 as $,br as he,M as pe,ai as me,a8 as fe,b4 as _e}from"./CDBNL-Sb.js";import{c as ge,d as ve,e as be,f as A,_ as ye}from"./M33mzaW3.js";import{t as $e}from"./B3FLixph.js";import{h as T}from"./CyAovGVG.js";import{u as ke}from"./DYH9sXWb.js";function Y(_,n,l){const[i={},u]=typeof n=="string"?[{},n]:[n,l],c=x(()=>w(_)),r=x(()=>w(i.key)||"$f"+T([u,typeof c.value=="string"?c.value:"",...xe(i)]));if(!i.baseURL&&typeof c.value=="string"&&c.value[0]==="/"&&c.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:g,lazy:E,default:C,transform:S,pick:M,watch:I,immediate:m,getCachedData:v,deep:D,dedupe:L,timeout:O,...H}=i,k=ee({...oe,...H,cache:typeof i.cache=="boolean"?void 0:i.cache}),W={server:g,lazy:E,default:C,transform:S,pick:M,immediate:m,getCachedData:v,deep:D,dedupe:L,timeout:O,watch:I===!1?[]:[...I||[],k]};return ke(I===!1?r.value:r,(U,{signal:B})=>(i.$fetch||globalThis.$fetch)(c.value,{signal:B,...k}),W)}function xe(_){const n=[w(_.method)?.toUpperCase()||"GET",w(_.baseURL)];for(const l of[_.params||_.query]){const i=w(l);if(!i)continue;const u={};for(const[c,r]of Object.entries(i))u[w(c)]=w(r);n.push(u)}if(_.body){const l=w(_.body);if(!l)n.push(T(l));else if(l instanceof ArrayBuffer)n.push(T(Object.fromEntries([...new Uint8Array(l).entries()].map(([i,u])=>[i,u.toString()]))));else if(l instanceof FormData){const i={};for(const u of l.entries()){const[c,r]=u;i[c]=r instanceof File?r.name:r}n.push(T(i))}else if(le(l))n.push(T(ee(l)));else try{n.push(T(l))}catch{console.warn("[useFetch] Failed to hash body",l)}}return n}function we(_){const n=_.split(`
`),l=[];let i=!1,u="",c=[],r=0;for(;r<n.length;){const g=n[r];if(g.trimStart().match(/^```/)){if(i){const m=c.join(`
`);l.push(`<pre><code${u?` class="language-${u}"`:""}>${F(m)}</code></pre>`),i=!1,c=[],u=""}else{i=!0;const m=g.trimStart().match(/^```(.*)$/);u=m?m[1].trim():"",c=[]}r++;continue}if(i){c.push(g),r++;continue}if(!g.trim()){r++;continue}const E=g.trimStart().match(/^(#{1,6})\s+(.+)$/);if(E){const m=E[1].length,v=E[2],D=N(v);l.push(`<h${m}>${D}</h${m}>`),r++;continue}const C=g.trimStart().match(/^>\s+(.+)$/);if(C){const m=C[1],v=N(m);l.push(`<blockquote>${v}</blockquote>`),r++;continue}const S=g.trimStart().match(/^[\*\-]\s+(.+)$/);if(S){const m=S[1],v=N(m);l.push(`<ul><li>${v}</li></ul>`),r++;continue}const M=g.trimStart().match(/^\d+\.\s+(.+)$/);if(M){const m=M[1],v=N(m);l.push(`<ol><li>${v}</li></ol>`),r++;continue}const I=N(g);l.push(`<p>${I}</p>`),r++}if(i&&c.length>0){const g=c.join(`
`);l.push(`<pre><code${u?` class="language-${u}"`:""}>${F(g)}</code></pre>`)}return l.join("")}function N(_){let n=_;const l=[],i="\0CODE";return n=n.replace(/`([^`]+)`/g,u=>{const c=l.length;return l.push(`<code>${F(u.slice(1,-1))}</code>`),`${i}${c}${i}`}),n=n.replace(/\[([^\]]+)\]\(([^\)]+)\)/g,(u,c,r)=>`<a href="${F(r)}" target="_blank" rel="noopener noreferrer">${c}</a>`),n=n.replace(/\*\*([^\*]+)\*\*/g,"<strong>$1</strong>"),n=n.replace(/~~([^~]+)~~/g,"<del>$1</del>"),n=n.replace(/\*([^\*\n]+)\*/g,"<em>$1</em>"),n=n.replace(/_([^_\n]+)_/g,"<em>$1</em>"),l.forEach((u,c)=>{n=n.replace(`${i}${c}${i}`,u)}),n}function F(_){const n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return _.replace(/[&<>"']/g,l=>n[l]||l)}const Ee=me(()=>fe(()=>import("./DbJJb6iD.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(_=>_.default||_)),Ce={class:"echo-container"},Me={class:"echo-toolbar"},Ie={class:"echo-search"},Se=["disabled","title"],ze=["href"],Te={key:0,class:"echo-heatmap-section"},De={class:"heatmap-header"},Le={class:"heatmap-title"},Be={class:"heatmap-content"},Pe={class:"heatmap-left"},Re={class:"heatmap-grid"},Ne=["title"],Oe={class:"heatmap-legend"},Ue={class:"legend-cells"},je={class:"heatmap-stats"},qe={class:"stat-item"},Ae={class:"stat-value"},Fe={class:"stat-item"},He={class:"stat-value"},We={class:"stat-item"},Ve={class:"stat-value"},Ge={key:1,class:"echo-loading"},Je={key:2,class:"echo-empty"},Ke={key:3,class:"echo-empty"},Qe={key:4,class:"echo-list"},Ze={class:"echo-time"},Xe=["innerHTML"],Ye={key:1,class:"echo-tags"},et=["href","title"],tt={key:2,class:"echo-extension"},st={class:"extension-label"},nt={class:"extension-type-text"},at=["href"],ot={class:"website-content"},lt={class:"website-title"},it={class:"website-url"},rt=["href"],ct={class:"extension-url"},dt={key:3,class:"echo-images"},ut=["onClick"],ht={class:"echo-card-footer"},pt={class:"echo-likes"},mt=["href"],ft={key:5,class:"echo-load-more"},_t=["disabled"],gt=10,vt=ie({__name:"echo",async setup(_){let n,l;const i=ge(),u=ve(),c=be();u.setAside(["blog-stats","blog-log"]),re({meta:[{name:"description",content:`${i?.title||"Echo"}的最新动态和短想法记录。`}]});const r=j(""),g=j(1),{data:E,pending:C,refresh:S}=([n,l]=X(()=>Y(`${A.echo.apiBase}${A.echo.apiEndpoint}?page=1&pageSize=100`,{watch:!1,default:()=>({data:{items:[]}})},"$h5c9zGxgMR")),n=await n,l(),n),{data:M,pending:I}=([n,l]=X(()=>Y(`${A.echo.apiBase}/api/heatmap`,{watch:!1,default:()=>({code:0,msg:"",data:[]})},"$cewwBWa4WN")),n=await n,l(),n),m=x(()=>{const s=E.value?.data?.items;return s?.length?s.filter(e=>!e.private).sort((e,o)=>new Date(o.created_at).getTime()-new Date(e.created_at).getTime()):[]}),v=j(!1),D=async()=>{if(!v.value){v.value=!0;try{g.value=1,r.value="",await S()}catch(s){console.error("Failed to refresh echos:",s)}finally{v.value=!1}}},L=x(()=>{const s=r.value.trim().toLowerCase();return s?m.value.filter(e=>{if(!e)return!1;const o=e.content?.toLowerCase()||"",b=e.username?.toLowerCase()||"";return o.includes(s)||b.includes(s)}):m.value}),O=x(()=>{const s=g.value*gt;return L.value.slice(0,s)}),H=x(()=>O.value.length<L.value.length),k=j(!1),W=async()=>{k.value||(k.value=!0,await new Promise(s=>setTimeout(s,300)),g.value++,k.value=!1)},J={GITHUBPROJ:{label:"GitHub 项目",icon:"mdi:github"},GITHUB:{label:"GitHub",icon:"mdi:github"},MUSIC:{label:"音乐",icon:"mdi:music"},WEBSITE:{label:"网站",icon:"mdi:globe"},LINK:{label:"链接",icon:"mdi:link"}},U=s=>J[s]||{label:s,icon:"mdi:link"},B=new Map,K=s=>{if(!s||typeof s!="string")return{title:"无效链接",site:"#",hostname:"无效链接"};if(B.has(s))return B.get(s);let e;try{const o=JSON.parse(s);if(!o||typeof o!="object")throw new Error("Invalid data structure");let b="",t=o.site||"";if(t)try{const f=new URL(t);if(f.protocol!=="http:"&&f.protocol!=="https:")throw new Error("Invalid protocol");b=f.hostname}catch{t="#",b="无效链接"}e={title:(o.title||"").toString().trim()||"无标题",site:t,hostname:b}}catch{e={title:"解析失败",site:"#",hostname:"解析失败"}}return B.set(s,e),e},te=(s,e)=>{try{const o=s.currentTarget||null;let b=null;if(o&&(b=o.querySelector("img")),!b&&e){if(!e.trim()||!e.startsWith("http://")&&!e.startsWith("https://")){console.warn("Invalid image source:",e);return}const f=new Image;f.src=e,b=f}if(!b){console.warn("No valid image element found for lightbox");return}const{open:t}=c.use(()=>pe(Ee,{el:b}));t()}catch(o){console.error("Failed to open image lightbox:",o)}},se=x(()=>O.value.map(s=>({...s,parsedExtension:s.extension&&s.extension_type==="WEBSITE"?K(s.extension):null}))),ne=(s,e)=>{if(s===0||e===0)return 0;const o=Math.ceil(s/e*4);return Math.min(o,4)},Q=x(()=>{const s=M.value?.data||[];if(s.length===0)return[];const e=Math.max(...s.map(o=>o.count),1);return s.map(o=>({date:o.date,count:o.count,level:ne(o.count,e)}))}),V=x(()=>{const s=M.value?.data||[];if(s.length===0)return{total:0,average:0,maxCount:0,maxDate:""};const e=s.reduce((t,f)=>t+f.count,0),o=Math.round(e/s.length),b=s.reduce((t,f)=>f.count>t.count?f:t);return{total:e,average:o,maxCount:b.count,maxDate:b.date}});return(s,e)=>{const o=ye,b=he;return p(),h("div",Ce,[a("div",Me,[a("div",Ie,[y(o,{name:"mdi:magnify",size:"20",class:"search-icon"}),ce(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>ue(r)?r.value=t:null),type:"text",placeholder:"搜索动态...",class:"search-input"},null,512),[[de,d(r)]])]),a("button",{disabled:d(v)||d(C),class:"echo-refresh-btn",title:d(v)?"刷新中...":"手动刷新动态",onClick:D},[y(o,{name:"mdi:refresh",size:"18",class:q({spin:d(v)})},null,8,["class"])],8,Se),a("a",{href:d(A).echo.rss,target:"_blank",rel:"noopener noreferrer",class:"echo-rss-btn",title:"订阅动态 RSS 源"},[y(o,{name:"mdi:rss",size:"18"})],8,ze)]),!d(I)&&d(Q).length>0?(p(),h("div",Te,[a("div",De,[a("h3",Le,[y(o,{name:"mdi:fire",size:"20"}),e[1]||(e[1]=G(" 热力图 ",-1))])]),a("div",Be,[a("div",Pe,[a("div",Re,[(p(!0),h(P,null,R(d(Q),t=>(p(),h("div",{key:t.date,class:q(["heatmap-cell",`heatmap-level-${t.level}`]),title:`${t.date}: ${t.count} 条动态`},null,10,Ne))),128))]),a("div",Oe,[e[2]||(e[2]=a("span",{class:"legend-label"},"少",-1)),a("div",Ue,[(p(),h(P,null,R(5,t=>a("div",{key:t,class:q(["legend-cell",`heatmap-level-${t-1}`])},null,2)),64))]),e[3]||(e[3]=a("span",{class:"legend-label"},"多",-1))])]),a("div",je,[a("div",qe,[e[4]||(e[4]=a("span",{class:"stat-label"},"总动态数",-1)),a("span",Ae,$(d(V).total),1)]),a("div",Fe,[e[5]||(e[5]=a("span",{class:"stat-label"},"日均动态",-1)),a("span",He,$(d(V).average),1)]),a("div",We,[e[6]||(e[6]=a("span",{class:"stat-label"},"单日最多",-1)),a("span",Ve,$(d(V).maxCount),1)])])])])):z("",!0),d(C)?(p(),h("div",Ge,[y(o,{name:"eos-icons:loading",size:"32"}),e[7]||(e[7]=a("p",null,"加载中...",-1))])):d(m).length===0?(p(),h("div",Je,[y(o,{name:"solar:inbox-line-duotone",size:"48"}),e[8]||(e[8]=a("p",null,"暂无动态",-1))])):d(L).length===0?(p(),h("div",Ke,[y(o,{name:"solar:magnifer-line-duotone",size:"48"}),e[9]||(e[9]=a("p",null,"未找到匹配的动态",-1))])):(p(),h("div",Qe,[(p(!0),h(P,null,R(d(se),t=>(p(),h("article",{key:t.id,class:"echo-card card"},[a("div",Ze,[y(o,{name:"ph:calendar-dots-bold",size:"18"}),a("span",null,$(d($e)(t.created_at)),1)]),t.content?(p(),h("div",{key:0,class:"echo-card-content",innerHTML:d(we)(t.content)},null,8,Xe)):z("",!0),t.tags?.length?(p(),h("div",Ye,[(p(!0),h(P,null,R(t.tags,f=>(p(),h("a",{key:f.id,href:`https://echo.sotkg.com/?tag=${encodeURIComponent(f.name)}`,target:"_blank",rel:"noopener noreferrer",class:"echo-tag",title:`使用数: ${f.usage_count}`}," #"+$(f.name),9,et))),128))])):z("",!0),t.extension&&t.extension_type?(p(),h("div",tt,[a("div",st,[e[10]||(e[10]=G(" 分享了 ",-1)),a("span",nt,$(U(t.extension_type).label),1)]),t.extension_type==="WEBSITE"&&t.parsedExtension?(p(),h("a",{key:0,href:t.parsedExtension.site,target:"_blank",rel:"noopener noreferrer",class:"extension-link website-link"},[y(o,{name:U(t.extension_type).icon,size:"20"},null,8,["name"]),a("div",ot,[a("div",lt,$(t.parsedExtension.title),1),a("div",it,$(t.parsedExtension.hostname),1)]),y(o,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,at)):(p(),h("a",{key:1,href:t.extension,target:"_blank",rel:"noopener noreferrer",class:"extension-link"},[y(o,{name:U(t.extension_type).icon,size:"20"},null,8,["name"]),a("span",ct,$(t.extension),1),y(o,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,rt))])):z("",!0),t.images?.length?(p(),h("div",dt,[(p(!0),h(P,null,R(t.images,(f,Z)=>(p(),h("button",{key:Z,class:"echo-image-button",onClick:ae=>te(ae,f.image_url)},[y(b,{src:f.image_url,alt:`Echo image ${Z+1}`,class:"echo-image",loading:"lazy",fit:"cover"},null,8,["src","alt"])],8,ut))),128))])):z("",!0),a("div",ht,[a("span",pt,[y(o,{name:"mdi:heart",size:"16"}),G(" "+$(t.fav_count),1)]),a("a",{href:`https://echo.sotkg.com/echo/${t.id}`,target:"_blank",class:"echo-read-more"}," 查看原文 → ",8,mt)])]))),128))])),d(H)?(p(),h("div",ft,[a("button",{class:"load-more-btn",disabled:d(k),onClick:W},[y(o,{name:d(k)?"eos-icons:loading":"mdi:chevron-down",size:"20",class:q({spin:d(k)})},null,8,["name","class"]),a("span",null,$(d(k)?"装填中...":"继续装填"),1)],8,_t)])):z("",!0)])}}}),wt=_e(vt,[["__scopeId","data-v-4d29e43a"]]);export{wt as default};
