import{c as E,_ as $}from"./Bq-kMo6g.js";import{_ as M}from"./Dch6Byx5.js";import{J as w,r as f,N as C,aM as D,aN as n,aT as H,Q as a,b5 as i,K as d,aR as u,aU as y,aV as T,aQ as h,b8 as p,b4 as S}from"./D6ajeznB.js";import"./D-deoX8n.js";const U={key:0,class:"echo-loading"},z={key:1,class:"echo-error"},G={key:2,class:"echo-empty"},V={key:3,class:"echo-list"},W=["href","title"],J={class:"echo-header"},L={class:"echo-content"},O={class:"echo-text"},R={class:"echo-meta"},A={key:0,class:"echo-tags"},F=["title"],K={class:"echo-time"},P={key:0,class:"echo-thumbnail"},Q=["src","alt"],j=w({__name:"EchoTrend",setup(Z){const b=E(),m=f([]),_=f(!1),g=f(!1);async function k(){_.value=!0;try{const{echo:s}=b,e=await $fetch(`${s.apiBase}${s.apiEndpoint}?page=1&pageSize=3`);if(e?.data?.items){const c=e.data.items;m.value=c.filter(r=>!r.private).sort((r,t)=>{try{const o=new Date(r.created_at),l=new Date(t.created_at);return Number.isNaN(o.getTime())||Number.isNaN(l.getTime())?0:l.getTime()-o.getTime()}catch(o){return console.error(`Invalid date comparison: ${r.created_at}, ${t.created_at}`,o),0}}).slice(0,3)}}catch(s){console.error("Failed to fetch echos:",s),g.value=!0}finally{_.value=!1}}function x(s){try{const e=new Date(s);if(Number.isNaN(e.getTime()))return"无效时间";const r=new Date().getTime()-e.getTime(),t=Math.floor(r/1e3),o=Math.floor(t/60),l=Math.floor(o/60),v=Math.floor(l/24);return t<60?"刚刚":o<60?`${o}分钟前`:l<24?`${l}小时前`:v<7?`${v}天前`:e.toLocaleDateString("zh-CN")}catch(e){return console.error(`Invalid date format: ${s}`,e),"无效时间"}}function N(s,e=60){return s?s.length>e?`${s.slice(0,e)}...`:s:"[无内容]"}function I(s){switch(s){case"GITHUBPROJ":case"GITHUB":return{icon:"mdi:github",color:"var(--c-text-2)"};case"MUSIC":return{icon:"mdi:music",color:"var(--c-primary)"};case"WEBSITE":return{icon:"mdi:globe",color:"var(--c-text-2)"};default:return{icon:"mdi:link",color:"var(--c-text-2)"}}}function B(s){return{GITHUBPROJ:"GitHub 项目",GITHUB:"GitHub",MUSIC:"音乐",WEBSITE:"网站",LINK:"链接"}[s||""]||s||""}return C(()=>{k()}),(s,e)=>{const c=$,r=M;return n(),D(r,{card:"",title:"最新动态"},{default:H(()=>[d(_)?(n(),a("div",U,[u(c,{name:"eos-icons:loading",size:"16",class:"spin"}),e[0]||(e[0]=i("span",null,"加载中...",-1))])):d(g)?(n(),a("div",z,[u(c,{name:"mdi:alert-circle",size:"16"}),e[1]||(e[1]=i("span",null,"加载失败",-1))])):d(m).length===0?(n(),a("div",G,[u(c,{name:"mdi:inbox",size:"16"}),e[2]||(e[2]=i("span",null,"暂无动态",-1))])):(n(),a("div",V,[(n(!0),a(y,null,T(d(m),t=>(n(),a("a",{key:t.id,href:`https://echo.sotkg.com/echo/${t.id}`,target:"_blank",rel:"noopener noreferrer",class:"echo-item",title:t.content},[i("div",J,[i("div",L,[i("div",O,p(N(t.content,40)),1),i("div",R,[t.tags&&t.tags.length>0?(n(),a("div",A,[(n(!0),a(y,null,T(t.tags.slice(0,1),o=>(n(),a("span",{key:o.id,class:"echo-tag"}," #"+p(o.name),1))),128))])):h("",!0),t.extension_type?(n(),a("span",{key:1,class:"echo-extension-badge",title:B(t.extension_type)},[u(c,{name:I(t.extension_type).icon,size:"14"},null,8,["name"])],8,F)):h("",!0)])]),i("div",K,p(x(t.created_at)),1)]),t.images?.[0]?(n(),a("div",P,[i("img",{src:t.images[0].image_url,alt:t.content},null,8,Q)])):h("",!0)],8,W))),128))])),e[3]||(e[3]=i("div",{class:"echo-footer"},[i("a",{href:"/echo",class:"echo-link"},"查看更多 →")],-1))]),_:1})}}}),te=Object.assign(S(j,[["__scopeId","data-v-8a00eda0"]]),{__name:"WidgetEchoTrend"});export{te as default};
