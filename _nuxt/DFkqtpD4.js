import{z as $,y as C,r as _,o as w,aJ as z,Q as D,e as o,w as M,d as a,h as r,L as d,g as u,J as S,F as v,P as T,E as H,f as g,t as h,_ as G}from"./DQ-hAR1N.js";import{_ as U}from"./D649NT6w.js";const F={key:0,class:"echo-loading"},L={key:1,class:"echo-error"},Y={key:2,class:"echo-empty"},J={key:3,class:"echo-list"},W=["href","title"],O={class:"echo-header"},P={class:"echo-content"},V={class:"echo-text"},A={class:"echo-meta"},R={key:0,class:"echo-tags"},j={class:"echo-time"},K=["title"],Q={key:0,class:"echo-thumbnail"},q=["src","alt"],X=$({__name:"EchoTrend",setup(Z){const x=C(),m=_([]),f=_(!1),p=_(!1);async function k(){f.value=!0;try{const{echo:n}=x,e=await $fetch(`${n.apiBase}${n.apiEndpoint}?page=1&pageSize=3`,{timeout:1e4,retry:3,retryDelay:1e3});if(e?.data?.items){const i=e.data.items;m.value=i.filter(c=>!c.private).slice(0,3).sort((c,t)=>{try{const s=new Date(c.created_at),l=new Date(t.created_at);return Number.isNaN(s.getTime())||Number.isNaN(l.getTime())?0:l.getTime()-s.getTime()}catch(s){return console.error(`Invalid date comparison: ${c.created_at}, ${t.created_at}`,s),0}})}}catch(n){console.error("Failed to fetch echos:",n),p.value=!0}finally{f.value=!1}}function b(n){try{const e=new Date(n);if(Number.isNaN(e.getTime()))return"无效时间";const i=new Date,c=i.getTime()-e.getTime();if(c<0)return"刚刚";const t=Math.floor(c/1e3),s=Math.floor(t/60),l=Math.floor(s/60),y=Math.floor(l/24);if(t<10)return"刚刚";if(t<60)return`${t}秒前`;if(s<60)return`${s}分钟前`;if(l<24)return`${l}小时前`;if(y<7)return`${y}天前`;const I=i.getFullYear();return e.getFullYear()===I?e.toLocaleDateString("zh-CN",{month:"short",day:"numeric"}):e.toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"})}catch(e){return console.error(`Invalid date format: ${n}`,e),"无效时间"}}function N(n,e=60){return n?n.length>e?`${n.slice(0,e)}...`:n:"[无内容]"}function B(n){switch(n){case"GITHUBPROJ":case"GITHUB":return{icon:"mdi:github",color:"var(--c-text-2)"};case"MUSIC":return{icon:"mdi:music",color:"var(--c-primary)"};case"WEBSITE":return{icon:"mdi:globe",color:"var(--c-text-2)"};default:return{icon:"mdi:link",color:"var(--c-text-2)"}}}function E(n){return{GITHUBPROJ:"GitHub 项目",GITHUB:"GitHub",MUSIC:"音乐",WEBSITE:"网站",LINK:"链接"}[n||""]||n||""}return w(()=>{z(()=>{k()})}),(n,e)=>{const i=S,c=U;return o(),D(c,{card:"",title:"最新动态"},{default:M(()=>[d(f)?(o(),a("div",F,[u(i,{name:"eos-icons:loading",size:"16",class:"spin"}),e[1]||(e[1]=r("span",null,"加载中...",-1))])):d(p)?(o(),a("div",L,[u(i,{name:"mdi:alert-circle",size:"16"}),e[2]||(e[2]=r("span",null,"加载失败",-1))])):d(m).length===0?(o(),a("div",Y,[u(i,{name:"mdi:inbox",size:"16"}),e[3]||(e[3]=r("span",null,"暂无动态",-1))])):(o(),a("div",J,[(o(!0),a(v,null,T(d(m),t=>(o(),a("a",{key:t.id,href:`${d(H).echo.apiBase}/echo/${t.id}`,target:"_blank",rel:"noopener noreferrer",class:"echo-item",title:t.content},[r("div",O,[r("div",P,[r("div",V,h(N(t.content,40)),1),r("div",A,[t.tags&&t.tags.length>0?(o(),a("div",R,[(o(!0),a(v,null,T(t.tags.slice(0,1),s=>(o(),a("span",{key:s.id,class:"echo-tag"}," #"+h(s.name),1))),128))])):g("",!0),r("span",j,h(b(t.created_at)),1),t.extension_type?(o(),a("span",{key:1,class:"echo-extension-badge",title:E(t.extension_type)},[u(i,{name:B(t.extension_type).icon,size:"14"},null,8,["name"])],8,K)):g("",!0)])])]),t.images?.[0]?(o(),a("div",Q,[r("img",{src:t.images[0].image_url,alt:t.content,loading:"lazy",onError:e[0]||(e[0]=s=>s.target.style.display="none")},null,40,q)])):g("",!0)],8,W))),128))])),e[4]||(e[4]=r("div",{class:"echo-footer"},[r("a",{href:"/echo",class:"echo-link"},"查看更多 →")],-1))]),_:1})}}}),se=Object.assign(G(X,[["__scopeId","data-v-3411412a"]]),{__name:"WidgetEchoTrend"});export{se as default};
