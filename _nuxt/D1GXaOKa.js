import{U as L,V as X,t as Y,_ as Z}from"./3o_v7iT2.js";import{J as tt,x as D,r as et,bd as nt,N as ot,Q as G,aN as M,aQ as F,b5 as H,K as I,b8 as Q,aR as U,b4 as st}from"./D6ajeznB.js";function at(e,n){let t=0;for(;t<e.length;t++){const{text:r,ranges:i}=n[t]??{};if(e[t]!==r||i?.some(f=>f.collapsed))break}let o=e.length-1,a=n.length-1;for(;o>=0&&a>=0;o--,a--){const{text:r,ranges:i}=n[a]??{};if(e[o]!==r||i?.some(f=>f.collapsed))break}return t>o&&([t,o]=[o,t]),t=Math.max(0,t),o=Math.min(e.length-1,o)+1,e.length===n.length&&t+1===o?[t,o]:rt(e,t,o)}function rt(e,n,t){const o=a(Math.max(0,n+t-e.length));n-=o,t+=o;function a(u){const c=e.slice(0,n).indexOf(e[t],u);if(c===-1)return 0;for(let l=c,s=t;l<n-1;s++,l++)if(e[l+1]!==e[s+1])return a(u+1);return n-c}const r=e.join(`
`),i=e.slice(0,n).join(`
`).length,f=e.slice(0,t).join(`
`).length;let p=0;for(let u=n-1,c=f-1;u<t&&c>=i;u--){const l=e[u],s=r.lastIndexOf(l,c);if(s!==-1&&s>=i)p++,c=s-1;else break}let x=0;for(let u=t,c=i;u>=n&&c<f;u++){const l=e[u],s=r.indexOf(l,c);if(s!==-1&&s<f)x++,c=s+1;else break}return[n-p,t+x]}function lt(e,n){let t=0,o;return function(...a){o&&(clearTimeout(o),o=void 0);const r=performance.now();!t||r-t>=n?(e.apply(this,a),t=r):o=setTimeout(()=>{e.apply(this,a),t=performance.now(),o=void 0},n+t-r)}}function ct(e){let n=!1;return function(...t){return n?!1:(n=!0,e.apply(this,t),!0)}}function it(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0}function ft(e){return{mount:n};function n(t,o){const{lang:a,themes:r={light:"min-light",dark:"min-dark"},defaultTheme:i="light",selector:f=m=>`.${m}`,defaultSelector:p=":root",watch:x=!0,delay:u=33.4}=o,c=new CSSStyleSheet;document.adoptedStyleSheets.push(c);const l=new Map,s=[];function y(m){for(const{range:d,name:k}of m)CSS.highlights.get(k)?.delete(d),l.get(k)?.delete(d)}function C(m){for(const{range:d,color:k,theme:S,name:g}of m){const v=S===i;let _=CSS.highlights.get(g);_||(CSS.highlights.set(g,_=new Highlight),_.priority=v?0:1);let w=l.get(g);if(!w){l.set(g,w=new Set);const b=`${v?p:f(S)}::highlight(${g}) { color: ${k}; }`;c.insertRule(b)}_.add(d),w.add(d)}}const O=lt(()=>{const{innerText:m}=t,d=m.split(`
`),k=ut(t),[S,g]=at(d,s),v=g-d.length+s.length,_=s.splice(v);for(let h=S;h<v;h++)y(s[h].info);const w=s.at(-1)?.lastGrammarState;s.length=g-1,s.fill(null,S,g-1),s.push(dt({lastGrammarState:w}),..._);let b=d.slice(0,S).reduce((h,T)=>h+T.length+1,0);const R=pt(m,k,b);for(let h=S;h<d.length;h++){const T=d[h],$=s[h],j=e.codeToTokens(T,{lang:a,themes:r,cssVariablePrefix:"",defaultColor:!1,grammarState:s[h-1]?.lastGrammarState}),V=[],B=[];for(const N of j.tokens[0]){if(!N.content.trim().length)continue;const[q,z]=R(b+N.offset),[J,K]=R(b+N.offset+N.content.length),E=document.createRange();E.setStart(q,z),E.setEnd(J,K),V.push(E),B.push(...ht(N,E))}$&&y($.info),C(B);const P=$?.lastGrammarState?.getScopes(),A=j.grammarState?.getScopes(),W=P&&A&&it(P,A);if(s[h]={text:T,offset:b,lastGrammarState:j.grammarState,ranges:V,info:B},!W)b+=T.length+1;else break}},u);return x&&t.addEventListener("input",O),O(),{dispose:ct(()=>{x&&t.removeEventListener("input",O);const m=document.adoptedStyleSheets.indexOf(c);document.adoptedStyleSheets.splice(m,1);for(const[d,k]of l){const S=CSS.highlights.get(d);for(const g of k)S?.delete(g)}}),update:O}}}function ut(e){const n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),t=[];let o;for(;o=n.nextNode();)t.push(o);return t}function dt(e={}){return{text:"",offset:0,lastGrammarState:void 0,ranges:[],info:[],...e}}function*ht(e,n){if(typeof e.htmlStyle=="object")for(const t in e.htmlStyle){const o=e.htmlStyle[t],a=`shiki-${t}-${o.slice(1).toLowerCase()}`;yield{range:n,color:o,theme:t,name:a}}}function pt(e,n,t){let o=0,a=0,r=!1;return t>0&&i(t),i;function i(f){for(;o<n.length;o++){const{textContent:p}=n[o];if(p)if(r||(a=e.indexOf(p,a),r=!0),a+p.length<f)a+=p.length,r=!1;else break}return[n[o],f-a]}}const gt={class:"copy"},mt={key:0,class:"prompt"},St=["textContent"],kt=tt({__name:"Copy",props:{prompt:{type:[String,Boolean],default:"$"},code:{},lang:{}},setup(e){const n=e,t=D(()=>n.prompt!==!0),o=D(()=>n.lang??L(n.prompt)),a=et(!1),r=nt("code-input"),i=X(),{copy:f,copied:p}=Y(r);function x(){r.value&&(r.value.textContent=n.code??"",r.value.dispatchEvent(new Event("input")),a.value=!1)}function u(l){const{data:s,inputType:y}=l;(s?.includes(`
`)||y==="insertLineBreak")&&l.preventDefault()}function c(l){a.value=n.code!==l.target.textContent}return ot(async()=>{const l=await i.load();await i.loadLang(o.value),ft(l).mount(r.value,i.getOptions(o.value))}),(l,s)=>{const y=Z;return M(),G("code",gt,[I(t)?(M(),G("span",mt,Q(e.prompt),1)):F("",!0),H("div",{ref:"code-input",contenteditable:"plaintext-only",class:"code scrollcheck-x",spellcheck:"false",onBeforeinput:s[0]||(s[0]=C=>u(C)),onInput:s[1]||(s[1]=C=>c(C)),textContent:Q(e.code)},null,40,St),I(a)?(M(),G("button",{key:1,class:"operation","aria-label":"恢复原始内容",onClick:x},[U(y,{name:"ph:arrow-u-up-left-bold"})])):F("",!0),H("button",{class:"operation","aria-label":"复制",onClick:s[2]||(s[2]=C=>I(f)())},[U(y,{name:I(p)?"ph:check-bold":"ph:copy-bold"},null,8,["name"])])])}}}),bt=Object.assign(st(kt,[["__scopeId","data-v-3fcf4efe"]]),{__name:"Copy"});export{bt as default};
