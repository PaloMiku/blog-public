import{c as M,t as $,r as W,f as K,i as Q,d as Z,u as X,a as Y,b as ee,e as H,w as te,g as se,h as p,o as m,j as a,k as P,l as y,m as ne,_ as oe,v as ie,n as b,p as re,q as ae,s as le,F as C,x as J,y as x,z as F,I as ce,A as ue,B as he}from"#entry";import{u as de}from"./CBZn_wPm.js";import{L as fe}from"./DLesPaFG.js";function pe(u){return typeof u=="string"?`'${u}'`:new me().serialize(u)}const me=(function(){class u{#e=new Map;compare(e,t){const n=typeof e,o=typeof t;return n==="string"&&o==="string"?e.localeCompare(t):n==="number"&&o==="number"?e-t:String.prototype.localeCompare.call(this.serialize(e,!0),this.serialize(t,!0))}serialize(e,t){if(e===null)return"null";switch(typeof e){case"string":return t?e:`'${e}'`;case"bigint":return`${e}n`;case"object":return this.$object(e);case"function":return this.$function(e)}return String(e)}serializeObject(e){const t=Object.prototype.toString.call(e);if(t!=="[object Object]")return this.serializeBuiltInType(t.length<10?`unknown:${t}`:t.slice(8,-1),e);const n=e.constructor,o=n===Object||n===void 0?"":n.name;if(o!==""&&globalThis[o]===n)return this.serializeBuiltInType(o,e);if(typeof e.toJSON=="function"){const i=e.toJSON();return o+(i!==null&&typeof i=="object"?this.$object(i):`(${this.serialize(i)})`)}return this.serializeObjectEntries(o,Object.entries(e))}serializeBuiltInType(e,t){const n=this["$"+e];if(n)return n.call(this,t);if(typeof t?.entries=="function")return this.serializeObjectEntries(e,t.entries());throw new Error(`Cannot serialize ${e}`)}serializeObjectEntries(e,t){const n=Array.from(t).sort((i,g)=>this.compare(i[0],g[0]));let o=`${e}{`;for(let i=0;i<n.length;i++){const[g,d]=n[i];o+=`${this.serialize(g,!0)}:${this.serialize(d)}`,i<n.length-1&&(o+=",")}return o+"}"}$object(e){let t=this.#e.get(e);return t===void 0&&(this.#e.set(e,`#${this.#e.size}`),t=this.serializeObject(e),this.#e.set(e,t)),t}$function(e){const t=Function.prototype.toString.call(e);return t.slice(-15)==="[native code] }"?`${e.name||""}()[native]`:`${e.name}(${e.length})${t.replace(/\s*\n\s*/g,"")}`}$Array(e){let t="[";for(let n=0;n<e.length;n++)t+=this.serialize(e[n]),n<e.length-1&&(t+=",");return t+"]"}$Date(e){try{return`Date(${e.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(e){return`ArrayBuffer[${new Uint8Array(e).join(",")}]`}$Set(e){return`Set${this.$Array(Array.from(e).sort((t,n)=>this.compare(t,n)))}`}$Map(e){return this.serializeObjectEntries("Map",e.entries())}}for(const s of["Error","RegExp","URL"])u.prototype["$"+s]=function(e){return`${s}(${e})`};for(const s of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])u.prototype["$"+s]=function(e){return`${s}[${e.join(",")}]`};for(const s of["BigInt64Array","BigUint64Array"])u.prototype["$"+s]=function(e){return`${s}[${e.join("n,")}${e.length>0?"n":""}]`};return u})(),ye=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],ge=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],_e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",I=[];class be{_data=new D;_hash=new D([...ye]);_nDataBytes=0;_minBufferSize=0;finalize(s){s&&this._append(s);const e=this._nDataBytes*8,t=this._data.sigBytes*8;return this._data.words[t>>>5]|=128<<24-t%32,this._data.words[(t+64>>>9<<4)+14]=Math.floor(e/4294967296),this._data.words[(t+64>>>9<<4)+15]=e,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(s,e){const t=this._hash.words;let n=t[0],o=t[1],i=t[2],g=t[3],d=t[4],A=t[5],z=t[6],_=t[7];for(let f=0;f<64;f++){if(f<16)I[f]=s[e+f]|0;else{const w=I[f-15],v=(w<<25|w>>>7)^(w<<14|w>>>18)^w>>>3,k=I[f-2],S=(k<<15|k>>>17)^(k<<13|k>>>19)^k>>>10;I[f]=v+I[f-7]+S+I[f-16]}const T=d&A^~d&z,U=n&o^n&i^o&i,L=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),E=(d<<26|d>>>6)^(d<<21|d>>>11)^(d<<7|d>>>25),B=_+E+T+ge[f]+I[f],j=L+U;_=z,z=A,A=d,d=g+B|0,g=i,i=o,o=n,n=B+j|0}t[0]=t[0]+n|0,t[1]=t[1]+o|0,t[2]=t[2]+i|0,t[3]=t[3]+g|0,t[4]=t[4]+d|0,t[5]=t[5]+A|0,t[6]=t[6]+z|0,t[7]=t[7]+_|0}_append(s){typeof s=="string"&&(s=D.fromUtf8(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes}_process(s){let e,t=this._data.sigBytes/64;s?t=Math.ceil(t):t=Math.max((t|0)-this._minBufferSize,0);const n=t*16,o=Math.min(n*4,this._data.sigBytes);if(n){for(let i=0;i<n;i+=16)this._doProcessBlock(this._data.words,i);e=this._data.words.splice(0,n),this._data.sigBytes-=o}return new D(e,o)}}class D{words;sigBytes;constructor(s,e){s=this.words=s||[],this.sigBytes=e===void 0?s.length*4:e}static fromUtf8(s){const e=unescape(encodeURIComponent(s)),t=e.length,n=[];for(let o=0;o<t;o++)n[o>>>2]|=(e.charCodeAt(o)&255)<<24-o%4*8;return new D(n,t)}toBase64(){const s=[];for(let e=0;e<this.sigBytes;e+=3){const t=this.words[e>>>2]>>>24-e%4*8&255,n=this.words[e+1>>>2]>>>24-(e+1)%4*8&255,o=this.words[e+2>>>2]>>>24-(e+2)%4*8&255,i=t<<16|n<<8|o;for(let g=0;g<4&&e*8+g*6<this.sigBytes*8;g++)s.push(_e.charAt(i>>>6*(3-g)&63))}return s.join("")}concat(s){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let e=0;e<s.sigBytes;e++){const t=s.words[e>>>2]>>>24-e%4*8&255;this.words[this.sigBytes+e>>>2]|=t<<24-(this.sigBytes+e)%4*8}else for(let e=0;e<s.sigBytes;e+=4)this.words[this.sigBytes+e>>>2]=s.words[e>>>2];this.sigBytes+=s.sigBytes}}function we(u){return new be().finalize(u).toBase64()}function O(u){return we(pe(u))}function ve(u,s,e){const[t={},n]=typeof s=="string"?[{},s]:[s,e],o=M(()=>$(u)),i=M(()=>$(t.key)||"$f"+O([n,typeof o.value=="string"?o.value:"",...xe(t)]));if(!t.baseURL&&typeof o.value=="string"&&o.value[0]==="/"&&o.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:g,lazy:d,default:A,transform:z,pick:_,watch:f,immediate:T,getCachedData:U,deep:L,dedupe:E,...B}=t,j=W({...K,...B,cache:typeof t.cache=="boolean"?void 0:t.cache}),w={server:g,lazy:d,default:A,transform:z,pick:_,immediate:T,getCachedData:U,deep:L,dedupe:E,watch:f===!1?[]:[...f||[],j]};let v;return de(f===!1?i.value:i,()=>{v?.abort?.(new DOMException("Request aborted as another request to the same endpoint was initiated.","AbortError")),v=typeof AbortController<"u"?new AbortController:{};const S=$(t.timeout);let c;return S&&(c=setTimeout(()=>v.abort(new DOMException("Request aborted due to timeout.","AbortError")),S),v.signal.onabort=()=>clearTimeout(c)),(t.$fetch||globalThis.$fetch)(o.value,{signal:v.signal,...j}).finally(()=>{clearTimeout(c)})},w)}function xe(u){const s=[$(u.method)?.toUpperCase()||"GET",$(u.baseURL)];for(const e of[u.params||u.query]){const t=$(e);if(!t)continue;const n={};for(const[o,i]of Object.entries(t))n[$(o)]=$(i);s.push(n)}if(u.body){const e=$(u.body);if(!e)s.push(O(e));else if(e instanceof ArrayBuffer)s.push(O(Object.fromEntries([...new Uint8Array(e).entries()].map(([t,n])=>[t,n.toString()]))));else if(e instanceof FormData){const t={};for(const n of e.entries()){const[o,i]=n;t[o]=i instanceof File?i.name:i}s.push(O(t))}else if(Q(e))s.push(O(W(e)));else try{s.push(O(e))}catch{console.warn("[useFetch] Failed to hash body",e)}}return s}const $e={class:"echo-container"},ze={class:"echo-toolbar"},Be={class:"echo-search"},ke=["disabled","title"],Se=["href"],Ae={key:0,class:"echo-loading"},Ee={key:1,class:"echo-empty"},je={key:2,class:"echo-empty"},Ce={key:3,class:"timeline echo-timeline"},Ie={class:"timeline-caption echo-time-caption"},Oe={class:"timeline-body echo-card card"},Me={key:0,class:"echo-card-content"},De={key:1,class:"echo-extension"},Te=["href"],Ue={class:"extension-url"},Le=["href"],Re={class:"extension-url"},Fe=["href"],Ne={class:"website-content"},Ge={class:"website-title"},Pe={class:"website-url"},qe={class:"extension-label"},He={class:"extension-type-text"},Ve=["href"],Je={class:"extension-url"},We={key:2,class:"echo-images"},Ke=["onClick"],Qe={class:"echo-card-footer"},Ze={class:"echo-likes"},Xe=["href"],Ye={key:4,class:"echo-load-more"},et=10,tt=Z({__name:"echo",async setup(u){let s,e;const t=X();Y().setAside(["blog-stats","blog-log"]),ee({title:"动态",meta:[{name:"description",content:`${t.title}的最新动态和短想法记录。`}]});const o=H(""),i=H(1),{data:g,pending:d,error:A,refresh:z}=([s,e]=te(()=>ve("/api/echo",{watch:!1},"$h5c9zGxgMR")),s=await s,e(),s),_=H(!1),f=async()=>{if(!_.value){_.value=!0;try{i.value=1,o.value="",await z()}finally{_.value=!1}}},T=c=>{const h=new Date().getTime()-c.getTime(),N=Math.floor(h/1e3),l=Math.floor(N/60),G=Math.floor(l/60),R=Math.floor(G/24);if(N<60)return"刚刚";if(l<60)return`${l}分钟前`;if(G<24)return`${G}小时前`;if(R<7)return`${R}天前`;const V=["周日","周一","周二","周三","周四","周五","周六"][c.getDay()];return`${c.toLocaleDateString("zh-CN")} ${V}`},U=se(),L=c=>{const r=new Image;r.src=c;const{open:h}=U.use(()=>ue(fe,{el:r}));h()},E=M(()=>g.value?.map(c=>({...c,relativeTime:T(new Date(c.created_at))}))||[]),B=M(()=>{if(!o.value.trim())return E.value;const c=o.value.toLowerCase();return E.value.filter(r=>r.content.toLowerCase().includes(c)||r.username.toLowerCase().includes(c))}),j=M(()=>{const r=i.value*et;return B.value.slice(0,r)}),w=M(()=>j.value.length<B.value.length),v=()=>{i.value++},k=c=>({GITHUBPROJ:"GitHub 项目",GITHUB:"GitHub",MUSIC:"音乐",LINK:"链接",WEBSITE:"网站"})[c]||c,S=c=>{try{const r=JSON.parse(c);return{title:r.title||"",site:r.site||"",hostname:new URL(r.site).hostname||r.site}}catch{return{title:c,site:"#",hostname:c}}};return(c,r)=>{const h=oe,N=ce;return m(),p("div",$e,[a("div",ze,[a("div",Be,[y(h,{name:"mdi:magnify",size:"20",class:"search-icon"}),ne(a("input",{"onUpdate:modelValue":r[0]||(r[0]=l=>re(o)?o.value=l:null),type:"text",placeholder:"搜索动态...",class:"search-input"},null,512),[[ie,b(o)]])]),a("button",{disabled:b(_)||b(d),class:"echo-refresh-btn",title:b(_)?"刷新中...":"手动刷新动态",onClick:f},[y(h,{name:"mdi:refresh",size:"18",class:ae({spin:b(_)})},null,8,["class"])],8,ke),a("a",{href:b(le).echo.rss,target:"_blank",rel:"noopener noreferrer",class:"echo-rss-btn",title:"订阅动态 RSS 源"},[y(h,{name:"mdi:rss",size:"18"})],8,Se)]),b(d)?(m(),p("div",Ae,[y(h,{name:"eos-icons:loading",size:"32"}),r[1]||(r[1]=a("p",null,"加载中...",-1))])):b(E).length===0?(m(),p("div",Ee,[y(h,{name:"solar:inbox-line-duotone",size:"48"}),r[2]||(r[2]=a("p",null,"暂无动态",-1))])):b(B).length===0?(m(),p("div",je,[y(h,{name:"solar:magnifer-line-duotone",size:"48"}),r[3]||(r[3]=a("p",null,"未找到匹配的动态",-1))])):(m(),p("dl",Ce,[(m(!0),p(C,null,J(b(j),(l,G)=>(m(),p(C,{key:l.id},[a("dt",Ie,[a("span",null,x(l.relativeTime),1)]),a("dd",Oe,[l.content?(m(),p("div",Me,x(l.content),1)):P("",!0),l.extension&&l.extension_type?(m(),p("div",De,[l.extension_type==="GITHUBPROJ"?(m(),p(C,{key:0},[r[4]||(r[4]=a("div",{class:"extension-label"},[F(" 分享了 "),a("span",{class:"extension-type-text"},"GitHub 项目")],-1)),a("a",{href:l.extension,target:"_blank",rel:"noopener noreferrer",class:"extension-link"},[y(h,{name:"mdi:github",size:"20"}),a("span",Ue,x(l.extension),1),y(h,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,Te)],64)):l.extension_type==="MUSIC"?(m(),p(C,{key:1},[r[5]||(r[5]=a("div",{class:"extension-label"},[F(" 分享了 "),a("span",{class:"extension-type-text"},"音乐")],-1)),a("a",{href:l.extension,target:"_blank",rel:"noopener noreferrer",class:"extension-link"},[y(h,{name:"mdi:music",size:"20"}),a("span",Re,x(l.extension),1),y(h,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,Le)],64)):l.extension_type==="WEBSITE"?(m(),p(C,{key:2},[r[6]||(r[6]=a("div",{class:"extension-label"},[F(" 分享了 "),a("span",{class:"extension-type-text"},"网站")],-1)),a("a",{href:S(l.extension).site,target:"_blank",rel:"noopener noreferrer",class:"extension-link website-link"},[y(h,{name:"mdi:globe",size:"20"}),a("div",Ne,[a("div",Ge,x(S(l.extension).title),1),a("div",Pe,x(S(l.extension).hostname),1)]),y(h,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,Fe)],64)):(m(),p(C,{key:3},[a("div",qe,[r[7]||(r[7]=F(" 分享了 ",-1)),a("span",He,x(k(l.extension_type)),1)]),a("a",{href:l.extension,target:"_blank",rel:"noopener noreferrer",class:"extension-link"},[y(h,{name:"mdi:link",size:"20"}),a("span",Je,x(l.extension),1),y(h,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,Ve)],64))])):P("",!0),l.images&&l.images.length>0?(m(),p("div",We,[(m(!0),p(C,null,J(l.images,(R,q)=>(m(),p("button",{key:q,class:"echo-image-button",onClick:V=>L(R.image_url)},[y(N,{src:R.image_url,alt:`Echo image ${q+1}`,class:"echo-image",loading:"lazy",fit:"cover"},null,8,["src","alt"])],8,Ke))),128))])):P("",!0),a("div",Qe,[a("span",Ze,[y(h,{name:"mdi:heart",size:"16"}),F(" "+x(l.fav_count),1)]),a("a",{href:`https://memo.sotkg.com/echo/${l.id}`,target:"_blank",class:"echo-read-more"}," 查看 → ",8,Xe)])])],64))),128))])),b(w)?(m(),p("div",Ye,[a("button",{class:"load-more-btn",onClick:v},[y(h,{name:"mdi:chevron-down",size:"20"}),r[8]||(r[8]=a("span",null,"加载更多",-1))])])):P("",!0)])}}}),rt=he(tt,[["__scopeId","data-v-d243fc71"]]);export{rt as default};
