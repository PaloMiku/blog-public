const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Bk8Zuwpp.js","./D6ajeznB.js","./De9f4ER9.js","./D-deoX8n.js","./entry.B3t-9a59.css","./Lightbox.BjXgNHbX.css"])))=>i.map(i=>d[i]);
import{J as b,N as S,q as m,o as _,aE as K,Q as $,aQ as L,K as N,aN as X,b5 as k,aR as y,b7 as E,M as I,ai as A,a8 as z,b4 as P}from"./D6ajeznB.js";import{c as q,b as O,F as V,r as B,e as R,G as D,_ as j}from"./De9f4ER9.js";const F=A(()=>z(()=>import("./Bk8Zuwpp.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(u=>u.default||u)),G={key:0,class:"z-comment"},H={class:"text-creative"},Q={id:"artalk"},U={class:"loading-box"},J=b({__name:"Comment",setup(u){const p=q(),g=O(),w=V(),d=B(),f=D.getInstance(),x=R();function C(e){return!e||e==="/"||e.endsWith("/")?e:`${e}/`}function v(){return new Promise((e,n)=>{if(typeof window<"u"&&window.katex){e(window.katex);return}const o=document.querySelector('script[src*="katex"]');if(o){o.addEventListener("load",()=>e(window.katex)),o.addEventListener("error",()=>{console.warn("[KaTeX] 加载失败"),n(new Error("KaTeX 加载失败"))});return}const t=document.createElement("script");t.src="https://lib.baomitu.com/KaTeX/0.16.9/katex.min.js",t.onload=()=>{e(window.katex)},t.onerror=()=>{console.warn("[KaTeX] 加载失败"),n(new Error("KaTeX 脚本加载失败"))},document.head.appendChild(t)})}async function l(){try{await v();const e=typeof window<"u"?window.katex:void 0;if(!e){console.warn("[KaTeX] 未检测到 KaTeX 实例，稍后重试"),setTimeout(()=>l(),1e3);return}document.querySelectorAll("#artalk .atk-content:not(.math-processed)").forEach(o=>{o.classList.add("math-processed");let t=o.innerHTML;const i=t;t=t.replace(/\$\$([^$]+)\$\$/g,(r,a)=>{try{return`<span class="math-display">${e.renderToString(a.trim(),{displayMode:!0})}</span>`}catch(c){return console.warn("KaTeX display render error:",c),r}}),t=t.replace(/\$([^$\n]+)\$/g,(r,a)=>{if(r.includes('<span class="math-'))return r;try{return`<span class="math-inline">${e.renderToString(a.trim(),{displayMode:!1})}</span>`}catch(c){return console.warn("KaTeX inline render error:",c),r}}),t=t.replace(/```math\s*([\s\S]*?)```/g,(r,a)=>{try{return`<div class="math-block">${e.renderToString(a.trim(),{displayMode:!0})}</div>`}catch(c){return console.warn("KaTeX math block render error:",c),r}}),t!==i&&(o.innerHTML=t)})}catch(e){console.error("Failed to load KaTeX:",e),setTimeout(()=>l(),1e3)}}function T(){document.querySelectorAll("#artalk .atk-content img").forEach(n=>{const o=n;o.style.cursor!=="zoom-in"&&(o.style.cursor="zoom-in",o.addEventListener("click",()=>{const{open:t}=x.use(()=>I(F,{el:o}));t()}))})}let s=null;function M(){const e=document.getElementById("artalk");e&&(s&&s.disconnect(),s=new MutationObserver(n=>{let o=!1,t=!1;n.forEach(i=>{i.type==="childList"&&i.addedNodes.length>0&&i.addedNodes.forEach(r=>{if(r.nodeType===Node.ELEMENT_NODE){const a=r;(a.tagName==="IMG"||a.querySelector("img"))&&(o=!0),(a.classList?.contains("atk-content")||a.querySelector(".atk-content"))&&(t=!0)}})}),o&&setTimeout(()=>T(),100),t&&setTimeout(()=>l(),500)}),s.observe(e,{childList:!0,subtree:!0}))}async function h(){try{if(!d.showComments){f.destroy();return}const e=C(g.path);await f.init({el:"#artalk",pageKey:e,pageTitle:document.title.replace(` | ${p.title}`,""),server:p.artalk?.server,site:p.artalk?.site,emoticons:"/assets/Owo-Artalk.json",darkMode:w.value==="dark"}),await m(()=>{setTimeout(()=>{T(),setTimeout(()=>l(),1e3),M()},500)})}catch(e){console.error("[Artalk] 初始化失败:",e instanceof Error?e.message:e)}}return S(()=>{d.initCommentsSetting(),m(()=>{setTimeout(h,100)})}),_(()=>g.path,()=>{m(()=>{setTimeout(h,100)})}),_(()=>d.showComments,()=>{m(()=>{setTimeout(h,100)})}),_(()=>w.value,e=>{f.setDarkMode(e==="dark")}),K(()=>{s&&(s.disconnect(),s=null)}),(e,n)=>{const o=j;return N(d).showComments?(X(),$("section",G,[k("h3",H,[y(o,{name:"i-hugeicons:comment-01",class:"comment-tip"}),n[0]||(n[0]=E("评论 ",-1))]),k("div",Q,[k("p",U,[y(o,{name:"line-md:loading-twotone-loop",class:"loadig-img"}),n[1]||(n[1]=E("评论加载中... ",-1))])])])):L("",!0)}}}),Z=Object.assign(P(J,[["__scopeId","data-v-26d56f14"]]),{__name:"PostComment"});export{Z as _};
