import{y as E,x as $,r as f,o as w,a5 as C,e as n,w as M,d as a,h as i,J as d,g as u,C as D,F as y,R as x,f as h,t as p,_ as H}from"./BwfZDcNc.js";import{_ as S}from"./DqYPAtDV.js";const z={key:0,class:"echo-loading"},G={key:1,class:"echo-error"},U={key:2,class:"echo-empty"},W={key:3,class:"echo-list"},F=["href","title"],J={class:"echo-header"},L={class:"echo-content"},O={class:"echo-text"},R={class:"echo-meta"},V={key:0,class:"echo-tags"},A=["title"],P={class:"echo-time"},j={key:0,class:"echo-thumbnail"},K=["src","alt"],Z=E({__name:"EchoTrend",setup(q){const T=$(),_=f([]),m=f(!1),g=f(!1);async function k(){m.value=!0;try{const{echo:s}=T,e=await $fetch(`${s.apiBase}${s.apiEndpoint}?page=1&pageSize=3`);if(e?.data?.items){const c=e.data.items;_.value=c.filter(r=>!r.private).sort((r,t)=>{try{const o=new Date(r.created_at),l=new Date(t.created_at);return Number.isNaN(o.getTime())||Number.isNaN(l.getTime())?0:l.getTime()-o.getTime()}catch(o){return console.error(`Invalid date comparison: ${r.created_at}, ${t.created_at}`,o),0}}).slice(0,3)}}catch(s){console.error("Failed to fetch echos:",s),g.value=!0}finally{m.value=!1}}function b(s){try{const e=new Date(s);if(Number.isNaN(e.getTime()))return"无效时间";const r=new Date().getTime()-e.getTime(),t=Math.floor(r/1e3),o=Math.floor(t/60),l=Math.floor(o/60),v=Math.floor(l/24);return t<60?"刚刚":o<60?`${o}分钟前`:l<24?`${l}小时前`:v<7?`${v}天前`:e.toLocaleDateString("zh-CN")}catch(e){return console.error(`Invalid date format: ${s}`,e),"无效时间"}}function I(s,e=60){return s?s.length>e?`${s.slice(0,e)}...`:s:"[无内容]"}function N(s){switch(s){case"GITHUBPROJ":case"GITHUB":return{icon:"mdi:github",color:"var(--c-text-2)"};case"MUSIC":return{icon:"mdi:music",color:"var(--c-primary)"};case"WEBSITE":return{icon:"mdi:globe",color:"var(--c-text-2)"};default:return{icon:"mdi:link",color:"var(--c-text-2)"}}}function B(s){return{GITHUBPROJ:"GitHub 项目",GITHUB:"GitHub",MUSIC:"音乐",WEBSITE:"网站",LINK:"链接"}[s||""]||s||""}return w(()=>{k()}),(s,e)=>{const c=D,r=S;return n(),C(r,{card:"",title:"最新动态"},{default:M(()=>[d(m)?(n(),a("div",z,[u(c,{name:"eos-icons:loading",size:"16",class:"spin"}),e[0]||(e[0]=i("span",null,"加载中...",-1))])):d(g)?(n(),a("div",G,[u(c,{name:"mdi:alert-circle",size:"16"}),e[1]||(e[1]=i("span",null,"加载失败",-1))])):d(_).length===0?(n(),a("div",U,[u(c,{name:"mdi:inbox",size:"16"}),e[2]||(e[2]=i("span",null,"暂无动态",-1))])):(n(),a("div",W,[(n(!0),a(y,null,x(d(_),t=>(n(),a("a",{key:t.id,href:`https://echo.sotkg.com/echo/${t.id}`,target:"_blank",rel:"noopener noreferrer",class:"echo-item",title:t.content},[i("div",J,[i("div",L,[i("div",O,p(I(t.content,40)),1),i("div",R,[t.tags&&t.tags.length>0?(n(),a("div",V,[(n(!0),a(y,null,x(t.tags.slice(0,1),o=>(n(),a("span",{key:o.id,class:"echo-tag"}," #"+p(o.name),1))),128))])):h("",!0),t.extension_type?(n(),a("span",{key:1,class:"echo-extension-badge",title:B(t.extension_type)},[u(c,{name:N(t.extension_type).icon,size:"14"},null,8,["name"])],8,A)):h("",!0)])]),i("div",P,p(b(t.created_at)),1)]),t.images?.[0]?(n(),a("div",j,[i("img",{src:t.images[0].image_url,alt:t.content},null,8,K)])):h("",!0)],8,F))),128))])),e[3]||(e[3]=i("div",{class:"echo-footer"},[i("a",{href:"/echo",class:"echo-link"},"查看更多 →")],-1))]),_:1})}}}),Y=Object.assign(H(Z,[["__scopeId","data-v-8a00eda0"]]),{__name:"WidgetEchoTrend"});export{Y as default};
