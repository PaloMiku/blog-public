import{_ as K,J as nt,r as H,x as h,Q as w,aO as m,aS as p,aU as L,aR as x,T as P,aN as at,ba as it,b7 as ot,K as d,b6 as Y,b9 as T,b5 as st}from"./DeZJN128.js";import{a8 as lt,a9 as ct,p as C,_ as rt,aa as ut}from"./C79afr0F.js";import"./D-deoX8n.js";function ht(a){return a instanceof Element?a.getBoundingClientRect():a}const I=a=>typeof a=="number"?`${a}px`:a;function X(a,B,o){const g=lt(B).map(s=>ht(K(s)));return K(a).animate(g.map(s=>({left:I(s.left),top:I(s.top),width:I(s.width),height:I(s.height)})),{duration:100,fill:"forwards",...o})}const dt={class:"z-lightbox"},gt={key:0,class:"tooltip"},ft={key:0,class:"caption"},vt={key:1,class:"image-controls"},mt=["disabled","title"],pt={class:"image-counter"},bt=["disabled","title"],Q=.8,wt=nt({__name:"Lightbox",props:{el:{},caption:{},show:{type:Boolean},images:{},currentIndex:{}},emits:["close","navigate"],setup(a,{emit:B}){const o=a,g=B,s=o.el.getBoundingClientRect(),z=H(),y=ct(z),{width:R,height:M}=ut(),c=H(o.currentIndex??0),_=h(()=>o.images||[]),U=h(()=>_.value.length>1),q=h(()=>_.value[c.value]||o.el.src),W=h(()=>c.value>0),$=h(()=>c.value<_.value.length-1);function O(){W.value&&(c.value--,g("navigate",c.value))}function S(){$.value&&(c.value++,g("navigate",c.value))}let b,E,j;const f=H({}),V=h(()=>Object.values(f.value).slice(0,2)),k=h(()=>G("current")),F=h(()=>J("current"));function A(t,e,n){if(n<1)return t<Math.min(R.value,s.width,o.el.naturalWidth)&&e<Math.min(M.value,s.height,o.el.naturalHeight);if(n>1)return t>Math.max(R.value,s.width,o.el.naturalWidth)&&e>Math.max(M.value,s.height,o.el.naturalHeight)}function Z(t){const{left:e,top:n,width:i,height:l}=y.value.getBoundingClientRect();if(A(i,l,1-t.deltaY))return;const r=Math.abs(t.deltaY)<8?Math.abs(t.deltaY)*.05:.5,u=t.deltaY>0?1/(1+r):1+r;X(y,{left:e-(t.clientX-e)*(u-1),top:n-(t.clientY-n)*(u-1),width:i*u,height:l*u})}function D(){for(const t of Object.values(f.value))t.startX=t.currentX,t.startY=t.currentY;b=y.value.getBoundingClientRect(),E=G("start"),j=J("start")}function G(t){const e=V.value;return{x:e.reduce((n,i)=>n+i[`${t}X`],0)/e.length,y:e.reduce((n,i)=>n+i[`${t}Y`],0)/e.length}}function J(t){const[e,n]=V.value;return!e||!n?0:Math.hypot(e[`${t}X`]-n[`${t}X`],e[`${t}Y`]-n[`${t}Y`])}C("pointerdown",t=>{f.value[t.pointerId]={startX:t.clientX,startY:t.clientY,currentX:t.clientX,currentY:t.clientY},D()}),C("pointermove",t=>{const e=f.value[t.pointerId];if(!e)return;e.currentX=t.clientX,e.currentY=t.clientY;const n=F.value/j||1,i=b.width*n,l=b.height*n;if(A(i,l,n))return;const v=b.left+k.value.x-E.x,r=b.top+k.value.y-E.y,u=v-(k.value.x-v)*(n-1),N=r-(k.value.y-r)*(n-1);X(y,{left:u,top:N,width:i,height:l},{duration:0})}),C("pointerup",t=>{delete f.value[t.pointerId],Object.keys(f.value).length&&D()});function tt(t,e){const n=window.innerWidth*Q,i=window.innerHeight*Q,l=o.el.naturalWidth/o.el.naturalHeight,[v,r]=n/i>l?[i*l,i]:[n,n/l],u=(R.value-v)/2,N=(M.value-r)/2;X(t,[s,{left:u,top:N,width:v,height:r}]).onfinish=e}function et(t,e){X(t,o.el).onfinish=e}return C("keydown",t=>{t.key==="Escape"?g("close"):t.key==="ArrowLeft"?O():t.key==="ArrowRight"&&S()}),(t,e)=>{const n=it,i=rt;return m(),w("div",dt,[p(P,null,{default:L(()=>[a.show?(m(),w("div",{key:0,id:"z-lightbox-bgmask",onClick:e[0]||(e[0]=l=>g("close"))})):x("",!0)]),_:1}),p(P,{onEnter:tt,onLeave:et},{default:L(()=>[a.show?(m(),at(n,{key:0,ref_key:"lightbox",ref:z,class:"image",alt:a.el.alt,width:a.el.width,height:a.el.height,src:d(q),draggable:"false",onWheel:ot(Z,["prevent"])},null,8,["alt","width","height","src"])):x("",!0)]),_:1}),p(P,null,{default:L(()=>[a.show?(m(),w("div",gt,[a.caption?(m(),w("span",ft,T(a.caption),1)):x("",!0),d(U)?(m(),w("div",vt,[Y("button",{class:"nav-button",disabled:!d(W),title:d(W)?"上一张 (←)":"没有上一张了",onClick:O},[p(i,{name:"ph:caret-left-bold",size:"16"})],8,mt),Y("div",pt,T(d(c)+1)+" / "+T(d(_).length),1),Y("button",{class:"nav-button",disabled:!d($),title:d($)?"下一张 (→)":"没有下一张了",onClick:S},[p(i,{name:"ph:caret-right-bold",size:"16"})],8,bt)])):x("",!0),Y("button",{class:"close","aria-label":"关闭灯箱",onClick:e[1]||(e[1]=l=>g("close"))},[p(i,{name:"ph:x-bold"})])])):x("",!0)]),_:1})])}}}),kt=Object.assign(st(wt,[["__scopeId","data-v-0e017d4d"]]),{__name:"PopoverLightbox"});export{kt as default};
