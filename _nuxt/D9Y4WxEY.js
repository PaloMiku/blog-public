import{J,r as y,o as $,S as j,x as B,Q as n,aQ as c,K as e,aN as r,b5 as t,aM as E,br as T,aR as k,b8 as l,aU as V,aV as D,b4 as F}from"./D6ajeznB.js";import{f as L,_ as Q}from"./VuNmkfQC.js";import"./D-deoX8n.js";const S=["data-source","title"],U={class:"card-layout"},q={class:"character-avatar"},z={key:1,class:"avatar-placeholder"},H={class:"character-info"},K={class:"name-section"},O={class:"character-name"},P={key:0,class:"name-jp"},R={key:1,class:"name-cn"},W={key:0,class:"character-description"},G={key:1,class:"character-attributes"},X={key:0,class:"attr-item"},Y={class:"attr-value"},Z={key:1,class:"attr-item"},ee={class:"attr-value"},ae={key:2,class:"attr-item"},te={class:"attr-value"},se={key:3,class:"attr-item"},oe={class:"attr-value"},re={key:4,class:"attr-item"},ne={class:"attr-value"},ie={key:5,class:"attr-item"},ce={class:"attr-value"},le={key:2,class:"voice-actors"},de={class:"voice-actors-label"},ue={class:"voice-actors-list"},me={class:"actor-name"},ve={class:"card-footer"},pe={class:"source-badge"},_e={class:"source-name"},he={key:1,class:"character-card character-card-error"},ge={key:2,class:"character-card character-card-loading"},fe=J({__name:"index",props:{characterId:{}},setup(I){const M=I,b=new Map,_=y(!1),u=y(!1),a=y(null);let v=null;$(()=>M.characterId,async p=>{if(p){if(b.has(p)){a.value=b.get(p)??null,_.value=!1,u.value=!1;return}_.value=!0,u.value=!1,v&&v.abort(),v=new AbortController;try{const s=L.bangumi?.apiBase;if(!s){u.value=!0,console.error("[CharacterCard] Bangumi API base not configured");return}const g=await fetch(`${s}/api/character?id=${p}`,{signal:v.signal});if(g.ok){const o=await g.json();if(o.id){let h=[];if(o.voiceActors&&Array.isArray(o.voiceActors)){const d=new Map;o.voiceActors.forEach(i=>{d.has(i.name)||d.set(i.name,{name:i.name||"未知声优",image:i.image||i.images?.medium||i.images?.small,link:i.link||(i.id?`https://bangumi.tv/person/${i.id}`:void 0)})}),h=Array.from(d.values()).slice(0,3)}let f="";if(o.infobox&&Array.isArray(o.infobox)){const d=o.infobox.find(i=>i.key==="别名");if(d&&Array.isArray(d.value)){const i=d.value.find(w=>w.k==="纯 假名"||w.k==="假名");i&&(f=i.v)}}const m=new Map;o.infobox&&Array.isArray(o.infobox)&&o.infobox.forEach(d=>{typeof d.value=="string"&&m.set(d.key,d.value)});const x={source:"bangumi",name:o.name||"未知角色",nameJp:f||void 0,nameCn:o.name_cn||void 0,description:o.summary||void 0,image:o.images?.large||o.images?.medium||void 0,role:void 0,voiceActors:h.length>0?h:void 0,gender:m.get("性别")||m.get("性 别")||void 0,birthday:m.get("生日")||void 0,bloodType:m.get("血型")||void 0,height:m.get("身高")||void 0,weight:m.get("体重")||void 0,bwh:m.get("BWH")||void 0,link:`https://bangumi.tv/character/${o.id}`,metadata:{characterId:o.id,appearsInCount:void 0}};a.value=x,b.set(p,x)}else u.value=!0}else u.value=!0}catch(s){s instanceof Error&&s.name!=="AbortError"&&(console.error("[CharacterCard] Fetch error:",s),u.value=!0)}finally{_.value=!1}}},{immediate:!0}),j(()=>{v&&v.abort()});const A=B(()=>"Bangumi"),C=B(()=>"ri:bilibili-line");function N(){a.value?.link&&window.open(a.value.link,"_blank")}return(p,s)=>{const g=T,o=Q;return!e(_)&&!e(u)&&e(a)?(r(),n("div",{key:0,class:"character-card","data-source":e(a).source,title:`点击查看${e(A)}页面`},[t("div",U,[t("div",q,[e(a).image?(r(),E(g,{key:0,src:e(a).image,alt:e(a).name,class:"avatar-image",loading:"lazy"},null,8,["src","alt"])):(r(),n("div",z,[k(o,{name:"ph:user-circle-bold",class:"placeholder-icon"})]))]),t("div",H,[t("div",K,[t("h3",O,l(e(a).name),1),e(a).nameJp?(r(),n("p",P,l(e(a).nameJp),1)):c("",!0),e(a).nameCn&&e(a).nameCn!==e(a).name?(r(),n("p",R,l(e(a).nameCn),1)):c("",!0)]),e(a).description?(r(),n("p",W,l(e(a).description),1)):c("",!0),e(a).gender||e(a).birthday||e(a).height||e(a).bloodType?(r(),n("div",G,[e(a).gender?(r(),n("div",X,[s[0]||(s[0]=t("span",{class:"attr-label"},"性别",-1)),t("span",Y,l(e(a).gender),1)])):c("",!0),e(a).birthday?(r(),n("div",Z,[s[1]||(s[1]=t("span",{class:"attr-label"},"生日",-1)),t("span",ee,l(e(a).birthday),1)])):c("",!0),e(a).height?(r(),n("div",ae,[s[2]||(s[2]=t("span",{class:"attr-label"},"身高",-1)),t("span",te,l(e(a).height),1)])):c("",!0),e(a).bloodType?(r(),n("div",se,[s[3]||(s[3]=t("span",{class:"attr-label"},"血型",-1)),t("span",oe,l(e(a).bloodType),1)])):c("",!0),e(a).weight?(r(),n("div",re,[s[4]||(s[4]=t("span",{class:"attr-label"},"体重",-1)),t("span",ne,l(e(a).weight),1)])):c("",!0),e(a).bwh?(r(),n("div",ie,[s[5]||(s[5]=t("span",{class:"attr-label"},"三围",-1)),t("span",ce,l(e(a).bwh),1)])):c("",!0)])):c("",!0),e(a).voiceActors&&e(a).voiceActors.length>0?(r(),n("div",le,[t("div",de,[k(o,{name:"ri:mic-line",class:"label-icon"}),s[6]||(s[6]=t("span",null,"声优",-1))]),t("div",ue,[(r(!0),n(V,null,D(e(a).voiceActors,(h,f)=>(r(),n("div",{key:f,class:"voice-actor-item"},[t("span",me,l(h.name),1)]))),128))])])):c("",!0),t("div",ve,[t("div",pe,[e(C)?(r(),E(o,{key:0,name:e(C),class:"source-icon"},null,8,["name"])):c("",!0),t("span",_e,l(e(A)),1)]),e(a).link?(r(),n("button",{key:0,class:"view-button",onClick:N},[s[7]||(s[7]=t("span",null,"查看详情",-1)),k(o,{name:"ri:arrow-right-line",class:"button-icon"})])):c("",!0)])])])],8,S)):e(u)?(r(),n("div",he,[...s[8]||(s[8]=[t("div",{class:"error-content"},[t("p",null,"加载失败"),t("small",null,"请检查 ID 是否正确或稍后重试")],-1)])])):e(_)?(r(),n("div",ge,[...s[9]||(s[9]=[t("div",{class:"loading-skeleton"},null,-1)])])):c("",!0)}}}),Ae=Object.assign(F(fe,[["__scopeId","data-v-2acec7b7"]]),{__name:"CharacterCard"});export{Ae as default};
