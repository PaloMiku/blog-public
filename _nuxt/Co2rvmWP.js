import{bg as q,W as V,d as A,r as z,bc as F,c as W,O as w,k as m,h as g,i as x,w as $,l as b,V as R,f as G,n as J,R as K,j as Q,t as U,q as Z,bh as tt,z as et}from"#entry";function nt(i){return i instanceof Element?i.getBoundingClientRect():i}const Y=i=>typeof i=="number"?`${i}px`:i;function y(i,k,c){const d=q(k).map(a=>nt(V(a)));return V(i).animate(d.map(a=>({left:Y(a.left),top:Y(a.top),width:Y(a.width),height:Y(a.height)})),{duration:100,fill:"forwards",...c})}const it={class:"z-lightbox"},ot={key:0,class:"tooltip"},at={key:0,class:"caption"},N=.8,st=A({__name:"Lightbox",props:{el:{},caption:{},show:{type:Boolean}},emits:["close"],setup(i,{emit:k}){const c=i,d=k,a=c.el.getBoundingClientRect(),M=z(),p=F(M),{width:X,height:C}=tt();let f,_,E;const u=z({}),H=W(()=>Object.values(u.value).slice(0,2)),v=W(()=>L("current")),P=W(()=>O("current"));function I(t,e,n){if(n<1)return t<Math.min(X.value,a.width,c.el.naturalWidth)&&e<Math.min(C.value,a.height,c.el.naturalHeight);if(n>1)return t>Math.max(X.value,a.width,c.el.naturalWidth)&&e>Math.max(C.value,a.height,c.el.naturalHeight)}function D(t){const{left:e,top:n,width:o,height:s}=p.value.getBoundingClientRect();if(I(o,s,1-t.deltaY))return;const l=Math.abs(t.deltaY)<8?Math.abs(t.deltaY)*.05:.5,r=t.deltaY>0?1/(1+l):1+l;y(p,{left:e-(t.clientX-e)*(r-1),top:n-(t.clientY-n)*(r-1),width:o*r,height:s*r})}function j(){for(const t of Object.values(u.value))t.startX=t.currentX,t.startY=t.currentY;f=p.value.getBoundingClientRect(),_=L("start"),E=O("start")}function L(t){const e=H.value;return{x:e.reduce((n,o)=>n+o[`${t}X`],0)/e.length,y:e.reduce((n,o)=>n+o[`${t}Y`],0)/e.length}}function O(t){const[e,n]=H.value;return!e||!n?0:Math.hypot(e[`${t}X`]-n[`${t}X`],e[`${t}Y`]-n[`${t}Y`])}w("pointerdown",t=>{u.value[t.pointerId]={startX:t.clientX,startY:t.clientY,currentX:t.clientX,currentY:t.clientY},j()}),w("pointermove",t=>{const e=u.value[t.pointerId];if(!e)return;e.currentX=t.clientX,e.currentY=t.clientY;const n=P.value/E||1,o=f.width*n,s=f.height*n;if(I(o,s,n))return;const h=f.left+v.value.x-_.x,l=f.top+v.value.y-_.y,r=h-(v.value.x-h)*(n-1),B=l-(v.value.y-l)*(n-1);y(p,{left:r,top:B,width:o,height:s},{duration:0})}),w("pointerup",t=>{delete u.value[t.pointerId],Object.keys(u.value).length&&j()});function S(t,e){const n=window.innerWidth*N,o=window.innerHeight*N,s=c.el.naturalWidth/c.el.naturalHeight,[h,l]=n/o>s?[o*s,o]:[n,n/s],r=(X.value-h)/2,B=(C.value-l)/2;y(t,[a,{left:r,top:B,width:h,height:l}]).onfinish=e}function T(t,e){y(t,c.el).onfinish=e}return w("keydown",t=>{t.key==="Escape"&&d("close")}),(t,e)=>{const n=J,o=Z;return g(),m("div",it,[x(R,null,{default:$(()=>[i.show?(g(),m("div",{key:0,id:"z-lightbox-bgmask",onClick:e[0]||(e[0]=s=>d("close"))})):b("",!0)]),_:1}),x(R,{onEnter:S,onLeave:T},{default:$(()=>[i.show?(g(),G(n,{key:0,ref_key:"lightbox",ref:M,class:"image",alt:i.el.alt,width:i.el.width,height:i.el.height,src:i.el.src,draggable:"false",onWheel:K(D,["prevent"])},null,8,["alt","width","height","src"])):b("",!0)]),_:1}),x(R,null,{default:$(()=>[i.show?(g(),m("div",ot,[i.caption?(g(),m("span",at,U(i.caption),1)):b("",!0),Q("button",{class:"close","aria-label":"关闭灯箱",onClick:e[1]||(e[1]=s=>d("close"))},[x(o,{name:"ph:x-bold"})])])):b("",!0)]),_:1})])}}}),lt=Object.assign(et(st,[["__scopeId","data-v-7453ca20"]]),{__name:"PopoverLightbox"});export{lt as default};
