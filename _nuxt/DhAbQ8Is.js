import{be as Q,A as O,G as U,r as W,bf as Z,z as h,ai as w,d as $,e as x,g as b,ba as tt,w as j,W as et,f as M,Y as nt,aP as at,T as A,h as ot,t as it,O as st,F as lt,bg as ct,_ as rt}from"./BvfQ2T0o.js";function ut(a){return a instanceof Element?a.getBoundingClientRect():a}const Y=a=>typeof a=="number"?`${a}px`:a;function y(a,_,i){const d=Q(_).map(s=>ut(O(s)));return O(a).animate(d.map(s=>({left:Y(s.left),top:Y(s.top),width:Y(s.width),height:Y(s.height)})),{duration:100,fill:"forwards",...i})}const ht={key:0,class:"tooltip"},dt={key:0,class:"caption"},V=.8,gt=U({__name:"Lightbox",props:{el:{},caption:{},show:{type:Boolean},images:{},currentIndex:{}},emits:["close","navigate"],setup(a,{emit:_}){const i=a,d=_,s=i.el.getBoundingClientRect(),R=W(),p=Z(R),{width:k,height:X}=ct(),g=W(i.currentIndex??0),C=h(()=>i.images||[]);h(()=>C.value.length>1),h(()=>C.value[g.value]||i.el.src);const D=h(()=>g.value>0),G=h(()=>g.value<C.value.length-1);function S(){D.value&&(g.value--,d("navigate",g.value))}function z(){G.value&&(g.value++,d("navigate",g.value))}let v,I,E;const f=W({}),P=h(()=>Object.values(f.value).slice(0,2)),m=h(()=>N("current")),F=h(()=>T("current"));function H(t,e,n){if(n<1)return t<Math.min(k.value,s.width,i.el.naturalWidth)&&e<Math.min(X.value,s.height,i.el.naturalHeight);if(n>1)return t>Math.max(k.value,s.width,i.el.naturalWidth)&&e>Math.max(X.value,s.height,i.el.naturalHeight)}function q(t){const{left:e,top:n,width:o,height:l}=p.value.getBoundingClientRect();if(H(o,l,1-t.deltaY))return;const r=Math.abs(t.deltaY)<8?Math.abs(t.deltaY)*.05:.5,u=t.deltaY>0?1/(1+r):1+r;y(p,{left:e-(t.clientX-e)*(u-1),top:n-(t.clientY-n)*(u-1),width:o*u,height:l*u})}function L(){for(const t of Object.values(f.value))t.startX=t.currentX,t.startY=t.currentY;v=p.value.getBoundingClientRect(),I=N("start"),E=T("start")}function N(t){const e=P.value;return{x:e.reduce((n,o)=>n+o[`${t}X`],0)/e.length,y:e.reduce((n,o)=>n+o[`${t}Y`],0)/e.length}}function T(t){const[e,n]=P.value;return!e||!n?0:Math.hypot(e[`${t}X`]-n[`${t}X`],e[`${t}Y`]-n[`${t}Y`])}w("pointerdown",t=>{f.value[t.pointerId]={startX:t.clientX,startY:t.clientY,currentX:t.clientX,currentY:t.clientY},L()}),w("pointermove",t=>{const e=f.value[t.pointerId];if(!e)return;e.currentX=t.clientX,e.currentY=t.clientY;const n=F.value/E||1,o=v.width*n,l=v.height*n;if(H(o,l,n))return;const c=v.left+m.value.x-I.x,r=v.top+m.value.y-I.y,u=c-(m.value.x-c)*(n-1),B=r-(m.value.y-r)*(n-1);y(p,{left:u,top:B,width:o,height:l},{duration:0})}),w("pointerup",t=>{delete f.value[t.pointerId],Object.keys(f.value).length&&L()});function J(t,e){const n=window.innerWidth*V,o=window.innerHeight*V,l=i.el.naturalWidth/i.el.naturalHeight,[c,r]=n/o>l?[o*l,o]:[n,n/l],u=(k.value-c)/2,B=(X.value-r)/2;y(t,[s,{left:u,top:B,width:c,height:r}]).onfinish=e}function K(t,e){y(t,i.el).onfinish=e}return w("keydown",t=>{t.key==="Escape"?d("close"):t.key==="ArrowLeft"?S():t.key==="ArrowRight"&&z()}),(t,e)=>{const n=tt,o=nt,l=st;return x(),$(lt,null,[b(n,{show:a.show,blur:"",onClick:e[0]||(e[0]=c=>d("close"))},null,8,["show"]),b(A,{onEnter:J,onLeave:K},{default:j(()=>[a.show?(x(),et(o,{key:0,ref_key:"lightbox",ref:R,class:"image",alt:a.el.alt,width:a.el.width,height:a.el.height,src:a.el.src,draggable:"false",onWheel:at(q,["prevent"])},null,8,["alt","width","height","src"])):M("",!0)]),_:1}),b(A,null,{default:j(()=>[a.show?(x(),$("div",ht,[a.caption?(x(),$("span",dt,it(a.caption),1)):M("",!0),ot("button",{class:"close","aria-label":"关闭灯箱",onClick:e[1]||(e[1]=c=>d("close"))},[b(l,{name:"ph:x-bold"})])])):M("",!0)]),_:1})],64)}}}),vt=Object.assign(rt(gt,[["__scopeId","data-v-e35eebc2"]]),{__name:"PopoverLightbox"});export{vt as default};
