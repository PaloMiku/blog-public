const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./D6ThatDz.js","./DHv0OwSm.js","./entry.ogunzLl3.css","./Lightbox.DLcruoWU.css"])))=>i.map(i=>d[i]);
import{z as ie,y as le,A as re,B as ce,C as de,r as D,D as Q,E as T,G as w,H as ue,d as r,e as l,h as n,f as M,g as _,I as me,J as pe,K as he,L as i,M as _e,n as H,N as j,O as ge,F as B,P as N,t as y,Q as fe,R as ve,S as be,U as xe,V as ye,b as $e,_ as ke}from"./DHv0OwSm.js";import{t as we}from"./hddATWeZ.js";import{u as X}from"./CTZCF--h.js";import"./cjHmyz6f.js";function Ee($){const a=$.split(`
`),c=[];let x=!1,b="",f=[],u=0;for(;u<a.length;){const g=a[u];if(g.trimStart().match(/^```/)){if(x){const p=f.join(`
`);c.push(`<pre><code${b?` class="language-${b}"`:""}>${R(p)}</code></pre>`),x=!1,f=[],b=""}else{x=!0;const p=g.trimStart().match(/^```(.*)$/);b=p?p[1].trim():"",f=[]}u++;continue}if(x){f.push(g),u++;continue}if(!g.trim()){u++;continue}const C=g.trimStart().match(/^(#{1,6}) (.+)$/);if(C){const p=C[1].length,v=C[2],A=L(v);c.push(`<h${p}>${A}</h${p}>`),u++;continue}const I=g.trimStart().match(/^> (.+)$/);if(I){const p=I[1],v=L(p);c.push(`<blockquote>${v}</blockquote>`),u++;continue}const P=g.trimStart().match(/^[*\-] (.+)$/);if(P){const p=P[1],v=L(p);c.push(`<ul><li>${v}</li></ul>`),u++;continue}const z=g.trimStart().match(/^\d+\. (.+)$/);if(z){const p=z[1],v=L(p);c.push(`<ol><li>${v}</li></ol>`),u++;continue}const U=L(g);c.push(`<p>${U}</p>`),u++}if(x&&f.length>0){const g=f.join(`
`);c.push(`<pre><code${b?` class="language-${b}"`:""}>${R(g)}</code></pre>`)}return c.join("")}function L($){let a=$;const c=[],x="\0CODE";return a=a.replace(/`([^`]+)`/g,b=>{const f=c.length;return c.push(`<code>${R(b.slice(1,-1))}</code>`),`${x}${f}${x}`}),a=a.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(b,f,u)=>`<a href="${R(u)}" target="_blank" rel="noopener noreferrer">${f}</a>`),a=a.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),a=a.replace(/~~([^~]+)~~/g,"<del>$1</del>"),a=a.replace(/\*([^*\n]+)\*/g,"<em>$1</em>"),a=a.replace(/_([^_\n]+)_/g,"<em>$1</em>"),c.forEach((b,f)=>{a=a.replace(`${x}${f}${x}`,b)}),a}function R($){const a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return $.replace(/[&<>"']/g,c=>a[c]||c)}const Ce=ye(()=>$e(()=>import("./D6ThatDz.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then($=>$.default||$)),Me={class:"echo-container"},Ie={class:"echo-toolbar"},ze={class:"echo-search"},Se=["disabled","title"],Te=["href"],Be={key:0,class:"echo-heatmap-section"},Ne={class:"heatmap-header"},Le={class:"heatmap-title"},Pe={class:"heatmap-content"},We={class:"heatmap-left"},De=["title"],He={class:"heatmap-legend"},Re={class:"legend-cells"},Ue={class:"heatmap-stats"},Ae={class:"stat-item"},Ge={class:"stat-value"},Ve={class:"stat-item"},qe={class:"stat-value"},Oe={class:"stat-item"},Fe={class:"stat-value"},je={key:1,class:"echo-loading"},Je={key:2,class:"echo-empty"},Ke={key:3,class:"echo-empty"},Qe={key:4,class:"echo-list"},Xe={class:"echo-time-tag"},Ye=["innerHTML"],Ze={key:1,class:"echo-extension"},et={class:"extension-label"},tt={class:"extension-type-text"},st=["href"],nt={class:"website-content"},ot={class:"website-title"},at={class:"website-url"},it=["href"],lt={class:"extension-url"},rt={key:2,class:"echo-images"},ct=["onClick"],dt={class:"echo-card-footer"},ut={class:"echo-footer-info"},mt={class:"echo-tags-likes-tag"},pt=["href","title"],ht={class:"tag-item"},_t=["href"],gt={key:5,class:"echo-load-more"},ft=["disabled"],vt=10,bt=ie({__name:"echo",async setup($){let a,c;const x=le(),b=re(),f=ce();b.setAside(["blog-stats","blog-log"]),de({title:"动态",meta:[{property:"og:type",content:"website"},{name:"description",content:`${x?.author?.name||"用户"} 的动态分享，记录最新的想法、观点和日常动态。`},{name:"keywords",content:"动态,分享,想法,日记,思考"}]});const u=D(""),g=D(1),{data:C,pending:I,refresh:P}=([a,c]=Q(()=>X(`${T.echo.apiBase}${T.echo.apiEndpoint}?page=1&pageSize=100`,{watch:!1,default:()=>({data:{items:[]}})},"$h5c9zGxgMR")),a=await a,c(),a),{data:z,pending:U}=([a,c]=Q(()=>X(`${T.echo.apiBase}/api/heatmap`,{watch:!1,default:()=>({code:0,msg:"",data:[]})},"$cewwBWa4WN")),a=await a,c(),a),p=w(()=>{const s=C.value?.data?.items;return s?.length?s.filter(e=>!e.private).sort((e,o)=>{try{const d=new Date(e.created_at),m=new Date(o.created_at);return Number.isNaN(d.getTime())||Number.isNaN(m.getTime())?0:m.getTime()-d.getTime()}catch(d){return console.error(`Invalid date comparison: ${e.created_at}, ${o.created_at}`,d),0}}):[]}),v=D(!1);async function A(){if(!v.value){v.value=!0;try{g.value=1,u.value="",await P()}catch(s){console.error("Failed to refresh echos:",s)}finally{v.value=!1}}}const G=w(()=>{const s=u.value.trim().toLowerCase();return s?p.value.filter(e=>{if(!e)return!1;const o=e.content?.toLowerCase()||"",d=e.username?.toLowerCase()||"";return o.includes(s)||d.includes(s)}):p.value}),J=w(()=>{const s=g.value*vt;return G.value.slice(0,s)}),Y=w(()=>J.value.length<G.value.length),E=D(!1);async function Z(){E.value||(E.value=!0,await new Promise(s=>setTimeout(s,300)),g.value++,E.value=!1)}const ee={GITHUBPROJ:{label:"GitHub 项目",icon:"mdi:github"},GITHUB:{label:"GitHub",icon:"mdi:github"},MUSIC:{label:"音乐",icon:"mdi:music"},WEBSITE:{label:"网站",icon:"mdi:globe"},LINK:{label:"链接",icon:"mdi:link"}},V=s=>ee[s]||{label:s,icon:"mdi:link"},q=new Map;function te(s){if(!s||typeof s!="string")return{title:"无效链接",site:"#",hostname:"无效链接"};if(q.has(s))return q.get(s);let e;try{const o=JSON.parse(s);if(!o||typeof o!="object")throw new Error("Invalid data structure");let d="",m=o.site||"";if(m)try{const t=new URL(m);if(t.protocol!=="http:"&&t.protocol!=="https:")throw new Error("Invalid protocol");d=t.hostname}catch{m="#",d="无效链接"}e={title:(o.title||"").toString().trim()||"无标题",site:m,hostname:d}}catch{e={title:"解析失败",site:"#",hostname:"解析失败"}}return q.set(s,e),e}const{parseMusicExtension:se}=ue(),K=w(()=>J.value.map(s=>({...s,parsedWebsiteExtension:s.extension&&s.extension_type==="WEBSITE"?te(s.extension):null,parsedMusicExtension:s.extension&&s.extension_type==="MUSIC"&&T.meting?.enabled?se(s.extension):null})));function ne(s,e,o){try{const d=s.currentTarget||null;let m=null,t=[],h=0;if(o){const k=K.value.find(S=>S.id===o);k&&k.images?.length&&(t=k.images.map(S=>S.image_url),e&&(h=t.findIndex(S=>S===e),h===-1&&(h=0)))}if(d&&(m=d.querySelector("img")),!m&&e){if(!e.trim()||!e.startsWith("http://")&&!e.startsWith("https://")){console.warn("Invalid image source:",e);return}const k=new Image;k.src=e,m=k}if(!m){console.warn("No valid image element found for lightbox");return}const{open:W}=f.use(()=>xe(Ce,{el:m,images:t.length>0?t:void 0,currentIndex:t.length>0?h:void 0}));W()}catch(d){console.error("Failed to open image lightbox:",d)}}function oe(s,e){if(s===0||e===0)return 0;const o=Math.ceil(s/e*4);return Math.min(o,4)}const O=w(()=>{const s=z.value?.data||[];if(s.length===0)return[];const e=Math.max(...s.map(o=>o.count),1);return s.map(o=>({date:o.date,count:o.count,level:oe(o.count,e)}))}),ae=w(()=>O.value.length>=30?{rows:2,cols:15}:{rows:3,cols:10}),F=w(()=>{const s=z.value?.data||[],e=C.value?.data?.total??0;if(s.length===0)return{total:e,average:0,maxCount:0,maxDate:""};const o=s.reduce((t,h)=>t+h.count,0),d=Math.round(o/30),m=s.reduce((t,h)=>h.count>t.count?h:t);return{total:e,average:d,maxCount:m.count,maxDate:m.date}});return(s,e)=>{const o=pe,d=ve,m=be;return l(),r("div",Me,[n("div",Ie,[n("div",ze,[_(o,{name:"mdi:magnify",size:"20",class:"search-icon"}),me(n("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>_e(u)?u.value=t:null),type:"text",placeholder:"搜索动态...",class:"search-input"},null,512),[[he,i(u)]])]),n("button",{disabled:i(v)||i(I),class:"echo-refresh-btn",title:i(v)?"刷新中...":"手动刷新动态",onClick:A},[_(o,{name:"mdi:refresh",size:"18",class:H({spin:i(v)})},null,8,["class"])],8,Se),n("a",{href:i(T).echo.rss,target:"_blank",rel:"noopener noreferrer",class:"echo-rss-btn",title:"订阅动态 RSS 源"},[_(o,{name:"mdi:rss",size:"18"})],8,Te)]),!i(U)&&i(O).length>0?(l(),r("div",Be,[n("div",Ne,[n("h3",Le,[_(o,{name:"mdi:fire",size:"20"}),e[1]||(e[1]=j(" 热力图 ",-1))])]),n("div",Pe,[n("div",We,[n("div",{class:"heatmap-grid",style:ge({gridTemplateColumns:`repeat(${i(ae).cols}, 1fr)`})},[(l(!0),r(B,null,N(i(O),t=>(l(),r("div",{key:t.date,class:H(["heatmap-cell",[`heatmap-level-${t.level}`]]),title:`${t.date}: ${t.count} 条动态`},null,10,De))),128))],4),n("div",He,[e[2]||(e[2]=n("span",{class:"legend-label"},"少",-1)),n("div",Re,[(l(),r(B,null,N(5,t=>n("div",{key:t,class:H(["legend-cell",[`heatmap-level-${t-1}`]])},null,2)),64))]),e[3]||(e[3]=n("span",{class:"legend-label"},"多",-1))])]),n("div",Ue,[n("div",Ae,[e[4]||(e[4]=n("span",{class:"stat-label"},"总动态数",-1)),n("span",Ge,y(i(F).total),1)]),n("div",Ve,[e[5]||(e[5]=n("span",{class:"stat-label"},"日均动态",-1)),n("span",qe,y(i(F).average),1)]),n("div",Oe,[e[6]||(e[6]=n("span",{class:"stat-label"},"单日最多",-1)),n("span",Fe,y(i(F).maxCount),1)])])])])):M("",!0),i(I)?(l(),r("div",je,[_(o,{name:"eos-icons:loading",size:"32"}),e[7]||(e[7]=n("p",null,"加载中...",-1))])):i(p).length===0?(l(),r("div",Je,[_(o,{name:"solar:inbox-line-duotone",size:"48"}),e[8]||(e[8]=n("p",null,"暂无动态",-1))])):i(G).length===0?(l(),r("div",Ke,[_(o,{name:"solar:magnifer-line-duotone",size:"48"}),e[9]||(e[9]=n("p",null,"未找到匹配的动态",-1))])):(l(),r("div",Qe,[(l(!0),r(B,null,N(i(K),t=>(l(),r("article",{key:t.id,class:"echo-card card"},[n("div",Xe,[_(o,{name:"ph:calendar-dots-bold",size:"12"}),n("span",null,y(i(we)(t.created_at)),1)]),t.content?(l(),r("div",{key:0,class:"echo-content-text",innerHTML:i(Ee)(t.content)},null,8,Ye)):M("",!0),t.extension&&t.extension_type?(l(),r("div",Ze,[n("div",et,[e[10]||(e[10]=j(" 分享了 ",-1)),n("span",tt,y(V(t.extension_type).label),1)]),t.extension_type==="WEBSITE"&&t.parsedWebsiteExtension?(l(),r("a",{key:0,href:t.parsedWebsiteExtension.site,target:"_blank",rel:"noopener noreferrer",class:"extension-link website-link"},[_(o,{name:V(t.extension_type).icon,size:"20"},null,8,["name"]),n("div",nt,[n("div",ot,y(t.parsedWebsiteExtension.title),1),n("div",at,y(t.parsedWebsiteExtension.hostname),1)]),_(o,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,st)):t.extension_type==="MUSIC"&&t.parsedMusicExtension?(l(),fe(d,{key:1,music:t.parsedMusicExtension},null,8,["music"])):(l(),r("a",{key:2,href:t.extension,target:"_blank",rel:"noopener noreferrer",class:"extension-link"},[_(o,{name:V(t.extension_type).icon,size:"20"},null,8,["name"]),n("span",lt,y(t.extension),1),_(o,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,it))])):M("",!0),t.images?.length?(l(),r("div",rt,[(l(!0),r(B,null,N(t.images,(h,W)=>(l(),r("button",{key:W,class:"echo-image-button",onClick:k=>ne(k,h.image_url,t.id)},[_(m,{src:h.image_url,alt:`Echo image ${W+1}`,class:"echo-image",loading:"lazy",fit:"cover"},null,8,["src","alt"])],8,ct))),128))])):M("",!0),n("div",dt,[n("div",ut,[n("div",mt,[t.tags?.length?(l(!0),r(B,{key:0},N(t.tags,h=>(l(),r("span",{key:h.id,class:"tag-item"},[n("a",{href:`https://echo.sotkg.com/?tag=${encodeURIComponent(h.name)}`,target:"_blank",rel:"noopener noreferrer",class:"tag-link",title:`使用数: ${h.usage_count}`}," #"+y(h.name),9,pt)]))),128)):M("",!0),n("span",ht,[_(o,{name:"mdi:heart",size:"12"}),j(" "+y(t.fav_count),1)])])]),n("a",{href:`https://echo.sotkg.com/echo/${t.id}`,target:"_blank",class:"echo-read-more-tag"},[_(o,{name:"mdi:open-in-new",size:"16"}),e[11]||(e[11]=n("span",null,"查看原文",-1))],8,_t)])]))),128))])),i(Y)?(l(),r("div",gt,[n("button",{class:"load-more-btn",disabled:i(E),onClick:Z},[_(o,{name:i(E)?"eos-icons:loading":"mdi:chevron-down",size:"20",class:H({spin:i(E)})},null,8,["name","class"]),n("span",null,y(i(E)?"装填中...":"继续装填"),1)],8,ft)])):M("",!0)])}}}),wt=ke(bt,[["__scopeId","data-v-b89f3722"]]);export{wt as default};
