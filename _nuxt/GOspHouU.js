import{c as E,t as b,r as N,f as G,i as V,d as H,u as J,a as K,b as Q,e as F,w as Z,g as W,h as m,o as y,j as d,k as O,l as _,m as X,_ as Y,v as ee,n as x,p as te,q as se,F as L,s as P,x as T,y as q,z as ne,I as oe,A as re,B as ie}from"#entry";import{u as ae}from"./BHiOEjGm.js";import{L as ce}from"./BwxD0iGZ.js";function le(c){return typeof c=="string"?`'${c}'`:new ue().serialize(c)}const ue=(function(){class c{#e=new Map;compare(e,t){const n=typeof e,o=typeof t;return n==="string"&&o==="string"?e.localeCompare(t):n==="number"&&o==="number"?e-t:String.prototype.localeCompare.call(this.serialize(e,!0),this.serialize(t,!0))}serialize(e,t){if(e===null)return"null";switch(typeof e){case"string":return t?e:`'${e}'`;case"bigint":return`${e}n`;case"object":return this.$object(e);case"function":return this.$function(e)}return String(e)}serializeObject(e){const t=Object.prototype.toString.call(e);if(t!=="[object Object]")return this.serializeBuiltInType(t.length<10?`unknown:${t}`:t.slice(8,-1),e);const n=e.constructor,o=n===Object||n===void 0?"":n.name;if(o!==""&&globalThis[o]===n)return this.serializeBuiltInType(o,e);if(typeof e.toJSON=="function"){const r=e.toJSON();return o+(r!==null&&typeof r=="object"?this.$object(r):`(${this.serialize(r)})`)}return this.serializeObjectEntries(o,Object.entries(e))}serializeBuiltInType(e,t){const n=this["$"+e];if(n)return n.call(this,t);if(typeof t?.entries=="function")return this.serializeObjectEntries(e,t.entries());throw new Error(`Cannot serialize ${e}`)}serializeObjectEntries(e,t){const n=Array.from(t).sort((r,p)=>this.compare(r[0],p[0]));let o=`${e}{`;for(let r=0;r<n.length;r++){const[p,f]=n[r];o+=`${this.serialize(p,!0)}:${this.serialize(f)}`,r<n.length-1&&(o+=",")}return o+"}"}$object(e){let t=this.#e.get(e);return t===void 0&&(this.#e.set(e,`#${this.#e.size}`),t=this.serializeObject(e),this.#e.set(e,t)),t}$function(e){const t=Function.prototype.toString.call(e);return t.slice(-15)==="[native code] }"?`${e.name||""}()[native]`:`${e.name}(${e.length})${t.replace(/\s*\n\s*/g,"")}`}$Array(e){let t="[";for(let n=0;n<e.length;n++)t+=this.serialize(e[n]),n<e.length-1&&(t+=",");return t+"]"}$Date(e){try{return`Date(${e.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(e){return`ArrayBuffer[${new Uint8Array(e).join(",")}]`}$Set(e){return`Set${this.$Array(Array.from(e).sort((t,n)=>this.compare(t,n)))}`}$Map(e){return this.serializeObjectEntries("Map",e.entries())}}for(const s of["Error","RegExp","URL"])c.prototype["$"+s]=function(e){return`${s}(${e})`};for(const s of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])c.prototype["$"+s]=function(e){return`${s}[${e.join(",")}]`};for(const s of["BigInt64Array","BigUint64Array"])c.prototype["$"+s]=function(e){return`${s}[${e.join("n,")}${e.length>0?"n":""}]`};return c})(),he=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],de=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],fe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",A=[];class pe{_data=new M;_hash=new M([...he]);_nDataBytes=0;_minBufferSize=0;finalize(s){s&&this._append(s);const e=this._nDataBytes*8,t=this._data.sigBytes*8;return this._data.words[t>>>5]|=128<<24-t%32,this._data.words[(t+64>>>9<<4)+14]=Math.floor(e/4294967296),this._data.words[(t+64>>>9<<4)+15]=e,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(s,e){const t=this._hash.words;let n=t[0],o=t[1],r=t[2],p=t[3],f=t[4],$=t[5],w=t[6],B=t[7];for(let u=0;u<64;u++){if(u<16)A[u]=s[e+u]|0;else{const i=A[u-15],l=(i<<25|i>>>7)^(i<<14|i>>>18)^i>>>3,g=A[u-2],a=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;A[u]=l+A[u-7]+a+A[u-16]}const z=f&$^~f&w,k=n&o^n&r^o&r,S=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),I=(f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25),j=B+I+z+de[u]+A[u],h=S+k;B=w,w=$,$=f,f=p+j|0,p=r,r=o,o=n,n=j+h|0}t[0]=t[0]+n|0,t[1]=t[1]+o|0,t[2]=t[2]+r|0,t[3]=t[3]+p|0,t[4]=t[4]+f|0,t[5]=t[5]+$|0,t[6]=t[6]+w|0,t[7]=t[7]+B|0}_append(s){typeof s=="string"&&(s=M.fromUtf8(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes}_process(s){let e,t=this._data.sigBytes/64;s?t=Math.ceil(t):t=Math.max((t|0)-this._minBufferSize,0);const n=t*16,o=Math.min(n*4,this._data.sigBytes);if(n){for(let r=0;r<n;r+=16)this._doProcessBlock(this._data.words,r);e=this._data.words.splice(0,n),this._data.sigBytes-=o}return new M(e,o)}}class M{words;sigBytes;constructor(s,e){s=this.words=s||[],this.sigBytes=e===void 0?s.length*4:e}static fromUtf8(s){const e=unescape(encodeURIComponent(s)),t=e.length,n=[];for(let o=0;o<t;o++)n[o>>>2]|=(e.charCodeAt(o)&255)<<24-o%4*8;return new M(n,t)}toBase64(){const s=[];for(let e=0;e<this.sigBytes;e+=3){const t=this.words[e>>>2]>>>24-e%4*8&255,n=this.words[e+1>>>2]>>>24-(e+1)%4*8&255,o=this.words[e+2>>>2]>>>24-(e+2)%4*8&255,r=t<<16|n<<8|o;for(let p=0;p<4&&e*8+p*6<this.sigBytes*8;p++)s.push(fe.charAt(r>>>6*(3-p)&63))}return s.join("")}concat(s){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let e=0;e<s.sigBytes;e++){const t=s.words[e>>>2]>>>24-e%4*8&255;this.words[this.sigBytes+e>>>2]|=t<<24-(this.sigBytes+e)%4*8}else for(let e=0;e<s.sigBytes;e+=4)this.words[this.sigBytes+e>>>2]=s.words[e>>>2];this.sigBytes+=s.sigBytes}}function ye(c){return new pe().finalize(c).toBase64()}function D(c){return ye(le(c))}function me(c,s,e){const[t={},n]=typeof s=="string"?[{},s]:[s,e],o=E(()=>b(c)),r=E(()=>b(t.key)||"$f"+D([n,typeof o.value=="string"?o.value:"",...ge(t)]));if(!t.baseURL&&typeof o.value=="string"&&o.value[0]==="/"&&o.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:p,lazy:f,default:$,transform:w,pick:B,watch:u,immediate:z,getCachedData:k,deep:S,dedupe:I,...j}=t,h=N({...G,...j,cache:typeof t.cache=="boolean"?void 0:t.cache}),i={server:p,lazy:f,default:$,transform:w,pick:B,immediate:z,getCachedData:k,deep:S,dedupe:I,watch:u===!1?[]:[...u||[],h]};let l;return ae(u===!1?r.value:r,()=>{l?.abort?.(new DOMException("Request aborted as another request to the same endpoint was initiated.","AbortError")),l=typeof AbortController<"u"?new AbortController:{};const a=b(t.timeout);let v;return a&&(v=setTimeout(()=>l.abort(new DOMException("Request aborted due to timeout.","AbortError")),a),l.signal.onabort=()=>clearTimeout(v)),(t.$fetch||globalThis.$fetch)(o.value,{signal:l.signal,...h}).finally(()=>{clearTimeout(v)})},i)}function ge(c){const s=[b(c.method)?.toUpperCase()||"GET",b(c.baseURL)];for(const e of[c.params||c.query]){const t=b(e);if(!t)continue;const n={};for(const[o,r]of Object.entries(t))n[b(o)]=b(r);s.push(n)}if(c.body){const e=b(c.body);if(!e)s.push(D(e));else if(e instanceof ArrayBuffer)s.push(D(Object.fromEntries([...new Uint8Array(e).entries()].map(([t,n])=>[t,n.toString()]))));else if(e instanceof FormData){const t={};for(const n of e.entries()){const[o,r]=n;t[o]=r instanceof File?r.name:r}s.push(D(t))}else if(V(e))s.push(D(N(e)));else try{s.push(D(e))}catch{console.warn("[useFetch] Failed to hash body",e)}}return s}const _e={class:"echo-container"},be={class:"echo-toolbar"},we={class:"echo-search"},ve=["href"],$e={key:0,class:"echo-loading"},Be={key:1,class:"echo-empty"},ze={key:2,class:"echo-empty"},ke={key:3,class:"timeline echo-timeline"},xe={class:"timeline-caption echo-time-caption"},Ae={class:"timeline-body echo-card card"},Se={key:0,class:"echo-card-content"},je={key:1,class:"echo-extension"},Ce={class:"extension-label"},Oe={key:0,class:"extension-type-text"},De=["href"],Ee={class:"extension-url"},Me={key:2,class:"echo-images"},Ie=["onClick"],Te={class:"echo-card-footer"},Ue={class:"echo-likes"},Le=["href"],Re={key:4,class:"echo-load-more"},Fe=20,Pe=H({__name:"echo",async setup(c){let s,e;const t=J();K().setAside(["blog-stats","blog-log"]),Q({title:"动态",meta:[{name:"description",content:`${t.title}的最新动态和短想法记录。`}]});const o=F(""),r=F(1),{data:p,pending:f,error:$}=([s,e]=Z(()=>me("/api/echo",{watch:!1},"$h5c9zGxgMR")),s=await s,e(),s),w=h=>{const l=new Date().getTime()-h.getTime(),g=Math.floor(l/1e3),a=Math.floor(g/60),v=Math.floor(a/60),C=Math.floor(v/24);if(g<60)return"刚刚";if(a<60)return`${a}分钟前`;if(v<24)return`${v}小时前`;if(C<7)return`${C}天前`;const R=["周日","周一","周二","周三","周四","周五","周六"][h.getDay()];return`${h.toLocaleDateString("zh-CN")} ${R}`},B=W(),u=h=>{const i=new Image;i.src=h;const{open:l}=B.use(()=>re(ce,{el:i}));l()},z=E(()=>p.value?.map(h=>({...h,relativeTime:w(new Date(h.created_at))}))||[]),k=E(()=>{if(!o.value.trim())return z.value;const h=o.value.toLowerCase();return z.value.filter(i=>i.content.toLowerCase().includes(h)||i.username.toLowerCase().includes(h))}),S=E(()=>{const i=r.value*Fe;return k.value.slice(0,i)}),I=E(()=>S.value.length<k.value.length),j=()=>{r.value++};return(h,i)=>{const l=Y,g=oe;return y(),m("div",_e,[d("div",be,[d("div",we,[_(l,{name:"mdi:magnify",size:"20",class:"search-icon"}),X(d("input",{"onUpdate:modelValue":i[0]||(i[0]=a=>te(o)?o.value=a:null),type:"text",placeholder:"搜索动态...",class:"search-input"},null,512),[[ee,x(o)]])]),d("a",{href:x(se).echo.rss,target:"_blank",rel:"noopener noreferrer",class:"echo-rss-btn",title:"订阅动态 RSS 源"},[_(l,{name:"mdi:rss",size:"18"})],8,ve)]),x(f)?(y(),m("div",$e,[_(l,{name:"eos-icons:loading",size:"32"}),i[1]||(i[1]=d("p",null,"加载中...",-1))])):x(z).length===0?(y(),m("div",Be,[_(l,{name:"solar:inbox-line-duotone",size:"48"}),i[2]||(i[2]=d("p",null,"暂无动态",-1))])):x(k).length===0?(y(),m("div",ze,[_(l,{name:"solar:magnifer-line-duotone",size:"48"}),i[3]||(i[3]=d("p",null,"未找到匹配的动态",-1))])):(y(),m("dl",ke,[(y(!0),m(L,null,P(x(S),(a,v)=>(y(),m(L,{key:a.id},[d("dt",xe,[d("span",null,T(a.relativeTime),1)]),d("dd",Ae,[a.content?(y(),m("div",Se,T(a.content),1)):O("",!0),a.extension&&a.extension_type?(y(),m("div",je,[d("div",Ce,[i[4]||(i[4]=q(" 分享了 ",-1)),a.extension_type==="GITHUBPROJ"?(y(),m("span",Oe,"GitHub 项目")):O("",!0)]),d("a",{href:a.extension,target:"_blank",rel:"noopener noreferrer",class:"extension-link"},[a.extension_type==="GITHUBPROJ"?(y(),ne(l,{key:0,name:"mdi:github",size:"20"})):O("",!0),d("span",Ee,T(a.extension),1),_(l,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,De)])):O("",!0),a.images&&a.images.length>0?(y(),m("div",Me,[(y(!0),m(L,null,P(a.images,(C,U)=>(y(),m("button",{key:U,class:"echo-image-button",onClick:R=>u(C.image_url)},[_(g,{src:C.image_url,alt:`Echo image ${U+1}`,class:"echo-image",loading:"lazy",fit:"cover"},null,8,["src","alt"])],8,Ie))),128))])):O("",!0),d("div",Te,[d("span",Ue,[_(l,{name:"mdi:heart",size:"16"}),q(" "+T(a.fav_count),1)]),d("a",{href:`https://memo.sotkg.com/echo/${a.id}`,target:"_blank",class:"echo-read-more"}," 查看 → ",8,Le)])])],64))),128))])),x(I)?(y(),m("div",Re,[d("button",{class:"load-more-btn",onClick:j},[_(l,{name:"mdi:chevron-down",size:"20"}),i[5]||(i[5]=d("span",null,"加载更多",-1))])])):O("",!0)])}}}),He=ie(Pe,[["__scopeId","data-v-abb3f822"]]);export{He as default};
