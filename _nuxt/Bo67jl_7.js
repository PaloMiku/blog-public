import{z as Q,r as C,bg as q,G as u,ae as w,bh as x,d as B,e as b,g as Y,bc as K,w as T,Q as U,f as M,S as Z,a3 as tt,T as P,h as et,t as nt,J as at,F as ot,bi as it,_ as st}from"./bp8TqfHi.js";const lt={key:0,class:"tooltip"},ct={key:0,class:"caption"},j=.8,rt=Q({__name:"Lightbox",props:{el:{},caption:{},show:{type:Boolean},images:{},currentIndex:{}},emits:["close","navigate"],setup(s,{emit:O}){const o=s,d=O,v=o.el.getBoundingClientRect(),W=C(),p=q(W),{width:y,height:_}=it(),h=C(o.currentIndex??0),k=u(()=>o.images||[]);u(()=>k.value.length>1),u(()=>k.value[h.value]||o.el.src);const S=u(()=>h.value>0),D=u(()=>h.value<k.value.length-1);function G(){S.value&&(h.value--,d("navigate",h.value))}function V(){D.value&&(h.value++,d("navigate",h.value))}let f,X,$;const g=C({}),R=u(()=>Object.values(g.value).slice(0,2)),m=u(()=>L("current")),z=u(()=>N("current"));function E(t,e,n){if(n<1)return t<Math.min(y.value,v.width,o.el.naturalWidth)&&e<Math.min(_.value,v.height,o.el.naturalHeight);if(n>1)return t>Math.max(y.value,v.width,o.el.naturalWidth)&&e>Math.max(_.value,v.height,o.el.naturalHeight)}function A(t){const{left:e,top:n,width:a,height:i}=p.value.getBoundingClientRect();if(E(a,i,1-t.deltaY))return;const c=Math.abs(t.deltaY)<8?Math.abs(t.deltaY)*.05:.5,r=t.deltaY>0?1/(1+c):1+c;x(p,{left:e-(t.clientX-e)*(r-1),top:n-(t.clientY-n)*(r-1),width:a*r,height:i*r})}function H(){for(const t of Object.values(g.value))t.startX=t.currentX,t.startY=t.currentY;f=p.value.getBoundingClientRect(),X=L("start"),$=N("start")}function L(t){const e=R.value;return{x:e.reduce((n,a)=>n+a[`${t}X`],0)/e.length,y:e.reduce((n,a)=>n+a[`${t}Y`],0)/e.length}}function N(t){const[e,n]=R.value;return!e||!n?0:Math.hypot(e[`${t}X`]-n[`${t}X`],e[`${t}Y`]-n[`${t}Y`])}w("pointerdown",t=>{g.value[t.pointerId]={startX:t.clientX,startY:t.clientY,currentX:t.clientX,currentY:t.clientY},H()}),w("pointermove",t=>{const e=g.value[t.pointerId];if(!e)return;e.currentX=t.clientX,e.currentY=t.clientY;const n=z.value/$||1,a=f.width*n,i=f.height*n;if(E(a,i,n))return;const l=f.left+m.value.x-X.x,c=f.top+m.value.y-X.y,r=l-(m.value.x-l)*(n-1),I=c-(m.value.y-c)*(n-1);x(p,{left:r,top:I,width:a,height:i},{duration:0})}),w("pointerup",t=>{delete g.value[t.pointerId],Object.keys(g.value).length&&H()});function F(t,e){const n=window.innerWidth*j,a=window.innerHeight*j,i=o.el.naturalWidth/o.el.naturalHeight,[l,c]=n/a>i?[a*i,a]:[n,n/i],r=(y.value-l)/2,I=(_.value-c)/2;x(t,[v,{left:r,top:I,width:l,height:c}]).onfinish=e}function J(t,e){x(t,o.el).onfinish=e}return w("keydown",t=>{t.key==="Escape"?d("close"):t.key==="ArrowLeft"?G():t.key==="ArrowRight"&&V()}),(t,e)=>{const n=K,a=Z,i=at;return b(),B(ot,null,[Y(n,{show:s.show,blur:"",onClick:e[0]||(e[0]=l=>d("close"))},null,8,["show"]),Y(P,{onEnter:F,onLeave:J},{default:T(()=>[s.show?(b(),U(a,{key:0,ref_key:"lightbox",ref:W,class:"image",alt:s.el.alt,width:s.el.width,height:s.el.height,src:s.el.src,draggable:"false",onWheel:tt(A,["prevent"])},null,8,["alt","width","height","src"])):M("",!0)]),_:1}),Y(P,null,{default:T(()=>[s.show?(b(),B("div",lt,[s.caption?(b(),B("span",ct,nt(s.caption),1)):M("",!0),et("button",{class:"close","aria-label":"关闭灯箱",onClick:e[1]||(e[1]=l=>d("close"))},[Y(i,{name:"ph:x-bold"})])])):M("",!0)]),_:1})],64)}}}),ht=Object.assign(st(rt,[["__scopeId","data-v-e35eebc2"]]),{__name:"PopoverLightbox"});export{ht as default};
