const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DChHDMxO.js","./LivvtlNw.js","./BEFc8N7m.js","./entry.piGVilDC.css","./Lightbox.CBHK7Kjn.css"])))=>i.map(i=>d[i]);
import{k as O,Z as A,n as X,bk as ee,bl as te,J as se,ag as ne,r as N,bm as oe,Q as g,aN as _,b5 as p,aQ as R,aR as v,aP as re,bn as ie,K as y,l as ae,aZ as Q,aU as q,aV as G,b8 as C,b7 as Z,bo as ce,M as le,ah as ue,a7 as he,b4 as de}from"./LivvtlNw.js";import{u as pe,a as fe,b as me,c as W,_ as ge}from"./BEFc8N7m.js";import{t as _e}from"./Bc9GU-sc.js";import{u as ye}from"./Cp11Gdl2.js";function be(i){return typeof i=="string"?`'${i}'`:new $e().serialize(i)}const $e=(function(){class i{#e=new Map;compare(e,t){const n=typeof e,o=typeof t;return n==="string"&&o==="string"?e.localeCompare(t):n==="number"&&o==="number"?e-t:String.prototype.localeCompare.call(this.serialize(e,!0),this.serialize(t,!0))}serialize(e,t){if(e===null)return"null";switch(typeof e){case"string":return t?e:`'${e}'`;case"bigint":return`${e}n`;case"object":return this.$object(e);case"function":return this.$function(e)}return String(e)}serializeObject(e){const t=Object.prototype.toString.call(e);if(t!=="[object Object]")return this.serializeBuiltInType(t.length<10?`unknown:${t}`:t.slice(8,-1),e);const n=e.constructor,o=n===Object||n===void 0?"":n.name;if(o!==""&&globalThis[o]===n)return this.serializeBuiltInType(o,e);if(typeof e.toJSON=="function"){const r=e.toJSON();return o+(r!==null&&typeof r=="object"?this.$object(r):`(${this.serialize(r)})`)}return this.serializeObjectEntries(o,Object.entries(e))}serializeBuiltInType(e,t){const n=this["$"+e];if(n)return n.call(this,t);if(typeof t?.entries=="function")return this.serializeObjectEntries(e,t.entries());throw new Error(`Cannot serialize ${e}`)}serializeObjectEntries(e,t){const n=Array.from(t).sort((r,c)=>this.compare(r[0],c[0]));let o=`${e}{`;for(let r=0;r<n.length;r++){const[c,f]=n[r];o+=`${this.serialize(c,!0)}:${this.serialize(f)}`,r<n.length-1&&(o+=",")}return o+"}"}$object(e){let t=this.#e.get(e);return t===void 0&&(this.#e.set(e,`#${this.#e.size}`),t=this.serializeObject(e),this.#e.set(e,t)),t}$function(e){const t=Function.prototype.toString.call(e);return t.slice(-15)==="[native code] }"?`${e.name||""}()[native]`:`${e.name}(${e.length})${t.replace(/\s*\n\s*/g,"")}`}$Array(e){let t="[";for(let n=0;n<e.length;n++)t+=this.serialize(e[n]),n<e.length-1&&(t+=",");return t+"]"}$Date(e){try{return`Date(${e.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(e){return`ArrayBuffer[${new Uint8Array(e).join(",")}]`}$Set(e){return`Set${this.$Array(Array.from(e).sort((t,n)=>this.compare(t,n)))}`}$Map(e){return this.serializeObjectEntries("Map",e.entries())}}for(const s of["Error","RegExp","URL"])i.prototype["$"+s]=function(e){return`${s}(${e})`};for(const s of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])i.prototype["$"+s]=function(e){return`${s}[${e.join(",")}]`};for(const s of["BigInt64Array","BigUint64Array"])i.prototype["$"+s]=function(e){return`${s}[${e.join("n,")}${e.length>0?"n":""}]`};return i})(),we=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],ve=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],ke="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",M=[];class Be{_data=new U;_hash=new U([...we]);_nDataBytes=0;_minBufferSize=0;finalize(s){s&&this._append(s);const e=this._nDataBytes*8,t=this._data.sigBytes*8;return this._data.words[t>>>5]|=128<<24-t%32,this._data.words[(t+64>>>9<<4)+14]=Math.floor(e/4294967296),this._data.words[(t+64>>>9<<4)+15]=e,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(s,e){const t=this._hash.words;let n=t[0],o=t[1],r=t[2],c=t[3],f=t[4],k=t[5],E=t[6],B=t[7];for(let d=0;d<64;d++){if(d<16)M[d]=s[e+d]|0;else{const z=M[d-15],I=(z<<25|z>>>7)^(z<<14|z>>>18)^z>>>3,S=M[d-2],F=(S<<15|S>>>17)^(S<<13|S>>>19)^S>>>10;M[d]=I+M[d-7]+F+M[d-16]}const m=f&k^~f&E,b=n&o^n&r^o&r,j=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),D=(f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25),x=B+D+m+ve[d]+M[d],L=j+b;B=E,E=k,k=f,f=c+x|0,c=r,r=o,o=n,n=x+L|0}t[0]=t[0]+n|0,t[1]=t[1]+o|0,t[2]=t[2]+r|0,t[3]=t[3]+c|0,t[4]=t[4]+f|0,t[5]=t[5]+k|0,t[6]=t[6]+E|0,t[7]=t[7]+B|0}_append(s){typeof s=="string"&&(s=U.fromUtf8(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes}_process(s){let e,t=this._data.sigBytes/64;s?t=Math.ceil(t):t=Math.max((t|0)-this._minBufferSize,0);const n=t*16,o=Math.min(n*4,this._data.sigBytes);if(n){for(let r=0;r<n;r+=16)this._doProcessBlock(this._data.words,r);e=this._data.words.splice(0,n),this._data.sigBytes-=o}return new U(e,o)}}class U{words;sigBytes;constructor(s,e){s=this.words=s||[],this.sigBytes=e===void 0?s.length*4:e}static fromUtf8(s){const e=unescape(encodeURIComponent(s)),t=e.length,n=[];for(let o=0;o<t;o++)n[o>>>2]|=(e.charCodeAt(o)&255)<<24-o%4*8;return new U(n,t)}toBase64(){const s=[];for(let e=0;e<this.sigBytes;e+=3){const t=this.words[e>>>2]>>>24-e%4*8&255,n=this.words[e+1>>>2]>>>24-(e+1)%4*8&255,o=this.words[e+2>>>2]>>>24-(e+2)%4*8&255,r=t<<16|n<<8|o;for(let c=0;c<4&&e*8+c*6<this.sigBytes*8;c++)s.push(ke.charAt(r>>>6*(3-c)&63))}return s.join("")}concat(s){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let e=0;e<s.sigBytes;e++){const t=s.words[e>>>2]>>>24-e%4*8&255;this.words[this.sigBytes+e>>>2]|=t<<24-(this.sigBytes+e)%4*8}else for(let e=0;e<s.sigBytes;e+=4)this.words[this.sigBytes+e>>>2]=s.words[e>>>2];this.sigBytes+=s.sigBytes}}function xe(i){return new Be().finalize(i).toBase64()}function T(i){return xe(be(i))}function Ee(i,s,e){const[t={},n]=typeof s=="string"?[{},s]:[s,e],o=O(()=>A(i)),r=O(()=>A(t.key)||"$f"+T([n,typeof o.value=="string"?o.value:"",...ze(t)]));if(!t.baseURL&&typeof o.value=="string"&&o.value[0]==="/"&&o.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:c,lazy:f,default:k,transform:E,pick:B,watch:d,immediate:m,getCachedData:b,deep:j,dedupe:D,timeout:x,...L}=t,z=X({...ee,...L,cache:typeof t.cache=="boolean"?void 0:t.cache}),I={server:c,lazy:f,default:k,transform:E,pick:B,immediate:m,getCachedData:b,deep:j,dedupe:D,timeout:x,watch:d===!1?[]:[...d||[],z]};return ye(d===!1?r.value:r,(F,{signal:V})=>(t.$fetch||globalThis.$fetch)(o.value,{signal:V,...z}),I)}function ze(i){const s=[A(i.method)?.toUpperCase()||"GET",A(i.baseURL)];for(const e of[i.params||i.query]){const t=A(e);if(!t)continue;const n={};for(const[o,r]of Object.entries(t))n[A(o)]=A(r);s.push(n)}if(i.body){const e=A(i.body);if(!e)s.push(T(e));else if(e instanceof ArrayBuffer)s.push(T(Object.fromEntries([...new Uint8Array(e).entries()].map(([t,n])=>[t,n.toString()]))));else if(e instanceof FormData){const t={};for(const n of e.entries()){const[o,r]=n;t[o]=r instanceof File?r.name:r}s.push(T(t))}else if(te(e))s.push(T(X(e)));else try{s.push(T(e))}catch{console.warn("[useFetch] Failed to hash body",e)}}return s}function Se(i){const s=i.split(`
`),e=[];let t=!1,n="",o=[],r=0;for(;r<s.length;){const c=s[r];if(c.trimStart().match(/^```/)){if(t){const m=o.join(`
`);e.push(`<pre><code${n?` class="language-${n}"`:""}>${H(m)}</code></pre>`),t=!1,o=[],n=""}else{t=!0;const m=c.trimStart().match(/^```(.*)$/);n=m?m[1].trim():"",o=[]}r++;continue}if(t){o.push(c),r++;continue}if(!c.trim()){r++;continue}const f=c.trimStart().match(/^(#{1,6})\s+(.+)$/);if(f){const m=f[1].length,b=f[2],j=P(b);e.push(`<h${m}>${j}</h${m}>`),r++;continue}const k=c.trimStart().match(/^>\s+(.+)$/);if(k){const m=k[1],b=P(m);e.push(`<blockquote>${b}</blockquote>`),r++;continue}const E=c.trimStart().match(/^[\*\-]\s+(.+)$/);if(E){const m=E[1],b=P(m);e.push(`<ul><li>${b}</li></ul>`),r++;continue}const B=c.trimStart().match(/^\d+\.\s+(.+)$/);if(B){const m=B[1],b=P(m);e.push(`<ol><li>${b}</li></ol>`),r++;continue}const d=P(c);e.push(`<p>${d}</p>`),r++}if(t&&o.length>0){const c=o.join(`
`);e.push(`<pre><code${n?` class="language-${n}"`:""}>${H(c)}</code></pre>`)}return e.join("")}function P(i){let s=i;const e=[],t="\0CODE";return s=s.replace(/`([^`]+)`/g,n=>{const o=e.length;return e.push(`<code>${H(n.slice(1,-1))}</code>`),`${t}${o}${t}`}),s=s.replace(/\[([^\]]+)\]\(([^\)]+)\)/g,(n,o,r)=>`<a href="${H(r)}" target="_blank" rel="noopener noreferrer">${o}</a>`),s=s.replace(/\*\*([^\*]+)\*\*/g,"<strong>$1</strong>"),s=s.replace(/~~([^~]+)~~/g,"<del>$1</del>"),s=s.replace(/\*([^\*\n]+)\*/g,"<em>$1</em>"),s=s.replace(/_([^_\n]+)_/g,"<em>$1</em>"),e.forEach((n,o)=>{s=s.replace(`${t}${o}${t}`,n)}),s}function H(i){const s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return i.replace(/[&<>"']/g,e=>s[e]||e)}const je=ue(()=>he(()=>import("./DChHDMxO.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(i=>i.default||i)),Ce={class:"echo-container"},Ae={class:"echo-toolbar"},Ie={class:"echo-search"},Me=["disabled","title"],Oe=["href"],Te={key:0,class:"echo-loading"},Ue={key:1,class:"echo-empty"},De={key:2,class:"echo-empty"},Le={key:3,class:"timeline echo-timeline"},Re={class:"timeline-caption"},Pe={class:"timeline-body echo-card card"},Fe=["innerHTML"],Ne={key:1,class:"echo-tags"},qe=["href","title"],He={key:2,class:"echo-extension"},Ve={class:"extension-label"},Ge={class:"extension-type-text"},We=["href"],Je={class:"website-content"},Ke={class:"website-title"},Qe={class:"website-url"},Ze=["href"],Xe={class:"extension-url"},Ye={key:3,class:"echo-images"},et=["onClick"],tt={class:"echo-card-footer"},st={class:"echo-likes"},nt=["href"],ot={key:4,class:"echo-load-more"},rt=["disabled"],it=10,at=se({__name:"echo",async setup(i){let s,e;const t=pe(),n=fe(),o=me();n.setAside(["blog-stats","blog-log"]),ne({meta:[{name:"description",content:`${t?.title||"Echo"}的最新动态和短想法记录。`}]});const r=N(""),c=N(1),{data:f,pending:k,refresh:E}=([s,e]=oe(()=>Ee(`${W.echo.apiBase}${W.echo.apiEndpoint}?page=1&pageSize=100`,{watch:!1,default:()=>({data:{items:[]}})},"$h5c9zGxgMR")),s=await s,e(),s),B=O(()=>{const l=f.value?.data?.items;return l?.length?l.filter(u=>!u.private).sort((u,h)=>new Date(h.created_at).getTime()-new Date(u.created_at).getTime()):[]}),d=N(!1),m=async()=>{if(!d.value){d.value=!0;try{c.value=1,r.value="",await E()}catch(l){console.error("Failed to refresh echos:",l)}finally{d.value=!1}}},b=O(()=>{const l=r.value.trim().toLowerCase();return l?B.value.filter(u=>{if(!u)return!1;const h=u.content?.toLowerCase()||"",w=u.username?.toLowerCase()||"";return h.includes(l)||w.includes(l)}):B.value}),j=O(()=>{const l=c.value*it;return b.value.slice(0,l)}),D=O(()=>j.value.length<b.value.length),x=N(!1),L=async()=>{x.value||(x.value=!0,await new Promise(l=>setTimeout(l,300)),c.value++,x.value=!1)},z={GITHUBPROJ:{label:"GitHub 项目",icon:"mdi:github"},GITHUB:{label:"GitHub",icon:"mdi:github"},MUSIC:{label:"音乐",icon:"mdi:music"},WEBSITE:{label:"网站",icon:"mdi:globe"},LINK:{label:"链接",icon:"mdi:link"}},I=l=>z[l]||{label:l,icon:"mdi:link"},S=new Map,F=l=>{if(!l||typeof l!="string")return{title:"无效链接",site:"#",hostname:"无效链接"};if(S.has(l))return S.get(l);let u;try{const h=JSON.parse(l);if(!h||typeof h!="object")throw new Error("Invalid data structure");let w="",a=h.site||"";if(a)try{const $=new URL(a);if($.protocol!=="http:"&&$.protocol!=="https:")throw new Error("Invalid protocol");w=$.hostname}catch{a="#",w="无效链接"}u={title:(h.title||"").toString().trim()||"无标题",site:a,hostname:w}}catch{u={title:"解析失败",site:"#",hostname:"解析失败"}}return S.set(l,u),u},V=(l,u)=>{try{const h=l.currentTarget||null;let w=null;if(h&&(w=h.querySelector("img")),!w&&u){if(!u.trim()||!u.startsWith("http://")&&!u.startsWith("https://")){console.warn("Invalid image source:",u);return}const $=new Image;$.src=u,w=$}if(!w){console.warn("No valid image element found for lightbox");return}const{open:a}=o.use(()=>le(je,{el:w}));a()}catch(h){console.error("Failed to open image lightbox:",h)}},J=O(()=>j.value.map(l=>({...l,parsedExtension:l.extension&&l.extension_type==="WEBSITE"?F(l.extension):null})));return(l,u)=>{const h=ge,w=ce;return _(),g("div",Ce,[p("div",Ae,[p("div",Ie,[v(h,{name:"mdi:magnify",size:"20",class:"search-icon"}),re(p("input",{"onUpdate:modelValue":u[0]||(u[0]=a=>ae(r)?r.value=a:null),type:"text",placeholder:"搜索动态...",class:"search-input"},null,512),[[ie,y(r)]])]),p("button",{disabled:y(d)||y(k),class:"echo-refresh-btn",title:y(d)?"刷新中...":"手动刷新动态",onClick:m},[v(h,{name:"mdi:refresh",size:"18",class:Q({spin:y(d)})},null,8,["class"])],8,Me),p("a",{href:y(W).echo.rss,target:"_blank",rel:"noopener noreferrer",class:"echo-rss-btn",title:"订阅动态 RSS 源"},[v(h,{name:"mdi:rss",size:"18"})],8,Oe)]),y(k)?(_(),g("div",Te,[v(h,{name:"eos-icons:loading",size:"32"}),u[1]||(u[1]=p("p",null,"加载中...",-1))])):y(B).length===0?(_(),g("div",Ue,[v(h,{name:"solar:inbox-line-duotone",size:"48"}),u[2]||(u[2]=p("p",null,"暂无动态",-1))])):y(b).length===0?(_(),g("div",De,[v(h,{name:"solar:magnifer-line-duotone",size:"48"}),u[3]||(u[3]=p("p",null,"未找到匹配的动态",-1))])):(_(),g("dl",Le,[(_(!0),g(q,null,G(y(J),a=>(_(),g(q,{key:a.id},[p("dt",Re,[p("span",null,C(y(_e)(a.created_at)),1)]),p("dd",Pe,[a.content?(_(),g("div",{key:0,class:"echo-card-content",innerHTML:y(Se)(a.content)},null,8,Fe)):R("",!0),a.tags?.length?(_(),g("div",Ne,[(_(!0),g(q,null,G(a.tags,$=>(_(),g("a",{key:$.id,href:`https://echo.sotkg.com/?tag=${encodeURIComponent($.name)}`,target:"_blank",rel:"noopener noreferrer",class:"echo-tag",title:`使用数: ${$.usage_count}`}," #"+C($.name),9,qe))),128))])):R("",!0),a.extension&&a.extension_type?(_(),g("div",He,[p("div",Ve,[u[4]||(u[4]=Z(" 分享了 ",-1)),p("span",Ge,C(I(a.extension_type).label),1)]),a.extension_type==="WEBSITE"&&a.parsedExtension?(_(),g("a",{key:0,href:a.parsedExtension.site,target:"_blank",rel:"noopener noreferrer",class:"extension-link website-link"},[v(h,{name:I(a.extension_type).icon,size:"20"},null,8,["name"]),p("div",Je,[p("div",Ke,C(a.parsedExtension.title),1),p("div",Qe,C(a.parsedExtension.hostname),1)]),v(h,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,We)):(_(),g("a",{key:1,href:a.extension,target:"_blank",rel:"noopener noreferrer",class:"extension-link"},[v(h,{name:I(a.extension_type).icon,size:"20"},null,8,["name"]),p("span",Xe,C(a.extension),1),v(h,{name:"mdi:arrow-top-right",size:"16",class:"extension-arrow"})],8,Ze))])):R("",!0),a.images?.length?(_(),g("div",Ye,[(_(!0),g(q,null,G(a.images,($,K)=>(_(),g("button",{key:K,class:"echo-image-button",onClick:Y=>V(Y,$.image_url)},[v(w,{src:$.image_url,alt:`Echo image ${K+1}`,class:"echo-image",loading:"lazy",fit:"cover"},null,8,["src","alt"])],8,et))),128))])):R("",!0),p("div",tt,[p("span",st,[v(h,{name:"mdi:heart",size:"16"}),Z(" "+C(a.fav_count),1)]),p("a",{href:`https://echo.sotkg.com/echo/${a.id}`,target:"_blank",class:"echo-read-more"}," 查看原文 → ",8,nt)])])],64))),128))])),y(D)?(_(),g("div",ot,[p("button",{class:"load-more-btn",disabled:y(x),onClick:L},[v(h,{name:y(x)?"eos-icons:loading":"mdi:chevron-down",size:"20",class:Q({spin:y(x)})},null,8,["name","class"]),p("span",null,C(y(x)?"装填中...":"继续装填"),1)],8,rt)])):R("",!0)])}}}),dt=de(at,[["__scopeId","data-v-929b3457"]]);export{dt as default};
