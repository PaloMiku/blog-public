import{z as b,E as C,r as g,ae as x,ad as w,G,d as m,f as _,L as e,e as c,h as a,t as d,Q as $,n as B,g as h,J as E,aV as z,_ as N}from"./CyLn58k_.js";import V from"./dBVHZCPH.js";import"./CAtE-ks5.js";const P=["title"],S={class:"game-header"},j=["src","alt"],D={class:"game-content"},F={class:"content-top"},L={class:"game-name"},M={class:"game-stats"},T={class:"stat-row"},W={class:"stat-group time-group"},I={class:"time-text"},J={class:"stat-value"},O={class:"achievements-info"},Q={class:"achievements-label"},U={class:"achievements-count"},q={key:0,class:"price-value"},A={key:1,class:"game-card game-card-error"},H={class:"error-content"},K={key:2,class:"game-card game-card-loading"},R=b({__name:"GameCard",props:{game:{default:void 0},appid:{default:void 0}},setup(f){const p=f,y=`${C.steam?.apiBase}/steam-game`,u=new Map,i=g(!1),l=g(!1),v=g(null);let r=null;x(()=>p.appid,async o=>{if(o&&!p.game){if(u.has(o)){v.value=u.get(o)??null,i.value=!1,l.value=!1;return}i.value=!0,l.value=!1,r&&r.abort(),r=new AbortController;try{const t=await fetch(`${y}?appid=${o}`,{signal:r.signal});if(t.ok){const n=await t.json();n.success&&n.data?.game?(v.value=n.data.game,u.set(o,n.data.game)):l.value=!0}else l.value=!0}catch(t){t instanceof Error&&t.name!=="AbortError"&&(console.error("[GameCard] Fetch error:",t),l.value=!0)}finally{i.value=!1}}},{immediate:!0}),w(()=>{r&&r.abort()});const s=G(()=>p.game||v.value);function k(o){window.open(`https://store.steampowered.com/app/${o}`,"_blank")}return(o,t)=>{const n=E;return!e(i)&&e(s)?(c(),m("div",{key:0,class:"game-card",title:`点击查看 ${e(s).name} 的 Steam 页面`,onClick:t[0]||(t[0]=X=>k(e(s).appid))},[a("div",S,[a("img",{src:e(s).images.headerImage,alt:e(s).name,class:"header-image",loading:"lazy"},null,8,j),t[1]||(t[1]=a("div",{class:"game-overlay"},null,-1))]),a("div",D,[a("div",F,[a("h3",L,d(e(s).name),1),a("div",M,[a("div",T,[a("div",W,[a("div",I,[t[2]||(t[2]=a("span",{class:"stat-label"},"总时长",-1)),a("span",J,d(e(s).playtimeForever)+"h",1)]),e(s).playtimeTwoWeeks?(c(),$(V,{key:0,text:`最近 ${e(s).playtimeTwoWeeks}h`},null,8,["text"])):_("",!0)])])])]),e(s).achievements?(c(),m("div",{key:0,class:B(["achievements-section",{complete:e(s).achievements.percentage===100}])},[a("div",O,[a("div",Q,[h(n,{name:"ph:trophy-bold",size:"14",class:"achievements-icon"}),a("span",U,d(e(s).achievements.unlocked)+" / "+d(e(s).achievements.total),1)]),e(s).price?(c(),m("span",q,d(e(s).price.displayPrice),1)):_("",!0)]),h(z,{percent:e(s).achievements.percentage,"show-time":!1,height:"6px","bar-color":e(s).achievements.percentage===100?"#10b981":""},null,8,["percent","bar-color"])],2)):_("",!0)])],8,P)):e(l)?(c(),m("div",A,[a("div",H,[h(n,{name:"ph:warning-circle",size:"24",class:"error-icon"}),t[3]||(t[3]=a("p",null,"无法加载游戏信息",-1))])])):e(i)?(c(),m("div",K,[...t[4]||(t[4]=[a("div",{class:"loading-skeleton"},null,-1)])])):_("",!0)}}}),ae=Object.assign(N(R,[["__scopeId","data-v-39704cb6"]]),{__name:"GameCard"});export{ae as default};
