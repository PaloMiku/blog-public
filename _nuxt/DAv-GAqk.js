import{d as K,c as D,ax as Q,O as Y,as as Z,ay as tt,X as et,I as nt,k as G,o as M,h as F,f as P,u as E,t as H,e as L,j as ot,s as st}from"./Bimv5xXQ.js";function at(e,n){let t=0;for(;t<e.length;t++){const{text:r,ranges:c}=n[t]??{};if(e[t]!==r||c?.some(f=>f.collapsed))break}let o=e.length-1,a=n.length-1;for(;o>=0&&a>=0;o--,a--){const{text:r,ranges:c}=n[a]??{};if(e[o]!==r||c?.some(f=>f.collapsed))break}return t>o&&([t,o]=[o,t]),t=Math.max(0,t),o=Math.min(e.length-1,o)+1,e.length===n.length&&t+1===o?[t,o]:rt(e,t,o)}function rt(e,n,t){const o=a(Math.max(0,n+t-e.length));n-=o,t+=o;function a(u){const i=e.slice(0,n).indexOf(e[t],u);if(i===-1)return 0;for(let l=i,s=t;l<n-1;s++,l++)if(e[l+1]!==e[s+1])return a(u+1);return n-i}const r=e.join(`
`),c=e.slice(0,n).join(`
`).length,f=e.slice(0,t).join(`
`).length;let C=0;for(let u=n-1,i=f-1;u<t&&i>=c;u--){const l=e[u],s=r.lastIndexOf(l,i);if(s!==-1&&s>=c)C++,i=s-1;else break}let d=0;for(let u=t,i=c;u>=n&&i<f;u++){const l=e[u],s=r.indexOf(l,i);if(s!==-1&&s<f)d++,i=s+1;else break}return[n-C,t+d]}function lt(e,n){let t=0,o;return function(...a){o&&(clearTimeout(o),o=void 0);const r=performance.now();!t||r-t>=n?(e.apply(this,a),t=r):o=setTimeout(()=>{e.apply(this,a),t=performance.now(),o=void 0},n+t-r)}}function it(e){let n=!1;return function(...t){return n?!1:(n=!0,e.apply(this,t),!0)}}function ct(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0}function ft(e){return{mount:n};function n(t,o){const{lang:a,themes:r={light:"min-light",dark:"min-dark"},defaultTheme:c="light",selector:f=v=>`.${v}`,defaultSelector:C=":root",watch:d=!0,delay:u=33.4}=o,i=new CSSStyleSheet;document.adoptedStyleSheets.push(i);const l=new Map,s=[];function w(v,m){for(const{range:S,name:h}of m)CSS.highlights.get(h)?.delete(S),l.get(h)?.delete(S);for(const{range:S,color:h,theme:k,name:y}of v){const N=k===c;let b=CSS.highlights.get(y);b||(CSS.highlights.set(y,b=new Highlight),b.priority=N?0:1);let x=l.get(y);if(!x){l.set(y,x=new Set);const I=`${N?C:f(k)}::highlight(${y}) { color: ${h}; }`;i.insertRule(I)}b.add(S),x.add(S)}}const g=lt(()=>{const{innerText:v}=t,m=v.split(`
`),S=ut(t),[h,k]=at(m,s),y=k-m.length+s.length,N=s.splice(y);for(let p=h;p<y;p++)w([],s[p]?.info??[]);const b=s.at(-1)?.lastGrammarState;s.length=k-1,s.fill(null,h,k-1),s.push(W({lastGrammarState:b}),...N);let x=m.slice(0,h).reduce((p,O)=>p+O.length+1,0);const I=ht(v,S,x);for(let p=h;p<m.length;p++){const O=m[p],$=e.codeToTokens(O,{lang:a,themes:r,cssVariablePrefix:"",defaultColor:!1,grammarState:s[p-1]?.lastGrammarState}),R=[],B=[];for(const T of $.tokens[0]){if(!T.content.trim().length)continue;const[q,z]=I(x+T.offset),[U,J]=I(x+T.offset+T.content.length),j=document.createRange();j.setStart(q,z),j.setEnd(U,J),R.push(j),B.push(...dt(T,j))}const _=s[p]??=W();w(B,_.info),_.text=O,_.offset=x,_.ranges=R,_.info=B;const V=_.lastGrammarState?.getScopes(),A=$.grammarState?.getScopes(),X=V&&A&&ct(V,A);if(_.lastGrammarState=$.grammarState,!X)x+=O.length+1;else break}},u);return d&&t.addEventListener("input",g),g(),{dispose:it(()=>{d&&t.removeEventListener("input",g);const v=document.adoptedStyleSheets.indexOf(i);document.adoptedStyleSheets.splice(v,1);for(const[m,S]of l){const h=CSS.highlights.get(m);for(const k of S)h?.delete(k)}}),update:g}}}function ut(e){const n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),t=[];let o;for(;o=n.nextNode();)t.push(o);return t}function W(e={}){return{text:"",offset:0,lastGrammarState:void 0,ranges:[],info:[],...e}}function*dt(e,n){if(typeof e.htmlStyle=="object")for(const t in e.htmlStyle){const o=e.htmlStyle[t],a=`shiki-${t}-${o.slice(1).toLowerCase()}`;yield{range:n,color:o,theme:t,name:a}}}function ht(e,n,t){let o=0,a=0,r=!1;return t>0&&c(t),c;function c(f){for(;o<n.length;o++){const C=n[o],{textContent:d}=C;if(d)if(r||(a=e.indexOf(d,a),r=!0),a+d.length<f)a+=d.length,r=!1;else break}return[n[o],f-a]}}const pt={class:"copy"},gt={key:0,class:"prompt"},mt=["textContent"],St=K({__name:"Copy",props:{prompt:{type:[String,Boolean],default:"$"},code:{},lang:{}},setup(e){const n=e,t=D(()=>n.prompt!==!0),o=D(()=>n.lang??Q(n.prompt)),a=Y(!1),r=Z("code-input"),c=tt(),{copy:f,copied:C}=et(r);function d(){r.value&&(r.value.textContent=n.code??"",r.value.dispatchEvent(new Event("input")),a.value=!1)}function u(l){const{data:s,inputType:w}=l;(s?.includes(`
`)||w==="insertLineBreak")&&l.preventDefault()}function i(l){a.value=n.code!==l.target.textContent}return nt(async()=>{const l=await c.load();await c.loadLang(o.value),ft(l).mount(r.value,c.getOptions(o.value))}),(l,s)=>{const w=ot;return M(),G("code",pt,[E(t)?(M(),G("span",gt,H(l.prompt),1)):F("",!0),P("div",{ref:"code-input",contenteditable:"plaintext-only",class:"code",spellcheck:"false",onBeforeinput:s[0]||(s[0]=g=>u(g)),onInput:s[1]||(s[1]=g=>i(g)),textContent:H(l.code)},null,40,mt),s[3]||(s[3]=P("div",{class:"mask"},null,-1)),E(a)?(M(),G("button",{key:1,class:"operation","aria-label":"恢复原始内容",onClick:d},[L(w,{name:"ph:arrow-u-up-left-bold"})])):F("",!0),P("button",{class:"operation","aria-label":"复制",onClick:s[2]||(s[2]=g=>E(f)())},[L(w,{name:E(C)?"ph:check-bold":"ph:copy-bold"},null,8,["name"])])])}}}),xt=Object.assign(st(St,[["__scopeId","data-v-79f7a5fd"]]),{__name:"Copy"});export{xt as default};
