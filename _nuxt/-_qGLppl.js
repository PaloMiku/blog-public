const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ItAp5T8E.js","./G_R_oOSr.js","./entry.Bp-4TZiy.css","./Lightbox.CBHK7Kjn.css"])))=>i.map(i=>d[i]);
import{Q as v,R as M,d as L,B as b,a2 as C,ag as S,ah as $,o as I,ai as m,N as g,aj as N,ak as A,k as K,h as q,j as u,i as w,y,q as O,a6 as P,z as X}from"#entry";const z=v(()=>M(()=>import("./ItAp5T8E.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(c=>c.default||c.default||c)),B={class:"z-comment"},j={class:"text-creative"},R={id:"artalk"},V={class:"loading-box"},D=L({__name:"Comment",setup(c){const d=b(),p=C(),h=S(),f=N.getInstance(),T=$();function x(){return new Promise((t,o)=>{if(typeof window<"u"&&window.katex){t(window.katex);return}const e=document.querySelector('script[src*="katex"]');if(e){e.addEventListener("load",()=>t(window.katex)),e.addEventListener("error",o);return}const n=document.createElement("script");n.src="https://lib.baomitu.com/KaTeX/0.16.9/katex.min.js",n.onload=()=>t(window.katex),n.onerror=o,document.head.appendChild(n)})}async function l(){try{await x(),document.querySelectorAll("#artalk .atk-content:not(.math-processed)").forEach(o=>{o.classList.add("math-processed");let e=o.innerHTML;const n=e;e=e.replace(/\$\$([^$]+)\$\$/g,(a,s)=>{try{return`<span class="math-display">${window.katex.renderToString(s.trim(),{displayMode:!0})}</span>`}catch(r){return console.warn("KaTeX display render error:",r),a}}),e=e.replace(/\$([^$\n]+)\$/g,(a,s)=>{if(a.includes('<span class="math-'))return a;try{return`<span class="math-inline">${window.katex.renderToString(s.trim(),{displayMode:!1})}</span>`}catch(r){return console.warn("KaTeX inline render error:",r),a}}),e=e.replace(/```math\s*([\s\S]*?)```/g,(a,s)=>{try{return`<div class="math-block">${window.katex.renderToString(s.trim(),{displayMode:!0})}</div>`}catch(r){return console.warn("KaTeX math block render error:",r),a}}),e!==n&&(o.innerHTML=e)})}catch(t){console.error("Failed to load KaTeX:",t),setTimeout(()=>l(),1e3)}}function k(){document.querySelectorAll("#artalk .atk-content img").forEach(o=>{const e=o;e.style.cursor!=="zoom-in"&&(e.style.cursor="zoom-in",e.addEventListener("click",()=>{const{open:n}=T.use(()=>P(z,{el:e}));n()}))})}let i=null;function E(){const t=document.getElementById("artalk");t&&(i&&i.disconnect(),i=new MutationObserver(o=>{let e=!1,n=!1;o.forEach(a=>{a.type==="childList"&&a.addedNodes.length>0&&a.addedNodes.forEach(s=>{if(s.nodeType===Node.ELEMENT_NODE){const r=s;(r.tagName==="IMG"||r.querySelector("img"))&&(e=!0),(r.classList?.contains("atk-content")||r.querySelector(".atk-content"))&&(n=!0)}})}),e&&setTimeout(()=>k(),100),n&&setTimeout(()=>l(),500)}),i.observe(t,{childList:!0,subtree:!0}))}async function _(){try{await f.init({el:"#artalk",pageKey:p.path,pageTitle:document.title.replace(` | ${d.title}`,""),server:d.artalk?.server,site:d.artalk?.site,emoticons:"/assets/Owo-Artalk.json",darkMode:h.value==="dark"}),await m(()=>{setTimeout(()=>{k(),setTimeout(()=>l(),1e3),E()},500)})}catch(t){console.error("评论系统初始化失败:",t)}}return I(()=>{m(()=>{setTimeout(_,100)})}),g(()=>p.path,()=>{m(()=>{setTimeout(_,100)})}),g(()=>h.value,t=>{f.setDarkMode(t==="dark")}),A(()=>{i&&(i.disconnect(),i=null)}),(t,o)=>{const e=O;return q(),K("section",B,[u("h3",j,[w(e,{name:"i-hugeicons:comment-01",class:"comment-tip"}),o[0]||(o[0]=y("评论 ",-1))]),u("div",R,[u("p",V,[w(e,{name:"line-md:loading-twotone-loop",class:"loadig-img"}),o[1]||(o[1]=y("评论加载中... ",-1))])])])}}}),U=Object.assign(X(D,[["__scopeId","data-v-45f0b573"]]),{__name:"PostComment"});export{z as L,U as _};
