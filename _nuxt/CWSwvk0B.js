const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DRTj8LJX.js","./e2a45o_1.js","./PI9c30pl.js","./D-deoX8n.js","./entry.C-sGvGMb.css","./Lightbox.Bo6Lg9Gu.css"])))=>i.map(i=>d[i]);
import{J as b,N as S,q as l,o as _,aE as K,Q as $,aR as L,K as X,aO as I,b6 as k,aS as y,b8 as E,M as N,ai as A,a8 as z,b5 as O}from"./e2a45o_1.js";import{c as P,b as q,F as V,r as B,e as R,G as D,_ as j}from"./PI9c30pl.js";const F=A(()=>z(()=>import("./DRTj8LJX.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(m=>m.default||m)),G={key:0,class:"z-comment"},H={class:"text-creative"},U={id:"artalk"},J={class:"loading-box"},Q=b({__name:"Comment",setup(m){const u=P(),g=q(),w=V(),p=B(),f=D.getInstance(),x=R();function v(e){return!e||e==="/"||e.endsWith("/")?e:`${e}/`}function C(){return new Promise((e,n)=>{if(typeof window<"u"&&window.katex){e(window.katex);return}const o=document.querySelector('script[src*="katex"]');if(o){o.addEventListener("load",()=>e(window.katex)),o.addEventListener("error",()=>{console.warn("[KaTeX] 加载失败"),n(new Error("KaTeX 加载失败"))});return}const t=document.createElement("script");t.src="https://lib.baomitu.com/KaTeX/0.16.9/katex.min.js",t.onload=()=>{e(window.katex)},t.onerror=()=>{console.warn("[KaTeX] 加载失败"),n(new Error("KaTeX 脚本加载失败"))},document.head.appendChild(t)})}async function d(){try{await C();const e=typeof window<"u"?window.katex:void 0;if(!e){console.warn("[KaTeX] 未检测到 KaTeX 实例，稍后重试"),setTimeout(()=>d(),1e3);return}document.querySelectorAll("#artalk .atk-content:not(.math-processed)").forEach(o=>{o.classList.add("math-processed");let t=o.innerHTML;const i=t;t=t.replace(/\$\$([^$]+)\$\$/g,(r,a)=>{try{return`<span class="math-display">${e.renderToString(a.trim(),{displayMode:!0})}</span>`}catch(c){return console.warn("KaTeX display render error:",c),r}}),t=t.replace(/\$([^$\n]+)\$/g,(r,a)=>{if(r.includes('<span class="math-'))return r;try{return`<span class="math-inline">${e.renderToString(a.trim(),{displayMode:!1})}</span>`}catch(c){return console.warn("KaTeX inline render error:",c),r}}),t=t.replace(/```math\s*([\s\S]*?)```/g,(r,a)=>{try{return`<div class="math-block">${e.renderToString(a.trim(),{displayMode:!0})}</div>`}catch(c){return console.warn("KaTeX math block render error:",c),r}}),t!==i&&(o.innerHTML=t)})}catch(e){console.error("Failed to load KaTeX:",e),setTimeout(()=>d(),1e3)}}function T(){document.querySelectorAll("#artalk .atk-content img").forEach(n=>{const o=n;o.style.cursor!=="zoom-in"&&(o.style.cursor="zoom-in",o.addEventListener("click",()=>{const{open:t}=x.use(()=>N(F,{el:o}));t()}))})}let s=null;function M(){const e=document.getElementById("artalk");e&&(s&&s.disconnect(),s=new MutationObserver(n=>{let o=!1,t=!1;n.forEach(i=>{i.type==="childList"&&i.addedNodes.length>0&&i.addedNodes.forEach(r=>{if(r.nodeType===Node.ELEMENT_NODE){const a=r;(a.tagName==="IMG"||a.querySelector("img"))&&(o=!0),(a.classList?.contains("atk-content")||a.querySelector(".atk-content"))&&(t=!0)}})}),o&&setTimeout(()=>T(),100),t&&setTimeout(()=>d(),500)}),s.observe(e,{childList:!0,subtree:!0}))}async function h(){try{if(!p.showComments){f.destroy();return}const e=v(g.path);await f.init({el:"#artalk",pageKey:e,pageTitle:document.title.replace(` | ${u.title}`,""),server:u.artalk?.server,site:u.artalk?.site,emoticons:"/assets/Owo-Artalk.json",darkMode:w.value==="dark"}),await l(()=>{setTimeout(()=>{T(),setTimeout(()=>d(),1e3),M()},500)})}catch(e){console.error("[Artalk] 初始化失败:",e instanceof Error?e.message:e)}}return S(()=>{l(()=>{setTimeout(h,100)})}),_(()=>g.path,()=>{l(()=>{setTimeout(h,100)})}),_(()=>p.showComments,()=>{l(()=>{setTimeout(h,100)})}),_(()=>w.value,e=>{f.setDarkMode(e==="dark")}),K(()=>{s&&(s.disconnect(),s=null)}),(e,n)=>{const o=j;return X(p).showComments?(I(),$("section",G,[k("h3",H,[y(o,{name:"i-hugeicons:comment-01",class:"comment-tip"}),n[0]||(n[0]=E("评论 ",-1))]),k("div",U,[k("p",J,[y(o,{name:"line-md:loading-twotone-loop",class:"loadig-img"}),n[1]||(n[1]=E("评论加载中... ",-1))])])])):L("",!0)}}}),Z=Object.assign(O(Q,[["__scopeId","data-v-a5082f37"]]),{__name:"PostComment"});export{Z as _};
