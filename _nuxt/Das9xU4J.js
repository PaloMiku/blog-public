const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Zy8i1Kca.js","./Bs0C97mX.js","./entry.B1HM6x4S.css","./Lightbox.DUZZNB3u.css"])))=>i.map(i=>d[i]);
import{G as S,y as K,s as $,aL as L,ao as b,I,o as X,aK as m,ah as _,aM as N,c as A,d as z,f as O,Q as P,e as q,h as g,g as y,S as E,O as V,Z as B,$ as D,b as R,_ as j}from"./Bs0C97mX.js";const G=D(()=>R(()=>import("./Zy8i1Kca.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(u=>u.default||u)),H={key:0,class:"z-comment"},U={class:"text-creative"},F={id:"artalk"},Q={class:"loading-box"},W=S({__name:"Comment",setup(u){const p=K(),k=$(),w=L(),d=b(),f=N.getInstance(),x=I();function C(e){return!e||e==="/"||e.endsWith("/")?e:`${e}/`}function v(){return new Promise((e,o)=>{if(typeof window<"u"&&window.katex){e(window.katex);return}const n=document.querySelector('script[src*="katex"]');if(n){n.addEventListener("load",()=>e(window.katex)),n.addEventListener("error",()=>{console.warn("[KaTeX] 加载失败"),o(new Error("KaTeX 加载失败"))});return}const t=document.createElement("script");t.src="https://lib.baomitu.com/KaTeX/0.16.9/katex.min.js",t.onload=()=>{e(window.katex)},t.onerror=()=>{console.warn("[KaTeX] 加载失败"),o(new Error("KaTeX 脚本加载失败"))},document.head.appendChild(t)})}async function l(){try{await v();const e=typeof window<"u"?window.katex:void 0;if(!e){console.warn("[KaTeX] 未检测到 KaTeX 实例，稍后重试"),setTimeout(()=>l(),1e3);return}document.querySelectorAll("#artalk .atk-content:not(.math-processed)").forEach(n=>{n.classList.add("math-processed");let t=n.innerHTML;const i=t;t=t.replace(/\$\$([^$]+)\$\$/g,(r,a)=>{try{return`<span class="math-display">${e.renderToString(a.trim(),{displayMode:!0})}</span>`}catch(c){return console.warn("KaTeX display render error:",c),r}}),t=t.replace(/\$([^$\n]+)\$/g,(r,a)=>{if(r.includes('<span class="math-'))return r;try{return`<span class="math-inline">${e.renderToString(a.trim(),{displayMode:!1})}</span>`}catch(c){return console.warn("KaTeX inline render error:",c),r}}),t=t.replace(/```math\s*([\s\S]*?)```/g,(r,a)=>{try{return`<div class="math-block">${e.renderToString(a.trim(),{displayMode:!0})}</div>`}catch(c){return console.warn("KaTeX math block render error:",c),r}}),t!==i&&(n.innerHTML=t)})}catch(e){console.error("Failed to load KaTeX:",e),setTimeout(()=>l(),1e3)}}function T(){document.querySelectorAll("#artalk .atk-content img").forEach(o=>{const n=o;n.style.cursor!=="zoom-in"&&(n.style.cursor="zoom-in",n.addEventListener("click",()=>{const{open:t}=x.use(()=>B(G,{el:n}));t()}))})}let s=null;function M(){const e=document.getElementById("artalk");e&&(s&&s.disconnect(),s=new MutationObserver(o=>{let n=!1,t=!1;o.forEach(i=>{i.type==="childList"&&i.addedNodes.length>0&&i.addedNodes.forEach(r=>{if(r.nodeType===Node.ELEMENT_NODE){const a=r;(a.tagName==="IMG"||a.querySelector("img"))&&(n=!0),(a.classList?.contains("atk-content")||a.querySelector(".atk-content"))&&(t=!0)}})}),n&&setTimeout(()=>T(),100),t&&setTimeout(()=>l(),500)}),s.observe(e,{childList:!0,subtree:!0}))}async function h(){try{if(!d.showComments){f.destroy();return}const e=C(k.path);await f.init({el:"#artalk",pageKey:e,pageTitle:document.title.replace(` | ${p.title}`,""),server:p.artalk?.server,site:p.artalk?.site,emoticons:"/assets/Owo-Artalk.json",darkMode:w.value==="dark"}),await m(()=>{setTimeout(()=>{T(),setTimeout(()=>l(),1e3),M()},500)})}catch(e){console.error("[Artalk] 初始化失败:",e instanceof Error?e.message:e)}}return X(()=>{d.initCommentsSetting(),m(()=>{setTimeout(h,100)})}),_(()=>k.path,()=>{m(()=>{setTimeout(h,100)})}),_(()=>d.showComments,()=>{m(()=>{setTimeout(h,100)})}),_(()=>w.value,e=>{f.setDarkMode(e==="dark")}),A(()=>{s&&(s.disconnect(),s=null)}),(e,o)=>{const n=V;return P(d).showComments?(q(),z("section",H,[g("h3",U,[y(n,{name:"i-hugeicons:comment-01",class:"comment-tip"}),o[0]||(o[0]=E("评论 ",-1))]),g("div",F,[g("p",Q,[y(n,{name:"line-md:loading-twotone-loop",class:"loadig-img"}),o[1]||(o[1]=E("评论加载中... ",-1))])])])):O("",!0)}}}),J=Object.assign(j(W,[["__scopeId","data-v-64f1318a"]]),{__name:"PostComment"});export{J as _};
