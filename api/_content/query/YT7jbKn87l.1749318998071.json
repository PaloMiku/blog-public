{"_path":"/2024/10/shiroi-docker-deployment","_dir":"10","_draft":false,"_partial":false,"_locale":"","title":"GitHub Action 构建 Shiroi Docker 镜像","description":"在本文了解如何通过 Github Action 构建 Shiroi Docker 私有镜像并在服务器上使用它。","date":"2024-10-21T11:24:26.000Z","updated":"2025-06-02T14:00:00.000Z","categories":["技术探索"],"tags":["Mix-Space","Docker"],"image":"https://mx-space.js.org/assets/images/preview/shiro.png","recommend":4,"readingTime":{"text":"9 min read","minutes":8.29,"time":497400,"words":1658},"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"前言"},"children":[{"type":"text","value":"前言"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Mix-Space 是一个前后端分离的博客系统，你可以将前端和后端分别部署在不同的位置。此前，你可以将前端部署在 Vercel 云函数上，以缓解服务器压力并提升访问速度。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"但随着 Vercel 调整 Hobby 免费套餐的额度，免费额度已越来越不够用。此时，我们可以通过 Docker 将 Shiro 部署到自己的服务器上来解决问题。然而，在使用 Shiroi（Shiro 的闭源捐赠版）时，我发现原作者 innei 并未提供可用的 Docker 镜像。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这意味着你需要在自己的服务器上构建 Shiroi，但对于配置较低（低于 2G 内存）的云服务器来说，这很困难，基本会导致服务器爆内存假死。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Innei 给出的解决方案是使用 Github Action 完成构建，并将构建产物直接推送到你的服务器上，从而减轻服务器压力。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"不过，这个方案在我看来有以下局限性："}]},{"type":"element","tag":"card-list","props":{},"children":[{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"需要在服务器安装相关依赖：Node.js、PM2、Sharp，但部分用户（比如我）使用的是 1Panel 管理服务器，不希望安装额外依赖"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"输出目录被固定在服务器的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"root"}]},{"type":"text","value":" 目录，不易更改"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"需要在 Github 仓库存储服务器登录信息，如 SSH 密钥等"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"项目本身有回滚功能，但一般用户可能不需要，也会占用大量服务器空间"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"总之，我并不想折腾这套方案。那么，有没有更好的办法？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"欸，你说 Docker 部署不就行了？虽然 Innei 没给 Docker 镜像，但我们可以自己造！"}]},{"type":"element","tag":"h2","props":{"id":"思路"},"children":[{"type":"text","value":"思路"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我们当然不能直接在自己的服务器上构建镜像，构建 Docker 镜像的资源占用并不会比直接构建站点静态文件少。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"那我们可以借鉴 innei 的思路，用 Github Action 进行 Docker 镜像构建，不就可以了吗？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"但仅仅构建还不够，还需要有地方存放镜像。我也不想用直接推送到服务器的办法，这同样需要在 Github 存储服务器登录信息。虽然用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"secret"}]},{"type":"text","value":" 存储理论上安全，但谁能保证呢？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"而且部分用户的服务器在国内，Github Action 主动推送的速度也未必理想。"}]},{"type":"element","tag":"h2","props":{"id":"选择"},"children":[{"type":"text","value":"选择"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最终，我选择用 Github Action 构建镜像，然后上传到 Github Packages。Github Packages 默认会对私有库镜像进行私有保护，保障镜像不会泄露。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Docker 对镜像仓库的管理分为 3 个层级：命名空间（namespace）、镜像仓库（repository）、标签（tag）："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"命名空间以名称为标识，一个命名空间可管理多个镜像仓库"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"镜像仓库通过名称标识，一个仓库可保存一个镜像的多个版本"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"镜像版本通过标签区分"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"基于以上层级关系，一个完整的镜像路径 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"{namespace}/{repository}:{tag}"}]},{"type":"text","value":" 可以唯一确定一个镜像。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"新建一个私有库，并在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".github/workflows"}]},{"type":"text","value":" 目录下新建 yml 工作流文件，填入如下内容："}]},{"type":"element","tag":"alert","props":{"type":"warning"},"children":[{"type":"element","tag":"template","props":{"v-slot:title":""},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"请注意新建的仓库权限，一定要为私有仓库！"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"若为公开仓库则所有人都可下载本镜像。"}]}]},{"type":"element","tag":"pre","props":{"className":"language-yaml shiki shiki-themes catppuccin-latte one-dark-pro","code":"name: Docker Build\n\non:\n  push:\n    branches:\n      - main\n  schedule:\n     - cron: '0 3 * * *'\n\n  repository_dispatch:\n    types: [trigger-workflow]\n\npermissions: write-all\nconcurrency:\n  group: ${{ github.workflow }}-${{ github.ref }}\n  cancel-in-progress: true\n\nenv:\n  PNPM_VERSION: 9.x.x\n  HASH_FILE: build_hash\n\njobs:\n  prepare:\n    name: Prepare\n    runs-on: ubuntu-latest\n    if: ${{ github.event.head_commit.message != 'Update hash file' }}\n\n    outputs:\n      hash_content: ${{ steps.read_hash.outputs.hash_content }}\n\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n      - name: Read HASH_FILE content\n        id: read_hash\n        run: |\n          content=$(cat ${{ env.HASH_FILE }}) || true\n          echo \"hash_content=$content\" >> \"$GITHUB_OUTPUT\"\n  check:\n    name: Check Should Rebuild\n    runs-on: ubuntu-latest\n    needs: prepare\n    outputs:\n      canceled: ${{ steps.use_content.outputs.canceled }}\n\n    steps:\n      - uses: actions/checkout@v4\n        with:\n          repository: innei-dev/shiroi\n          token: ${{ secrets.GH_PAT }}\n          fetch-depth: 0\n          lfs: true\n\n      - name: Use content from prev job and compare\n        id: use_content\n        env:\n          FILE_HASH: ${{ needs.prepare.outputs.hash_content }}\n        run: |\n          file_hash=$FILE_HASH\n          current_hash=$(git rev-parse --short HEAD)\n          echo \"File Hash: $file_hash\"\n          echo \"Current Git Hash: $current_hash\"\n          if [ \"$file_hash\" == \"$current_hash\" ]; then\n            echo \"Hashes match. Stopping workflow.\"\n            echo \"canceled=true\" >> $GITHUB_OUTPUT\n          else\n            echo \"Hashes do not match. Continuing workflow.\"\n          fi\n\n  build:\n    name: Build artifact\n    runs-on: ubuntu-latest\n    needs: check\n    if: ${{needs.check.outputs.canceled != 'true'}}\n\n    outputs:\n      sha_short: ${{ steps.store.outputs.sha_short }}\n      branch: ${{ steps.store.outputs.branch }}\n\n    steps:\n    - uses: actions/checkout@v4\n      with:\n        repository: innei-dev/shiroi\n        token: ${{ secrets.GH_PAT }}\n        fetch-depth: 0\n        lfs: true\n\n    - name: Login to Registry\n      uses: docker/login-action@v3\n      with:\n        registry: ghcr.io\n        username: ${{ github.actor }}\n        password: ${{ secrets.GITHUB_TOKEN }}\n\n    - name: Build Docker Image\n      run: |\n        docker build -t ghcr.io/${{ secrets.DOCKER_NAMESPACE }}/shiroi:latest .\n\n    - name: Push Docker Image to Github\n      run: |\n        docker push ghcr.io/${{ secrets.DOCKER_NAMESPACE }}/shiroi:latest\n\n    - name: Store artifact commit version\n      shell: bash\n      id: store\n      run: |\n        sha_short=$(git rev-parse --short HEAD)\n        branch_name=$(git rev-parse --abbrev-ref HEAD)\n        echo \"sha_short=$sha_short\" >> \"$GITHUB_OUTPUT\"\n        echo \"branch=$branch_name\" >> \"$GITHUB_OUTPUT\"\n  store:\n    name: Store artifact commit version\n    runs-on: ubuntu-latest\n    needs: [build]\n    steps:\n\n      - name: Checkout\n        uses: actions/checkout@v4\n        with:\n          persist-credentials: false\n          fetch-depth: 0\n\n      - name: Use outputs from build\n        env:\n          SHA_SHORT: ${{ needs.build.outputs.sha_short }}\n          BRANCH: ${{ needs.build.outputs.branch }}\n        run: |\n          echo \"SHA Short from build: $SHA_SHORT\"\n          echo \"Branch from build: $BRANCH\"\n\n      - name: Write hash to file\n        env:\n          SHA_SHORT: ${{ needs.build.outputs.sha_short }}\n\n        run: |\n          echo \"SHA_SHORT: $SHA_SHORT\"\n          echo $SHA_SHORT > ${{ env.HASH_FILE }}\n\n      - name: Commit files\n        run: |\n          git config --local user.email \"41898282+github-actions[bot]@users.noreply.github.com\"\n          git config --local user.name \"github-actions[bot]\"\n          git add ${{ env.HASH_FILE }}\n          git status\n          git commit -a -m \"Update hash file\"\n          \n      - name: Push changes\n        uses: ad-m/github-push-action@master\n        with:\n          github_token: ${{ secrets.GITHUB_TOKEN }}\n          branch: ${{ github.ref }}\n","language":"yaml","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Docker Build\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE640B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"  push"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    branches"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" main\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"  schedule"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"     -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" cron"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" '0 3 * * *'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"  repository_dispatch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    types"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":" ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"trigger-workflow"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"permissions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" write-all\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"concurrency"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"  group"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ github.workflow }}-${{ github.ref }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"  cancel-in-progress"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE640B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":" true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"  PNPM_VERSION"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" 9.x.x\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"  HASH_FILE"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" build_hash\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"jobs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"  prepare"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Prepare\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    runs-on"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ubuntu-latest\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ github.event.head_commit.message != 'Update hash file' }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    outputs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"      hash_content"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ steps.read_hash.outputs.hash_content }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    steps"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Checkout\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        uses"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" actions/checkout@v4\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Read HASH_FILE content\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        id"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" read_hash\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        run"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":" |\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          content=$(cat ${{ env.HASH_FILE }}) || true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          echo \"hash_content=$content\" >> \"$GITHUB_OUTPUT\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"  check"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Check Should Rebuild\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":41},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    runs-on"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ubuntu-latest\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":42},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    needs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" prepare\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":43},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    outputs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":44},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"      canceled"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ steps.use_content.outputs.canceled }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":45},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":46},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    steps"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":47},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" uses"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" actions/checkout@v4\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":48},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        with"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":49},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"          repository"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" innei-dev/shiroi\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":50},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"          token"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ secrets.GH_PAT }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":51},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"          fetch-depth"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE640B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":" 0\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":52},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"          lfs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE640B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":" true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":53},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":54},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Use content from prev job and compare\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":55},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        id"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" use_content\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":56},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":57},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"          FILE_HASH"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ needs.prepare.outputs.hash_content }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":58},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        run"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":" |\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":59},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          file_hash=$FILE_HASH\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":60},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          current_hash=$(git rev-parse --short HEAD)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":61},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          echo \"File Hash: $file_hash\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":62},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          echo \"Current Git Hash: $current_hash\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":63},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          if [ \"$file_hash\" == \"$current_hash\" ]; then\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":64},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"            echo \"Hashes match. Stopping workflow.\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":65},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"            echo \"canceled=true\" >> $GITHUB_OUTPUT\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":66},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          else\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":67},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"            echo \"Hashes do not match. Continuing workflow.\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":68},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          fi\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":69},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":70},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"  build"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":71},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Build artifact\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":72},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    runs-on"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ubuntu-latest\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":73},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    needs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" check\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":74},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{needs.check.outputs.canceled != 'true'}}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":75},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":76},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    outputs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":77},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"      sha_short"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ steps.store.outputs.sha_short }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":78},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"      branch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ steps.store.outputs.branch }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":79},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":80},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    steps"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":81},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"    -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" uses"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" actions/checkout@v4\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":82},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"      with"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":83},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        repository"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" innei-dev/shiroi\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":84},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        token"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ secrets.GH_PAT }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":85},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        fetch-depth"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE640B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":" 0\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":86},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        lfs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE640B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":" true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":87},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":88},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"    -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Login to Registry\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":89},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"      uses"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" docker/login-action@v3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":90},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"      with"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":91},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        registry"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ghcr.io\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":92},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        username"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ github.actor }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":93},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        password"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ secrets.GITHUB_TOKEN }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":94},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":95},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"    -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Build Docker Image\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":96},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"      run"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":" |\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":97},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"        docker build -t ghcr.io/${{ secrets.DOCKER_NAMESPACE }}/shiroi:latest .\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":98},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":99},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"    -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Push Docker Image to Github\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":100},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"      run"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":" |\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":101},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"        docker push ghcr.io/${{ secrets.DOCKER_NAMESPACE }}/shiroi:latest\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":102},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":103},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"    -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Store artifact commit version\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":104},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"      shell"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" bash\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":105},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"      id"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" store\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":106},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"      run"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":" |\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":107},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"        sha_short=$(git rev-parse --short HEAD)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":108},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"        branch_name=$(git rev-parse --abbrev-ref HEAD)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":109},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"        echo \"sha_short=$sha_short\" >> \"$GITHUB_OUTPUT\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":110},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"        echo \"branch=$branch_name\" >> \"$GITHUB_OUTPUT\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":111},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"  store"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":112},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Store artifact commit version\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":113},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    runs-on"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ubuntu-latest\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":114},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    needs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":" ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"build"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":115},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    steps"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":116},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":117},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Checkout\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":118},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        uses"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" actions/checkout@v4\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":119},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        with"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":120},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"          persist-credentials"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE640B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":" false\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":121},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"          fetch-depth"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE640B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":" 0\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":122},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":123},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Use outputs from build\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":124},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":125},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"          SHA_SHORT"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ needs.build.outputs.sha_short }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":126},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"          BRANCH"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ needs.build.outputs.branch }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":127},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        run"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":" |\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":128},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          echo \"SHA Short from build: $SHA_SHORT\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":129},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          echo \"Branch from build: $BRANCH\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":130},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":131},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Write hash to file\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":132},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":133},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"          SHA_SHORT"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ needs.build.outputs.sha_short }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":134},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":135},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        run"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":" |\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":136},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          echo \"SHA_SHORT: $SHA_SHORT\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":137},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          echo $SHA_SHORT > ${{ env.HASH_FILE }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":138},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":139},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Commit files\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":140},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        run"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":" |\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":141},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          git config --local user.email \"41898282+github-actions[bot]@users.noreply.github.com\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":142},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          git config --local user.name \"github-actions[bot]\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":143},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          git add ${{ env.HASH_FILE }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":144},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          git status\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":145},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          git commit -a -m \"Update hash file\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":146},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"          \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":147},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":" name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Push changes\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":148},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        uses"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ad-m/github-push-action@master\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":149},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"        with"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":150},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"          github_token"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ secrets.GITHUB_TOKEN }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":151},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"          branch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ${{ github.ref }}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这样就可以实现简单的构建并上传 Github Registry 镜像。你需要在仓库的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"secret"}]},{"type":"text","value":" 设置中配置以下机密变量："}]},{"type":"element","tag":"card-list","props":{},"children":[{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"GH_PAT"}]},{"type":"text","value":"：有权限访问 Shiroi 仓库的 Github Access Token"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"DOCKER_NAMESPACE"}]},{"type":"text","value":"：镜像命名空间，全部小写，建议用个人 Github 用户名"}]}]}]},{"type":"element","tag":"alert","props":{},"children":[{"type":"element","tag":"template","props":{"v-slot:title":""},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"注意！"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"由于 Github Action 的限制，仓库 3 个月无活动时，工作流会被禁用。\n@innei"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我们采用 innei 的办法，每次构建结束后上传一个存储哈希值的文件，保持仓库活跃。同时，构建前对仓库哈希值进行对比，避免重复构建。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"参考上述修改环境 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"secret"}]},{"type":"text","value":" 后，运行工作流（注意先开启仓库设置中 Github Action 写入文件的权限），即可生成哈希值文件并构建镜像。"}]},{"type":"element","tag":"h2","props":{"id":"使用"},"children":[{"type":"text","value":"使用"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"保存工作流文件，等待运行完毕后，你应该可以在仓库侧边栏的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Packages"}]},{"type":"text","value":" 或个人 Github 主页的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Package"}]},{"type":"text","value":" 里找到镜像文件。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在服务器上拉取镜像前，需要先配置 Docker 私有仓库。注意，Gitea 实例必须为 HTTPS 地址，否则 Docker 会拒绝拉取不安全的私有仓库。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在服务器上输入以下指令登录 Github Registry 私有仓库："}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes catppuccin-latte one-dark-pro","code":"docker login ghcr.io\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" login"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ghcr.io\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"输入账号和有访问权限的 Github Access Token，确认登录后即可拉取私有仓库镜像。如果你用的是 1Panel，可以在容器仓库设置中直接配置私有仓库。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"你也可以用如下 compose 文件配置安装 Shiroi："}]},{"type":"element","tag":"pre","props":{"className":"language-yaml shiki shiki-themes catppuccin-latte one-dark-pro","code":"services:\n  shiro:\n    container_name: Shiroi\n    image:\n    restart: always\n    environment:\n      - NEXT_SHARP_PATH=/usr/local/lib/node_modules/sharp\n      - NEXT_PUBLIC_API_URL=https://api.example.com/api/v2\n      - NEXT_PUBLIC_GATEWAY_URL=https://api.example.com\n    ports:\n      - 127.0.0.1:2323:2323\n    networks:\n      - mx-network\n","language":"yaml","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"services"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"  shiro"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    container_name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Shiroi\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    image"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    restart"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" always\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    environment"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" NEXT_SHARP_PATH=/usr/local/lib/node_modules/sharp\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" NEXT_PUBLIC_API_URL=https://api.example.com/api/v2\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" NEXT_PUBLIC_GATEWAY_URL=https://api.example.com\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    ports"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" 127.0.0.1:2323:2323\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"    networks"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" mx-network\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"image"}]},{"type":"text","value":" 填写你在软件包仓库看到的容器镜像信息。"}]},{"type":"element","tag":"h2","props":{"id":"后话"},"children":[{"type":"text","value":"后话"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这样你就算是简单完成了，本文本质上偏专业系，而非喂饭文。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如有疑问，欢迎在评论区提问或结合搜索引擎查阅本文。"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}"}]}],"toc":{"title":"","searchDepth":4,"depth":4,"links":[{"id":"前言","depth":2,"text":"前言"},{"id":"思路","depth":2,"text":"思路"},{"id":"选择","depth":2,"text":"选择"},{"id":"使用","depth":2,"text":"使用"},{"id":"后话","depth":2,"text":"后话"}]}},"_type":"markdown","_id":"content:posts:2024:10:shiroi-docker-deployment.md","_source":"content","_file":"posts/2024/10/shiroi-docker-deployment.md","_stem":"posts/2024/10/shiroi-docker-deployment","_extension":"md","_original_dir":"/posts"}