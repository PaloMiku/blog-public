[{"data":1,"prerenderedAt":2903},["ShallowReactive",2],{"/2024/10/shiroi-docker-deployment":3,"surround-/2024/10/shiroi-docker-deployment":2894},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"date":10,"updated":11,"categories":12,"tags":14,"image":17,"readingTime":18,"body":23,"_type":2887,"_id":2888,"_source":2889,"_file":2890,"_stem":2891,"_extension":2892,"_original_dir":2893},"/2024/10/shiroi-docker-deployment","10",false,"","GitHub Action 构建 Shiroi Docker 镜像","在本文了解如何通过 Github Action 构建 Shiroi Docker 私有镜像并在服务器上使用它。","2024-10-21T11:24:26.000Z","2025-06-02T14:00:00.000Z",[13],"技术探索",[15,16],"Mix-Space","Docker","https://mx-space.js.org/assets/images/preview/shiro.png",{"text":19,"minutes":20,"time":21,"words":22},"9 min read",8.45,507000,1690,{"type":24,"children":25,"toc":2880},"root",[26,34,40,45,50,55,60,97,102,107,112,117,122,135,140,145,150,155,173,186,199,218,2372,2384,2412,2428,2433,2445,2450,2471,2476,2481,2508,2513,2518,2691,2702,2859,2864,2869,2874],{"type":27,"tag":28,"props":29,"children":31},"element","h2",{"id":30},"前言",[32],{"type":33,"value":30},"text",{"type":27,"tag":35,"props":36,"children":37},"p",{},[38],{"type":33,"value":39},"Mix-Space 是一个前后端分离的博客系统，你可以将前端和后端分别部署在不同的位置。此前，你可以将前端部署在 Vercel 云函数上，以缓解服务器压力并提升访问速度。",{"type":27,"tag":35,"props":41,"children":42},{},[43],{"type":33,"value":44},"但随着 Vercel 调整 Hobby 免费套餐的额度，免费额度已越来越不够用。此时，我们可以通过 Docker 将 Shiro 部署到自己的服务器上来解决问题。然而，在使用 Shiroi（Shiro 的闭源捐赠版）时，我发现原作者 innei 并未提供可用的 Docker 镜像。",{"type":27,"tag":35,"props":46,"children":47},{},[48],{"type":33,"value":49},"这意味着你需要在自己的服务器上构建 Shiroi，但对于配置较低（低于 2G 内存）的云服务器来说，这很困难，基本会导致服务器爆内存假死。",{"type":27,"tag":35,"props":51,"children":52},{},[53],{"type":33,"value":54},"Innei 给出的解决方案是使用 Github Action 完成构建，并将构建产物直接推送到你的服务器上，从而减轻服务器压力。",{"type":27,"tag":35,"props":56,"children":57},{},[58],{"type":33,"value":59},"不过，这个方案在我看来有以下局限性：",{"type":27,"tag":61,"props":62,"children":63},"card-list",{},[64],{"type":27,"tag":65,"props":66,"children":67},"ul",{},[68,74,87,92],{"type":27,"tag":69,"props":70,"children":71},"li",{},[72],{"type":33,"value":73},"需要在服务器安装相关依赖：Node.js、PM2、Sharp，但部分用户（比如我）使用的是 1Panel 管理服务器，不希望安装额外依赖",{"type":27,"tag":69,"props":75,"children":76},{},[77,79,85],{"type":33,"value":78},"输出目录被固定在服务器的 ",{"type":27,"tag":80,"props":81,"children":83},"code",{"className":82},[],[84],{"type":33,"value":24},{"type":33,"value":86}," 目录，不易更改",{"type":27,"tag":69,"props":88,"children":89},{},[90],{"type":33,"value":91},"需要在 Github 仓库存储服务器登录信息，如 SSH 密钥等",{"type":27,"tag":69,"props":93,"children":94},{},[95],{"type":33,"value":96},"项目本身有回滚功能，但一般用户可能不需要，也会占用大量服务器空间",{"type":27,"tag":35,"props":98,"children":99},{},[100],{"type":33,"value":101},"总之，我并不想折腾这套方案。那么，有没有更好的办法？",{"type":27,"tag":35,"props":103,"children":104},{},[105],{"type":33,"value":106},"欸，你说 Docker 部署不就行了？虽然 Innei 没给 Docker 镜像，但我们可以自己造！",{"type":27,"tag":28,"props":108,"children":110},{"id":109},"思路",[111],{"type":33,"value":109},{"type":27,"tag":35,"props":113,"children":114},{},[115],{"type":33,"value":116},"我们当然不能直接在自己的服务器上构建镜像，构建 Docker 镜像的资源占用并不会比直接构建站点静态文件少。",{"type":27,"tag":35,"props":118,"children":119},{},[120],{"type":33,"value":121},"那我们可以借鉴 innei 的思路，用 Github Action 进行 Docker 镜像构建，不就可以了吗？",{"type":27,"tag":35,"props":123,"children":124},{},[125,127,133],{"type":33,"value":126},"但仅仅构建还不够，还需要有地方存放镜像。我也不想用直接推送到服务器的办法，这同样需要在 Github 存储服务器登录信息。虽然用 ",{"type":27,"tag":80,"props":128,"children":130},{"className":129},[],[131],{"type":33,"value":132},"secret",{"type":33,"value":134}," 存储理论上安全，但谁能保证呢？",{"type":27,"tag":35,"props":136,"children":137},{},[138],{"type":33,"value":139},"而且部分用户的服务器在国内，Github Action 主动推送的速度也未必理想。",{"type":27,"tag":28,"props":141,"children":143},{"id":142},"选择",[144],{"type":33,"value":142},{"type":27,"tag":35,"props":146,"children":147},{},[148],{"type":33,"value":149},"最终，我选择用 Github Action 构建镜像，然后上传到 Github Packages。Github Packages 默认会对私有库镜像进行私有保护，保障镜像不会泄露。",{"type":27,"tag":35,"props":151,"children":152},{},[153],{"type":33,"value":154},"Docker 对镜像仓库的管理分为 3 个层级：命名空间（namespace）、镜像仓库（repository）、标签（tag）：",{"type":27,"tag":65,"props":156,"children":157},{},[158,163,168],{"type":27,"tag":69,"props":159,"children":160},{},[161],{"type":33,"value":162},"命名空间以名称为标识，一个命名空间可管理多个镜像仓库",{"type":27,"tag":69,"props":164,"children":165},{},[166],{"type":33,"value":167},"镜像仓库通过名称标识，一个仓库可保存一个镜像的多个版本",{"type":27,"tag":69,"props":169,"children":170},{},[171],{"type":33,"value":172},"镜像版本通过标签区分",{"type":27,"tag":35,"props":174,"children":175},{},[176,178,184],{"type":33,"value":177},"基于以上层级关系，一个完整的镜像路径 ",{"type":27,"tag":80,"props":179,"children":181},{"className":180},[],[182],{"type":33,"value":183},"{namespace}/{repository}:{tag}",{"type":33,"value":185}," 可以唯一确定一个镜像。",{"type":27,"tag":35,"props":187,"children":188},{},[189,191,197],{"type":33,"value":190},"新建一个私有库，并在 ",{"type":27,"tag":80,"props":192,"children":194},{"className":193},[],[195],{"type":33,"value":196},".github/workflows",{"type":33,"value":198}," 目录下新建 yml 工作流文件，填入如下内容：",{"type":27,"tag":200,"props":201,"children":203},"alert",{"type":202},"warning",[204,213],{"type":27,"tag":205,"props":206,"children":207},"template",{"v-slot:title":7},[208],{"type":27,"tag":35,"props":209,"children":210},{},[211],{"type":33,"value":212},"请注意新建的仓库权限，一定要为私有仓库！",{"type":27,"tag":35,"props":214,"children":215},{},[216],{"type":33,"value":217},"若为公开仓库则所有人都可下载本镜像。",{"type":27,"tag":219,"props":220,"children":224},"pre",{"className":221,"code":222,"language":223,"meta":7,"style":7},"language-yaml shiki shiki-themes catppuccin-latte one-dark-pro","name: Docker Build\n\non:\n  push:\n    branches:\n      - main\n  schedule:\n     - cron: '0 3 * * *'\n\n  repository_dispatch:\n    types: [trigger-workflow]\n\npermissions: write-all\nconcurrency:\n  group: ${{ github.workflow }}-${{ github.ref }}\n  cancel-in-progress: true\n\nenv:\n  PNPM_VERSION: 9.x.x\n  HASH_FILE: build_hash\n\njobs:\n  prepare:\n    name: Prepare\n    runs-on: ubuntu-latest\n    if: ${{ github.event.head_commit.message != 'Update hash file' }}\n\n    outputs:\n      hash_content: ${{ steps.read_hash.outputs.hash_content }}\n\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n      - name: Read HASH_FILE content\n        id: read_hash\n        run: |\n          content=$(cat ${{ env.HASH_FILE }}) || true\n          echo \"hash_content=$content\" >> \"$GITHUB_OUTPUT\"\n  check:\n    name: Check Should Rebuild\n    runs-on: ubuntu-latest\n    needs: prepare\n    outputs:\n      canceled: ${{ steps.use_content.outputs.canceled }}\n\n    steps:\n      - uses: actions/checkout@v4\n        with:\n          repository: innei-dev/shiroi\n          token: ${{ secrets.GH_PAT }}\n          fetch-depth: 0\n          lfs: true\n\n      - name: Use content from prev job and compare\n        id: use_content\n        env:\n          FILE_HASH: ${{ needs.prepare.outputs.hash_content }}\n        run: |\n          file_hash=$FILE_HASH\n          current_hash=$(git rev-parse --short HEAD)\n          echo \"File Hash: $file_hash\"\n          echo \"Current Git Hash: $current_hash\"\n          if [ \"$file_hash\" == \"$current_hash\" ]; then\n            echo \"Hashes match. Stopping workflow.\"\n            echo \"canceled=true\" >> $GITHUB_OUTPUT\n          else\n            echo \"Hashes do not match. Continuing workflow.\"\n          fi\n\n  build:\n    name: Build artifact\n    runs-on: ubuntu-latest\n    needs: check\n    if: ${{needs.check.outputs.canceled != 'true'}}\n\n    outputs:\n      sha_short: ${{ steps.store.outputs.sha_short }}\n      branch: ${{ steps.store.outputs.branch }}\n\n    steps:\n    - uses: actions/checkout@v4\n      with:\n        repository: innei-dev/shiroi\n        token: ${{ secrets.GH_PAT }}\n        fetch-depth: 0\n        lfs: true\n\n    - name: Login to Registry\n      uses: docker/login-action@v3\n      with:\n        registry: ghcr.io\n        username: ${{ github.actor }}\n        password: ${{ secrets.GITHUB_TOKEN }}\n\n    - name: Build Docker Image\n      run: |\n        docker build -t ghcr.io/${{ secrets.DOCKER_NAMESPACE }}/shiroi:latest .\n\n    - name: Push Docker Image to Github\n      run: |\n        docker push ghcr.io/${{ secrets.DOCKER_NAMESPACE }}/shiroi:latest\n\n    - name: Store artifact commit version\n      shell: bash\n      id: store\n      run: |\n        sha_short=$(git rev-parse --short HEAD)\n        branch_name=$(git rev-parse --abbrev-ref HEAD)\n        echo \"sha_short=$sha_short\" >> \"$GITHUB_OUTPUT\"\n        echo \"branch=$branch_name\" >> \"$GITHUB_OUTPUT\"\n  store:\n    name: Store artifact commit version\n    runs-on: ubuntu-latest\n    needs: [build]\n    steps:\n\n      - name: Checkout\n        uses: actions/checkout@v4\n        with:\n          persist-credentials: false\n          fetch-depth: 0\n\n      - name: Use outputs from build\n        env:\n          SHA_SHORT: ${{ needs.build.outputs.sha_short }}\n          BRANCH: ${{ needs.build.outputs.branch }}\n        run: |\n          echo \"SHA Short from build: $SHA_SHORT\"\n          echo \"Branch from build: $BRANCH\"\n\n      - name: Write hash to file\n        env:\n          SHA_SHORT: ${{ needs.build.outputs.sha_short }}\n\n        run: |\n          echo \"SHA_SHORT: $SHA_SHORT\"\n          echo $SHA_SHORT > ${{ env.HASH_FILE }}\n\n      - name: Commit files\n        run: |\n          git config --local user.email \"41898282+github-actions[bot]@users.noreply.github.com\"\n          git config --local user.name \"github-actions[bot]\"\n          git add ${{ env.HASH_FILE }}\n          git status\n          git commit -a -m \"Update hash file\"\n          \n      - name: Push changes\n        uses: ad-m/github-push-action@master\n        with:\n          github_token: ${{ secrets.GITHUB_TOKEN }}\n          branch: ${{ github.ref }}\n","yaml",[225],{"type":27,"tag":80,"props":226,"children":227},{"__ignoreMap":7},[228,252,262,277,290,303,318,331,354,362,375,403,411,429,442,460,478,486,499,517,535,543,556,569,587,605,623,631,644,662,670,683,705,723,744,762,781,790,799,812,829,845,863,875,893,901,913,934,947,965,983,1001,1018,1026,1047,1064,1077,1095,1111,1120,1129,1138,1147,1156,1165,1174,1183,1192,1201,1209,1222,1239,1255,1272,1289,1297,1309,1327,1345,1353,1365,1386,1399,1416,1433,1450,1467,1475,1496,1514,1526,1544,1562,1580,1588,1609,1626,1635,1643,1664,1680,1689,1697,1718,1736,1754,1770,1779,1788,1797,1806,1819,1835,1851,1876,1888,1896,1916,1932,1944,1962,1978,1986,2007,2019,2037,2055,2071,2080,2089,2097,2118,2130,2146,2154,2170,2179,2188,2196,2217,2233,2242,2251,2260,2269,2278,2287,2308,2325,2337,2354],{"type":27,"tag":229,"props":230,"children":233},"span",{"class":231,"line":232},"line",1,[234,240,246],{"type":27,"tag":229,"props":235,"children":237},{"style":236},"--shiki-default:#1E66F5;--shiki-dark:#E06C75",[238],{"type":33,"value":239},"name",{"type":27,"tag":229,"props":241,"children":243},{"style":242},"--shiki-default:#179299;--shiki-dark:#ABB2BF",[244],{"type":33,"value":245},":",{"type":27,"tag":229,"props":247,"children":249},{"style":248},"--shiki-default:#40A02B;--shiki-dark:#98C379",[250],{"type":33,"value":251}," Docker Build\n",{"type":27,"tag":229,"props":253,"children":255},{"class":231,"line":254},2,[256],{"type":27,"tag":229,"props":257,"children":259},{"emptyLinePlaceholder":258},true,[260],{"type":33,"value":261},"\n",{"type":27,"tag":229,"props":263,"children":265},{"class":231,"line":264},3,[266,272],{"type":27,"tag":229,"props":267,"children":269},{"style":268},"--shiki-default:#FE640B;--shiki-dark:#D19A66",[270],{"type":33,"value":271},"on",{"type":27,"tag":229,"props":273,"children":274},{"style":242},[275],{"type":33,"value":276},":\n",{"type":27,"tag":229,"props":278,"children":280},{"class":231,"line":279},4,[281,286],{"type":27,"tag":229,"props":282,"children":283},{"style":236},[284],{"type":33,"value":285},"  push",{"type":27,"tag":229,"props":287,"children":288},{"style":242},[289],{"type":33,"value":276},{"type":27,"tag":229,"props":291,"children":293},{"class":231,"line":292},5,[294,299],{"type":27,"tag":229,"props":295,"children":296},{"style":236},[297],{"type":33,"value":298},"    branches",{"type":27,"tag":229,"props":300,"children":301},{"style":242},[302],{"type":33,"value":276},{"type":27,"tag":229,"props":304,"children":306},{"class":231,"line":305},6,[307,313],{"type":27,"tag":229,"props":308,"children":310},{"style":309},"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF",[311],{"type":33,"value":312},"      -",{"type":27,"tag":229,"props":314,"children":315},{"style":248},[316],{"type":33,"value":317}," main\n",{"type":27,"tag":229,"props":319,"children":321},{"class":231,"line":320},7,[322,327],{"type":27,"tag":229,"props":323,"children":324},{"style":236},[325],{"type":33,"value":326},"  schedule",{"type":27,"tag":229,"props":328,"children":329},{"style":242},[330],{"type":33,"value":276},{"type":27,"tag":229,"props":332,"children":334},{"class":231,"line":333},8,[335,340,345,349],{"type":27,"tag":229,"props":336,"children":337},{"style":309},[338],{"type":33,"value":339},"     -",{"type":27,"tag":229,"props":341,"children":342},{"style":236},[343],{"type":33,"value":344}," cron",{"type":27,"tag":229,"props":346,"children":347},{"style":242},[348],{"type":33,"value":245},{"type":27,"tag":229,"props":350,"children":351},{"style":248},[352],{"type":33,"value":353}," '0 3 * * *'\n",{"type":27,"tag":229,"props":355,"children":357},{"class":231,"line":356},9,[358],{"type":27,"tag":229,"props":359,"children":360},{"emptyLinePlaceholder":258},[361],{"type":33,"value":261},{"type":27,"tag":229,"props":363,"children":365},{"class":231,"line":364},10,[366,371],{"type":27,"tag":229,"props":367,"children":368},{"style":236},[369],{"type":33,"value":370},"  repository_dispatch",{"type":27,"tag":229,"props":372,"children":373},{"style":242},[374],{"type":33,"value":276},{"type":27,"tag":229,"props":376,"children":378},{"class":231,"line":377},11,[379,384,388,393,398],{"type":27,"tag":229,"props":380,"children":381},{"style":236},[382],{"type":33,"value":383},"    types",{"type":27,"tag":229,"props":385,"children":386},{"style":242},[387],{"type":33,"value":245},{"type":27,"tag":229,"props":389,"children":390},{"style":309},[391],{"type":33,"value":392}," [",{"type":27,"tag":229,"props":394,"children":395},{"style":248},[396],{"type":33,"value":397},"trigger-workflow",{"type":27,"tag":229,"props":399,"children":400},{"style":309},[401],{"type":33,"value":402},"]\n",{"type":27,"tag":229,"props":404,"children":406},{"class":231,"line":405},12,[407],{"type":27,"tag":229,"props":408,"children":409},{"emptyLinePlaceholder":258},[410],{"type":33,"value":261},{"type":27,"tag":229,"props":412,"children":414},{"class":231,"line":413},13,[415,420,424],{"type":27,"tag":229,"props":416,"children":417},{"style":236},[418],{"type":33,"value":419},"permissions",{"type":27,"tag":229,"props":421,"children":422},{"style":242},[423],{"type":33,"value":245},{"type":27,"tag":229,"props":425,"children":426},{"style":248},[427],{"type":33,"value":428}," write-all\n",{"type":27,"tag":229,"props":430,"children":432},{"class":231,"line":431},14,[433,438],{"type":27,"tag":229,"props":434,"children":435},{"style":236},[436],{"type":33,"value":437},"concurrency",{"type":27,"tag":229,"props":439,"children":440},{"style":242},[441],{"type":33,"value":276},{"type":27,"tag":229,"props":443,"children":445},{"class":231,"line":444},15,[446,451,455],{"type":27,"tag":229,"props":447,"children":448},{"style":236},[449],{"type":33,"value":450},"  group",{"type":27,"tag":229,"props":452,"children":453},{"style":242},[454],{"type":33,"value":245},{"type":27,"tag":229,"props":456,"children":457},{"style":248},[458],{"type":33,"value":459}," ${{ github.workflow }}-${{ github.ref }}\n",{"type":27,"tag":229,"props":461,"children":463},{"class":231,"line":462},16,[464,469,473],{"type":27,"tag":229,"props":465,"children":466},{"style":236},[467],{"type":33,"value":468},"  cancel-in-progress",{"type":27,"tag":229,"props":470,"children":471},{"style":242},[472],{"type":33,"value":245},{"type":27,"tag":229,"props":474,"children":475},{"style":268},[476],{"type":33,"value":477}," true\n",{"type":27,"tag":229,"props":479,"children":481},{"class":231,"line":480},17,[482],{"type":27,"tag":229,"props":483,"children":484},{"emptyLinePlaceholder":258},[485],{"type":33,"value":261},{"type":27,"tag":229,"props":487,"children":489},{"class":231,"line":488},18,[490,495],{"type":27,"tag":229,"props":491,"children":492},{"style":236},[493],{"type":33,"value":494},"env",{"type":27,"tag":229,"props":496,"children":497},{"style":242},[498],{"type":33,"value":276},{"type":27,"tag":229,"props":500,"children":502},{"class":231,"line":501},19,[503,508,512],{"type":27,"tag":229,"props":504,"children":505},{"style":236},[506],{"type":33,"value":507},"  PNPM_VERSION",{"type":27,"tag":229,"props":509,"children":510},{"style":242},[511],{"type":33,"value":245},{"type":27,"tag":229,"props":513,"children":514},{"style":248},[515],{"type":33,"value":516}," 9.x.x\n",{"type":27,"tag":229,"props":518,"children":520},{"class":231,"line":519},20,[521,526,530],{"type":27,"tag":229,"props":522,"children":523},{"style":236},[524],{"type":33,"value":525},"  HASH_FILE",{"type":27,"tag":229,"props":527,"children":528},{"style":242},[529],{"type":33,"value":245},{"type":27,"tag":229,"props":531,"children":532},{"style":248},[533],{"type":33,"value":534}," build_hash\n",{"type":27,"tag":229,"props":536,"children":538},{"class":231,"line":537},21,[539],{"type":27,"tag":229,"props":540,"children":541},{"emptyLinePlaceholder":258},[542],{"type":33,"value":261},{"type":27,"tag":229,"props":544,"children":546},{"class":231,"line":545},22,[547,552],{"type":27,"tag":229,"props":548,"children":549},{"style":236},[550],{"type":33,"value":551},"jobs",{"type":27,"tag":229,"props":553,"children":554},{"style":242},[555],{"type":33,"value":276},{"type":27,"tag":229,"props":557,"children":559},{"class":231,"line":558},23,[560,565],{"type":27,"tag":229,"props":561,"children":562},{"style":236},[563],{"type":33,"value":564},"  prepare",{"type":27,"tag":229,"props":566,"children":567},{"style":242},[568],{"type":33,"value":276},{"type":27,"tag":229,"props":570,"children":572},{"class":231,"line":571},24,[573,578,582],{"type":27,"tag":229,"props":574,"children":575},{"style":236},[576],{"type":33,"value":577},"    name",{"type":27,"tag":229,"props":579,"children":580},{"style":242},[581],{"type":33,"value":245},{"type":27,"tag":229,"props":583,"children":584},{"style":248},[585],{"type":33,"value":586}," Prepare\n",{"type":27,"tag":229,"props":588,"children":590},{"class":231,"line":589},25,[591,596,600],{"type":27,"tag":229,"props":592,"children":593},{"style":236},[594],{"type":33,"value":595},"    runs-on",{"type":27,"tag":229,"props":597,"children":598},{"style":242},[599],{"type":33,"value":245},{"type":27,"tag":229,"props":601,"children":602},{"style":248},[603],{"type":33,"value":604}," ubuntu-latest\n",{"type":27,"tag":229,"props":606,"children":608},{"class":231,"line":607},26,[609,614,618],{"type":27,"tag":229,"props":610,"children":611},{"style":236},[612],{"type":33,"value":613},"    if",{"type":27,"tag":229,"props":615,"children":616},{"style":242},[617],{"type":33,"value":245},{"type":27,"tag":229,"props":619,"children":620},{"style":248},[621],{"type":33,"value":622}," ${{ github.event.head_commit.message != 'Update hash file' }}\n",{"type":27,"tag":229,"props":624,"children":626},{"class":231,"line":625},27,[627],{"type":27,"tag":229,"props":628,"children":629},{"emptyLinePlaceholder":258},[630],{"type":33,"value":261},{"type":27,"tag":229,"props":632,"children":634},{"class":231,"line":633},28,[635,640],{"type":27,"tag":229,"props":636,"children":637},{"style":236},[638],{"type":33,"value":639},"    outputs",{"type":27,"tag":229,"props":641,"children":642},{"style":242},[643],{"type":33,"value":276},{"type":27,"tag":229,"props":645,"children":647},{"class":231,"line":646},29,[648,653,657],{"type":27,"tag":229,"props":649,"children":650},{"style":236},[651],{"type":33,"value":652},"      hash_content",{"type":27,"tag":229,"props":654,"children":655},{"style":242},[656],{"type":33,"value":245},{"type":27,"tag":229,"props":658,"children":659},{"style":248},[660],{"type":33,"value":661}," ${{ steps.read_hash.outputs.hash_content }}\n",{"type":27,"tag":229,"props":663,"children":665},{"class":231,"line":664},30,[666],{"type":27,"tag":229,"props":667,"children":668},{"emptyLinePlaceholder":258},[669],{"type":33,"value":261},{"type":27,"tag":229,"props":671,"children":673},{"class":231,"line":672},31,[674,679],{"type":27,"tag":229,"props":675,"children":676},{"style":236},[677],{"type":33,"value":678},"    steps",{"type":27,"tag":229,"props":680,"children":681},{"style":242},[682],{"type":33,"value":276},{"type":27,"tag":229,"props":684,"children":686},{"class":231,"line":685},32,[687,691,696,700],{"type":27,"tag":229,"props":688,"children":689},{"style":309},[690],{"type":33,"value":312},{"type":27,"tag":229,"props":692,"children":693},{"style":236},[694],{"type":33,"value":695}," name",{"type":27,"tag":229,"props":697,"children":698},{"style":242},[699],{"type":33,"value":245},{"type":27,"tag":229,"props":701,"children":702},{"style":248},[703],{"type":33,"value":704}," Checkout\n",{"type":27,"tag":229,"props":706,"children":708},{"class":231,"line":707},33,[709,714,718],{"type":27,"tag":229,"props":710,"children":711},{"style":236},[712],{"type":33,"value":713},"        uses",{"type":27,"tag":229,"props":715,"children":716},{"style":242},[717],{"type":33,"value":245},{"type":27,"tag":229,"props":719,"children":720},{"style":248},[721],{"type":33,"value":722}," actions/checkout@v4\n",{"type":27,"tag":229,"props":724,"children":726},{"class":231,"line":725},34,[727,731,735,739],{"type":27,"tag":229,"props":728,"children":729},{"style":309},[730],{"type":33,"value":312},{"type":27,"tag":229,"props":732,"children":733},{"style":236},[734],{"type":33,"value":695},{"type":27,"tag":229,"props":736,"children":737},{"style":242},[738],{"type":33,"value":245},{"type":27,"tag":229,"props":740,"children":741},{"style":248},[742],{"type":33,"value":743}," Read HASH_FILE content\n",{"type":27,"tag":229,"props":745,"children":747},{"class":231,"line":746},35,[748,753,757],{"type":27,"tag":229,"props":749,"children":750},{"style":236},[751],{"type":33,"value":752},"        id",{"type":27,"tag":229,"props":754,"children":755},{"style":242},[756],{"type":33,"value":245},{"type":27,"tag":229,"props":758,"children":759},{"style":248},[760],{"type":33,"value":761}," read_hash\n",{"type":27,"tag":229,"props":763,"children":765},{"class":231,"line":764},36,[766,771,775],{"type":27,"tag":229,"props":767,"children":768},{"style":236},[769],{"type":33,"value":770},"        run",{"type":27,"tag":229,"props":772,"children":773},{"style":242},[774],{"type":33,"value":245},{"type":27,"tag":229,"props":776,"children":778},{"style":777},"--shiki-default:#8839EF;--shiki-dark:#C678DD",[779],{"type":33,"value":780}," |\n",{"type":27,"tag":229,"props":782,"children":784},{"class":231,"line":783},37,[785],{"type":27,"tag":229,"props":786,"children":787},{"style":248},[788],{"type":33,"value":789},"          content=$(cat ${{ env.HASH_FILE }}) || true\n",{"type":27,"tag":229,"props":791,"children":793},{"class":231,"line":792},38,[794],{"type":27,"tag":229,"props":795,"children":796},{"style":248},[797],{"type":33,"value":798},"          echo \"hash_content=$content\" >> \"$GITHUB_OUTPUT\"\n",{"type":27,"tag":229,"props":800,"children":802},{"class":231,"line":801},39,[803,808],{"type":27,"tag":229,"props":804,"children":805},{"style":236},[806],{"type":33,"value":807},"  check",{"type":27,"tag":229,"props":809,"children":810},{"style":242},[811],{"type":33,"value":276},{"type":27,"tag":229,"props":813,"children":815},{"class":231,"line":814},40,[816,820,824],{"type":27,"tag":229,"props":817,"children":818},{"style":236},[819],{"type":33,"value":577},{"type":27,"tag":229,"props":821,"children":822},{"style":242},[823],{"type":33,"value":245},{"type":27,"tag":229,"props":825,"children":826},{"style":248},[827],{"type":33,"value":828}," Check Should Rebuild\n",{"type":27,"tag":229,"props":830,"children":832},{"class":231,"line":831},41,[833,837,841],{"type":27,"tag":229,"props":834,"children":835},{"style":236},[836],{"type":33,"value":595},{"type":27,"tag":229,"props":838,"children":839},{"style":242},[840],{"type":33,"value":245},{"type":27,"tag":229,"props":842,"children":843},{"style":248},[844],{"type":33,"value":604},{"type":27,"tag":229,"props":846,"children":848},{"class":231,"line":847},42,[849,854,858],{"type":27,"tag":229,"props":850,"children":851},{"style":236},[852],{"type":33,"value":853},"    needs",{"type":27,"tag":229,"props":855,"children":856},{"style":242},[857],{"type":33,"value":245},{"type":27,"tag":229,"props":859,"children":860},{"style":248},[861],{"type":33,"value":862}," prepare\n",{"type":27,"tag":229,"props":864,"children":866},{"class":231,"line":865},43,[867,871],{"type":27,"tag":229,"props":868,"children":869},{"style":236},[870],{"type":33,"value":639},{"type":27,"tag":229,"props":872,"children":873},{"style":242},[874],{"type":33,"value":276},{"type":27,"tag":229,"props":876,"children":878},{"class":231,"line":877},44,[879,884,888],{"type":27,"tag":229,"props":880,"children":881},{"style":236},[882],{"type":33,"value":883},"      canceled",{"type":27,"tag":229,"props":885,"children":886},{"style":242},[887],{"type":33,"value":245},{"type":27,"tag":229,"props":889,"children":890},{"style":248},[891],{"type":33,"value":892}," ${{ steps.use_content.outputs.canceled }}\n",{"type":27,"tag":229,"props":894,"children":896},{"class":231,"line":895},45,[897],{"type":27,"tag":229,"props":898,"children":899},{"emptyLinePlaceholder":258},[900],{"type":33,"value":261},{"type":27,"tag":229,"props":902,"children":904},{"class":231,"line":903},46,[905,909],{"type":27,"tag":229,"props":906,"children":907},{"style":236},[908],{"type":33,"value":678},{"type":27,"tag":229,"props":910,"children":911},{"style":242},[912],{"type":33,"value":276},{"type":27,"tag":229,"props":914,"children":916},{"class":231,"line":915},47,[917,921,926,930],{"type":27,"tag":229,"props":918,"children":919},{"style":309},[920],{"type":33,"value":312},{"type":27,"tag":229,"props":922,"children":923},{"style":236},[924],{"type":33,"value":925}," uses",{"type":27,"tag":229,"props":927,"children":928},{"style":242},[929],{"type":33,"value":245},{"type":27,"tag":229,"props":931,"children":932},{"style":248},[933],{"type":33,"value":722},{"type":27,"tag":229,"props":935,"children":937},{"class":231,"line":936},48,[938,943],{"type":27,"tag":229,"props":939,"children":940},{"style":236},[941],{"type":33,"value":942},"        with",{"type":27,"tag":229,"props":944,"children":945},{"style":242},[946],{"type":33,"value":276},{"type":27,"tag":229,"props":948,"children":950},{"class":231,"line":949},49,[951,956,960],{"type":27,"tag":229,"props":952,"children":953},{"style":236},[954],{"type":33,"value":955},"          repository",{"type":27,"tag":229,"props":957,"children":958},{"style":242},[959],{"type":33,"value":245},{"type":27,"tag":229,"props":961,"children":962},{"style":248},[963],{"type":33,"value":964}," innei-dev/shiroi\n",{"type":27,"tag":229,"props":966,"children":968},{"class":231,"line":967},50,[969,974,978],{"type":27,"tag":229,"props":970,"children":971},{"style":236},[972],{"type":33,"value":973},"          token",{"type":27,"tag":229,"props":975,"children":976},{"style":242},[977],{"type":33,"value":245},{"type":27,"tag":229,"props":979,"children":980},{"style":248},[981],{"type":33,"value":982}," ${{ secrets.GH_PAT }}\n",{"type":27,"tag":229,"props":984,"children":986},{"class":231,"line":985},51,[987,992,996],{"type":27,"tag":229,"props":988,"children":989},{"style":236},[990],{"type":33,"value":991},"          fetch-depth",{"type":27,"tag":229,"props":993,"children":994},{"style":242},[995],{"type":33,"value":245},{"type":27,"tag":229,"props":997,"children":998},{"style":268},[999],{"type":33,"value":1000}," 0\n",{"type":27,"tag":229,"props":1002,"children":1004},{"class":231,"line":1003},52,[1005,1010,1014],{"type":27,"tag":229,"props":1006,"children":1007},{"style":236},[1008],{"type":33,"value":1009},"          lfs",{"type":27,"tag":229,"props":1011,"children":1012},{"style":242},[1013],{"type":33,"value":245},{"type":27,"tag":229,"props":1015,"children":1016},{"style":268},[1017],{"type":33,"value":477},{"type":27,"tag":229,"props":1019,"children":1021},{"class":231,"line":1020},53,[1022],{"type":27,"tag":229,"props":1023,"children":1024},{"emptyLinePlaceholder":258},[1025],{"type":33,"value":261},{"type":27,"tag":229,"props":1027,"children":1029},{"class":231,"line":1028},54,[1030,1034,1038,1042],{"type":27,"tag":229,"props":1031,"children":1032},{"style":309},[1033],{"type":33,"value":312},{"type":27,"tag":229,"props":1035,"children":1036},{"style":236},[1037],{"type":33,"value":695},{"type":27,"tag":229,"props":1039,"children":1040},{"style":242},[1041],{"type":33,"value":245},{"type":27,"tag":229,"props":1043,"children":1044},{"style":248},[1045],{"type":33,"value":1046}," Use content from prev job and compare\n",{"type":27,"tag":229,"props":1048,"children":1050},{"class":231,"line":1049},55,[1051,1055,1059],{"type":27,"tag":229,"props":1052,"children":1053},{"style":236},[1054],{"type":33,"value":752},{"type":27,"tag":229,"props":1056,"children":1057},{"style":242},[1058],{"type":33,"value":245},{"type":27,"tag":229,"props":1060,"children":1061},{"style":248},[1062],{"type":33,"value":1063}," use_content\n",{"type":27,"tag":229,"props":1065,"children":1067},{"class":231,"line":1066},56,[1068,1073],{"type":27,"tag":229,"props":1069,"children":1070},{"style":236},[1071],{"type":33,"value":1072},"        env",{"type":27,"tag":229,"props":1074,"children":1075},{"style":242},[1076],{"type":33,"value":276},{"type":27,"tag":229,"props":1078,"children":1080},{"class":231,"line":1079},57,[1081,1086,1090],{"type":27,"tag":229,"props":1082,"children":1083},{"style":236},[1084],{"type":33,"value":1085},"          FILE_HASH",{"type":27,"tag":229,"props":1087,"children":1088},{"style":242},[1089],{"type":33,"value":245},{"type":27,"tag":229,"props":1091,"children":1092},{"style":248},[1093],{"type":33,"value":1094}," ${{ needs.prepare.outputs.hash_content }}\n",{"type":27,"tag":229,"props":1096,"children":1098},{"class":231,"line":1097},58,[1099,1103,1107],{"type":27,"tag":229,"props":1100,"children":1101},{"style":236},[1102],{"type":33,"value":770},{"type":27,"tag":229,"props":1104,"children":1105},{"style":242},[1106],{"type":33,"value":245},{"type":27,"tag":229,"props":1108,"children":1109},{"style":777},[1110],{"type":33,"value":780},{"type":27,"tag":229,"props":1112,"children":1114},{"class":231,"line":1113},59,[1115],{"type":27,"tag":229,"props":1116,"children":1117},{"style":248},[1118],{"type":33,"value":1119},"          file_hash=$FILE_HASH\n",{"type":27,"tag":229,"props":1121,"children":1123},{"class":231,"line":1122},60,[1124],{"type":27,"tag":229,"props":1125,"children":1126},{"style":248},[1127],{"type":33,"value":1128},"          current_hash=$(git rev-parse --short HEAD)\n",{"type":27,"tag":229,"props":1130,"children":1132},{"class":231,"line":1131},61,[1133],{"type":27,"tag":229,"props":1134,"children":1135},{"style":248},[1136],{"type":33,"value":1137},"          echo \"File Hash: $file_hash\"\n",{"type":27,"tag":229,"props":1139,"children":1141},{"class":231,"line":1140},62,[1142],{"type":27,"tag":229,"props":1143,"children":1144},{"style":248},[1145],{"type":33,"value":1146},"          echo \"Current Git Hash: $current_hash\"\n",{"type":27,"tag":229,"props":1148,"children":1150},{"class":231,"line":1149},63,[1151],{"type":27,"tag":229,"props":1152,"children":1153},{"style":248},[1154],{"type":33,"value":1155},"          if [ \"$file_hash\" == \"$current_hash\" ]; then\n",{"type":27,"tag":229,"props":1157,"children":1159},{"class":231,"line":1158},64,[1160],{"type":27,"tag":229,"props":1161,"children":1162},{"style":248},[1163],{"type":33,"value":1164},"            echo \"Hashes match. Stopping workflow.\"\n",{"type":27,"tag":229,"props":1166,"children":1168},{"class":231,"line":1167},65,[1169],{"type":27,"tag":229,"props":1170,"children":1171},{"style":248},[1172],{"type":33,"value":1173},"            echo \"canceled=true\" >> $GITHUB_OUTPUT\n",{"type":27,"tag":229,"props":1175,"children":1177},{"class":231,"line":1176},66,[1178],{"type":27,"tag":229,"props":1179,"children":1180},{"style":248},[1181],{"type":33,"value":1182},"          else\n",{"type":27,"tag":229,"props":1184,"children":1186},{"class":231,"line":1185},67,[1187],{"type":27,"tag":229,"props":1188,"children":1189},{"style":248},[1190],{"type":33,"value":1191},"            echo \"Hashes do not match. Continuing workflow.\"\n",{"type":27,"tag":229,"props":1193,"children":1195},{"class":231,"line":1194},68,[1196],{"type":27,"tag":229,"props":1197,"children":1198},{"style":248},[1199],{"type":33,"value":1200},"          fi\n",{"type":27,"tag":229,"props":1202,"children":1204},{"class":231,"line":1203},69,[1205],{"type":27,"tag":229,"props":1206,"children":1207},{"emptyLinePlaceholder":258},[1208],{"type":33,"value":261},{"type":27,"tag":229,"props":1210,"children":1212},{"class":231,"line":1211},70,[1213,1218],{"type":27,"tag":229,"props":1214,"children":1215},{"style":236},[1216],{"type":33,"value":1217},"  build",{"type":27,"tag":229,"props":1219,"children":1220},{"style":242},[1221],{"type":33,"value":276},{"type":27,"tag":229,"props":1223,"children":1225},{"class":231,"line":1224},71,[1226,1230,1234],{"type":27,"tag":229,"props":1227,"children":1228},{"style":236},[1229],{"type":33,"value":577},{"type":27,"tag":229,"props":1231,"children":1232},{"style":242},[1233],{"type":33,"value":245},{"type":27,"tag":229,"props":1235,"children":1236},{"style":248},[1237],{"type":33,"value":1238}," Build artifact\n",{"type":27,"tag":229,"props":1240,"children":1242},{"class":231,"line":1241},72,[1243,1247,1251],{"type":27,"tag":229,"props":1244,"children":1245},{"style":236},[1246],{"type":33,"value":595},{"type":27,"tag":229,"props":1248,"children":1249},{"style":242},[1250],{"type":33,"value":245},{"type":27,"tag":229,"props":1252,"children":1253},{"style":248},[1254],{"type":33,"value":604},{"type":27,"tag":229,"props":1256,"children":1258},{"class":231,"line":1257},73,[1259,1263,1267],{"type":27,"tag":229,"props":1260,"children":1261},{"style":236},[1262],{"type":33,"value":853},{"type":27,"tag":229,"props":1264,"children":1265},{"style":242},[1266],{"type":33,"value":245},{"type":27,"tag":229,"props":1268,"children":1269},{"style":248},[1270],{"type":33,"value":1271}," check\n",{"type":27,"tag":229,"props":1273,"children":1275},{"class":231,"line":1274},74,[1276,1280,1284],{"type":27,"tag":229,"props":1277,"children":1278},{"style":236},[1279],{"type":33,"value":613},{"type":27,"tag":229,"props":1281,"children":1282},{"style":242},[1283],{"type":33,"value":245},{"type":27,"tag":229,"props":1285,"children":1286},{"style":248},[1287],{"type":33,"value":1288}," ${{needs.check.outputs.canceled != 'true'}}\n",{"type":27,"tag":229,"props":1290,"children":1292},{"class":231,"line":1291},75,[1293],{"type":27,"tag":229,"props":1294,"children":1295},{"emptyLinePlaceholder":258},[1296],{"type":33,"value":261},{"type":27,"tag":229,"props":1298,"children":1300},{"class":231,"line":1299},76,[1301,1305],{"type":27,"tag":229,"props":1302,"children":1303},{"style":236},[1304],{"type":33,"value":639},{"type":27,"tag":229,"props":1306,"children":1307},{"style":242},[1308],{"type":33,"value":276},{"type":27,"tag":229,"props":1310,"children":1312},{"class":231,"line":1311},77,[1313,1318,1322],{"type":27,"tag":229,"props":1314,"children":1315},{"style":236},[1316],{"type":33,"value":1317},"      sha_short",{"type":27,"tag":229,"props":1319,"children":1320},{"style":242},[1321],{"type":33,"value":245},{"type":27,"tag":229,"props":1323,"children":1324},{"style":248},[1325],{"type":33,"value":1326}," ${{ steps.store.outputs.sha_short }}\n",{"type":27,"tag":229,"props":1328,"children":1330},{"class":231,"line":1329},78,[1331,1336,1340],{"type":27,"tag":229,"props":1332,"children":1333},{"style":236},[1334],{"type":33,"value":1335},"      branch",{"type":27,"tag":229,"props":1337,"children":1338},{"style":242},[1339],{"type":33,"value":245},{"type":27,"tag":229,"props":1341,"children":1342},{"style":248},[1343],{"type":33,"value":1344}," ${{ steps.store.outputs.branch }}\n",{"type":27,"tag":229,"props":1346,"children":1348},{"class":231,"line":1347},79,[1349],{"type":27,"tag":229,"props":1350,"children":1351},{"emptyLinePlaceholder":258},[1352],{"type":33,"value":261},{"type":27,"tag":229,"props":1354,"children":1356},{"class":231,"line":1355},80,[1357,1361],{"type":27,"tag":229,"props":1358,"children":1359},{"style":236},[1360],{"type":33,"value":678},{"type":27,"tag":229,"props":1362,"children":1363},{"style":242},[1364],{"type":33,"value":276},{"type":27,"tag":229,"props":1366,"children":1368},{"class":231,"line":1367},81,[1369,1374,1378,1382],{"type":27,"tag":229,"props":1370,"children":1371},{"style":309},[1372],{"type":33,"value":1373},"    -",{"type":27,"tag":229,"props":1375,"children":1376},{"style":236},[1377],{"type":33,"value":925},{"type":27,"tag":229,"props":1379,"children":1380},{"style":242},[1381],{"type":33,"value":245},{"type":27,"tag":229,"props":1383,"children":1384},{"style":248},[1385],{"type":33,"value":722},{"type":27,"tag":229,"props":1387,"children":1389},{"class":231,"line":1388},82,[1390,1395],{"type":27,"tag":229,"props":1391,"children":1392},{"style":236},[1393],{"type":33,"value":1394},"      with",{"type":27,"tag":229,"props":1396,"children":1397},{"style":242},[1398],{"type":33,"value":276},{"type":27,"tag":229,"props":1400,"children":1402},{"class":231,"line":1401},83,[1403,1408,1412],{"type":27,"tag":229,"props":1404,"children":1405},{"style":236},[1406],{"type":33,"value":1407},"        repository",{"type":27,"tag":229,"props":1409,"children":1410},{"style":242},[1411],{"type":33,"value":245},{"type":27,"tag":229,"props":1413,"children":1414},{"style":248},[1415],{"type":33,"value":964},{"type":27,"tag":229,"props":1417,"children":1419},{"class":231,"line":1418},84,[1420,1425,1429],{"type":27,"tag":229,"props":1421,"children":1422},{"style":236},[1423],{"type":33,"value":1424},"        token",{"type":27,"tag":229,"props":1426,"children":1427},{"style":242},[1428],{"type":33,"value":245},{"type":27,"tag":229,"props":1430,"children":1431},{"style":248},[1432],{"type":33,"value":982},{"type":27,"tag":229,"props":1434,"children":1436},{"class":231,"line":1435},85,[1437,1442,1446],{"type":27,"tag":229,"props":1438,"children":1439},{"style":236},[1440],{"type":33,"value":1441},"        fetch-depth",{"type":27,"tag":229,"props":1443,"children":1444},{"style":242},[1445],{"type":33,"value":245},{"type":27,"tag":229,"props":1447,"children":1448},{"style":268},[1449],{"type":33,"value":1000},{"type":27,"tag":229,"props":1451,"children":1453},{"class":231,"line":1452},86,[1454,1459,1463],{"type":27,"tag":229,"props":1455,"children":1456},{"style":236},[1457],{"type":33,"value":1458},"        lfs",{"type":27,"tag":229,"props":1460,"children":1461},{"style":242},[1462],{"type":33,"value":245},{"type":27,"tag":229,"props":1464,"children":1465},{"style":268},[1466],{"type":33,"value":477},{"type":27,"tag":229,"props":1468,"children":1470},{"class":231,"line":1469},87,[1471],{"type":27,"tag":229,"props":1472,"children":1473},{"emptyLinePlaceholder":258},[1474],{"type":33,"value":261},{"type":27,"tag":229,"props":1476,"children":1478},{"class":231,"line":1477},88,[1479,1483,1487,1491],{"type":27,"tag":229,"props":1480,"children":1481},{"style":309},[1482],{"type":33,"value":1373},{"type":27,"tag":229,"props":1484,"children":1485},{"style":236},[1486],{"type":33,"value":695},{"type":27,"tag":229,"props":1488,"children":1489},{"style":242},[1490],{"type":33,"value":245},{"type":27,"tag":229,"props":1492,"children":1493},{"style":248},[1494],{"type":33,"value":1495}," Login to Registry\n",{"type":27,"tag":229,"props":1497,"children":1499},{"class":231,"line":1498},89,[1500,1505,1509],{"type":27,"tag":229,"props":1501,"children":1502},{"style":236},[1503],{"type":33,"value":1504},"      uses",{"type":27,"tag":229,"props":1506,"children":1507},{"style":242},[1508],{"type":33,"value":245},{"type":27,"tag":229,"props":1510,"children":1511},{"style":248},[1512],{"type":33,"value":1513}," docker/login-action@v3\n",{"type":27,"tag":229,"props":1515,"children":1517},{"class":231,"line":1516},90,[1518,1522],{"type":27,"tag":229,"props":1519,"children":1520},{"style":236},[1521],{"type":33,"value":1394},{"type":27,"tag":229,"props":1523,"children":1524},{"style":242},[1525],{"type":33,"value":276},{"type":27,"tag":229,"props":1527,"children":1529},{"class":231,"line":1528},91,[1530,1535,1539],{"type":27,"tag":229,"props":1531,"children":1532},{"style":236},[1533],{"type":33,"value":1534},"        registry",{"type":27,"tag":229,"props":1536,"children":1537},{"style":242},[1538],{"type":33,"value":245},{"type":27,"tag":229,"props":1540,"children":1541},{"style":248},[1542],{"type":33,"value":1543}," ghcr.io\n",{"type":27,"tag":229,"props":1545,"children":1547},{"class":231,"line":1546},92,[1548,1553,1557],{"type":27,"tag":229,"props":1549,"children":1550},{"style":236},[1551],{"type":33,"value":1552},"        username",{"type":27,"tag":229,"props":1554,"children":1555},{"style":242},[1556],{"type":33,"value":245},{"type":27,"tag":229,"props":1558,"children":1559},{"style":248},[1560],{"type":33,"value":1561}," ${{ github.actor }}\n",{"type":27,"tag":229,"props":1563,"children":1565},{"class":231,"line":1564},93,[1566,1571,1575],{"type":27,"tag":229,"props":1567,"children":1568},{"style":236},[1569],{"type":33,"value":1570},"        password",{"type":27,"tag":229,"props":1572,"children":1573},{"style":242},[1574],{"type":33,"value":245},{"type":27,"tag":229,"props":1576,"children":1577},{"style":248},[1578],{"type":33,"value":1579}," ${{ secrets.GITHUB_TOKEN }}\n",{"type":27,"tag":229,"props":1581,"children":1583},{"class":231,"line":1582},94,[1584],{"type":27,"tag":229,"props":1585,"children":1586},{"emptyLinePlaceholder":258},[1587],{"type":33,"value":261},{"type":27,"tag":229,"props":1589,"children":1591},{"class":231,"line":1590},95,[1592,1596,1600,1604],{"type":27,"tag":229,"props":1593,"children":1594},{"style":309},[1595],{"type":33,"value":1373},{"type":27,"tag":229,"props":1597,"children":1598},{"style":236},[1599],{"type":33,"value":695},{"type":27,"tag":229,"props":1601,"children":1602},{"style":242},[1603],{"type":33,"value":245},{"type":27,"tag":229,"props":1605,"children":1606},{"style":248},[1607],{"type":33,"value":1608}," Build Docker Image\n",{"type":27,"tag":229,"props":1610,"children":1612},{"class":231,"line":1611},96,[1613,1618,1622],{"type":27,"tag":229,"props":1614,"children":1615},{"style":236},[1616],{"type":33,"value":1617},"      run",{"type":27,"tag":229,"props":1619,"children":1620},{"style":242},[1621],{"type":33,"value":245},{"type":27,"tag":229,"props":1623,"children":1624},{"style":777},[1625],{"type":33,"value":780},{"type":27,"tag":229,"props":1627,"children":1629},{"class":231,"line":1628},97,[1630],{"type":27,"tag":229,"props":1631,"children":1632},{"style":248},[1633],{"type":33,"value":1634},"        docker build -t ghcr.io/${{ secrets.DOCKER_NAMESPACE }}/shiroi:latest .\n",{"type":27,"tag":229,"props":1636,"children":1638},{"class":231,"line":1637},98,[1639],{"type":27,"tag":229,"props":1640,"children":1641},{"emptyLinePlaceholder":258},[1642],{"type":33,"value":261},{"type":27,"tag":229,"props":1644,"children":1646},{"class":231,"line":1645},99,[1647,1651,1655,1659],{"type":27,"tag":229,"props":1648,"children":1649},{"style":309},[1650],{"type":33,"value":1373},{"type":27,"tag":229,"props":1652,"children":1653},{"style":236},[1654],{"type":33,"value":695},{"type":27,"tag":229,"props":1656,"children":1657},{"style":242},[1658],{"type":33,"value":245},{"type":27,"tag":229,"props":1660,"children":1661},{"style":248},[1662],{"type":33,"value":1663}," Push Docker Image to Github\n",{"type":27,"tag":229,"props":1665,"children":1667},{"class":231,"line":1666},100,[1668,1672,1676],{"type":27,"tag":229,"props":1669,"children":1670},{"style":236},[1671],{"type":33,"value":1617},{"type":27,"tag":229,"props":1673,"children":1674},{"style":242},[1675],{"type":33,"value":245},{"type":27,"tag":229,"props":1677,"children":1678},{"style":777},[1679],{"type":33,"value":780},{"type":27,"tag":229,"props":1681,"children":1683},{"class":231,"line":1682},101,[1684],{"type":27,"tag":229,"props":1685,"children":1686},{"style":248},[1687],{"type":33,"value":1688},"        docker push ghcr.io/${{ secrets.DOCKER_NAMESPACE }}/shiroi:latest\n",{"type":27,"tag":229,"props":1690,"children":1692},{"class":231,"line":1691},102,[1693],{"type":27,"tag":229,"props":1694,"children":1695},{"emptyLinePlaceholder":258},[1696],{"type":33,"value":261},{"type":27,"tag":229,"props":1698,"children":1700},{"class":231,"line":1699},103,[1701,1705,1709,1713],{"type":27,"tag":229,"props":1702,"children":1703},{"style":309},[1704],{"type":33,"value":1373},{"type":27,"tag":229,"props":1706,"children":1707},{"style":236},[1708],{"type":33,"value":695},{"type":27,"tag":229,"props":1710,"children":1711},{"style":242},[1712],{"type":33,"value":245},{"type":27,"tag":229,"props":1714,"children":1715},{"style":248},[1716],{"type":33,"value":1717}," Store artifact commit version\n",{"type":27,"tag":229,"props":1719,"children":1721},{"class":231,"line":1720},104,[1722,1727,1731],{"type":27,"tag":229,"props":1723,"children":1724},{"style":236},[1725],{"type":33,"value":1726},"      shell",{"type":27,"tag":229,"props":1728,"children":1729},{"style":242},[1730],{"type":33,"value":245},{"type":27,"tag":229,"props":1732,"children":1733},{"style":248},[1734],{"type":33,"value":1735}," bash\n",{"type":27,"tag":229,"props":1737,"children":1739},{"class":231,"line":1738},105,[1740,1745,1749],{"type":27,"tag":229,"props":1741,"children":1742},{"style":236},[1743],{"type":33,"value":1744},"      id",{"type":27,"tag":229,"props":1746,"children":1747},{"style":242},[1748],{"type":33,"value":245},{"type":27,"tag":229,"props":1750,"children":1751},{"style":248},[1752],{"type":33,"value":1753}," store\n",{"type":27,"tag":229,"props":1755,"children":1757},{"class":231,"line":1756},106,[1758,1762,1766],{"type":27,"tag":229,"props":1759,"children":1760},{"style":236},[1761],{"type":33,"value":1617},{"type":27,"tag":229,"props":1763,"children":1764},{"style":242},[1765],{"type":33,"value":245},{"type":27,"tag":229,"props":1767,"children":1768},{"style":777},[1769],{"type":33,"value":780},{"type":27,"tag":229,"props":1771,"children":1773},{"class":231,"line":1772},107,[1774],{"type":27,"tag":229,"props":1775,"children":1776},{"style":248},[1777],{"type":33,"value":1778},"        sha_short=$(git rev-parse --short HEAD)\n",{"type":27,"tag":229,"props":1780,"children":1782},{"class":231,"line":1781},108,[1783],{"type":27,"tag":229,"props":1784,"children":1785},{"style":248},[1786],{"type":33,"value":1787},"        branch_name=$(git rev-parse --abbrev-ref HEAD)\n",{"type":27,"tag":229,"props":1789,"children":1791},{"class":231,"line":1790},109,[1792],{"type":27,"tag":229,"props":1793,"children":1794},{"style":248},[1795],{"type":33,"value":1796},"        echo \"sha_short=$sha_short\" >> \"$GITHUB_OUTPUT\"\n",{"type":27,"tag":229,"props":1798,"children":1800},{"class":231,"line":1799},110,[1801],{"type":27,"tag":229,"props":1802,"children":1803},{"style":248},[1804],{"type":33,"value":1805},"        echo \"branch=$branch_name\" >> \"$GITHUB_OUTPUT\"\n",{"type":27,"tag":229,"props":1807,"children":1809},{"class":231,"line":1808},111,[1810,1815],{"type":27,"tag":229,"props":1811,"children":1812},{"style":236},[1813],{"type":33,"value":1814},"  store",{"type":27,"tag":229,"props":1816,"children":1817},{"style":242},[1818],{"type":33,"value":276},{"type":27,"tag":229,"props":1820,"children":1822},{"class":231,"line":1821},112,[1823,1827,1831],{"type":27,"tag":229,"props":1824,"children":1825},{"style":236},[1826],{"type":33,"value":577},{"type":27,"tag":229,"props":1828,"children":1829},{"style":242},[1830],{"type":33,"value":245},{"type":27,"tag":229,"props":1832,"children":1833},{"style":248},[1834],{"type":33,"value":1717},{"type":27,"tag":229,"props":1836,"children":1838},{"class":231,"line":1837},113,[1839,1843,1847],{"type":27,"tag":229,"props":1840,"children":1841},{"style":236},[1842],{"type":33,"value":595},{"type":27,"tag":229,"props":1844,"children":1845},{"style":242},[1846],{"type":33,"value":245},{"type":27,"tag":229,"props":1848,"children":1849},{"style":248},[1850],{"type":33,"value":604},{"type":27,"tag":229,"props":1852,"children":1854},{"class":231,"line":1853},114,[1855,1859,1863,1867,1872],{"type":27,"tag":229,"props":1856,"children":1857},{"style":236},[1858],{"type":33,"value":853},{"type":27,"tag":229,"props":1860,"children":1861},{"style":242},[1862],{"type":33,"value":245},{"type":27,"tag":229,"props":1864,"children":1865},{"style":309},[1866],{"type":33,"value":392},{"type":27,"tag":229,"props":1868,"children":1869},{"style":248},[1870],{"type":33,"value":1871},"build",{"type":27,"tag":229,"props":1873,"children":1874},{"style":309},[1875],{"type":33,"value":402},{"type":27,"tag":229,"props":1877,"children":1879},{"class":231,"line":1878},115,[1880,1884],{"type":27,"tag":229,"props":1881,"children":1882},{"style":236},[1883],{"type":33,"value":678},{"type":27,"tag":229,"props":1885,"children":1886},{"style":242},[1887],{"type":33,"value":276},{"type":27,"tag":229,"props":1889,"children":1891},{"class":231,"line":1890},116,[1892],{"type":27,"tag":229,"props":1893,"children":1894},{"emptyLinePlaceholder":258},[1895],{"type":33,"value":261},{"type":27,"tag":229,"props":1897,"children":1899},{"class":231,"line":1898},117,[1900,1904,1908,1912],{"type":27,"tag":229,"props":1901,"children":1902},{"style":309},[1903],{"type":33,"value":312},{"type":27,"tag":229,"props":1905,"children":1906},{"style":236},[1907],{"type":33,"value":695},{"type":27,"tag":229,"props":1909,"children":1910},{"style":242},[1911],{"type":33,"value":245},{"type":27,"tag":229,"props":1913,"children":1914},{"style":248},[1915],{"type":33,"value":704},{"type":27,"tag":229,"props":1917,"children":1919},{"class":231,"line":1918},118,[1920,1924,1928],{"type":27,"tag":229,"props":1921,"children":1922},{"style":236},[1923],{"type":33,"value":713},{"type":27,"tag":229,"props":1925,"children":1926},{"style":242},[1927],{"type":33,"value":245},{"type":27,"tag":229,"props":1929,"children":1930},{"style":248},[1931],{"type":33,"value":722},{"type":27,"tag":229,"props":1933,"children":1935},{"class":231,"line":1934},119,[1936,1940],{"type":27,"tag":229,"props":1937,"children":1938},{"style":236},[1939],{"type":33,"value":942},{"type":27,"tag":229,"props":1941,"children":1942},{"style":242},[1943],{"type":33,"value":276},{"type":27,"tag":229,"props":1945,"children":1947},{"class":231,"line":1946},120,[1948,1953,1957],{"type":27,"tag":229,"props":1949,"children":1950},{"style":236},[1951],{"type":33,"value":1952},"          persist-credentials",{"type":27,"tag":229,"props":1954,"children":1955},{"style":242},[1956],{"type":33,"value":245},{"type":27,"tag":229,"props":1958,"children":1959},{"style":268},[1960],{"type":33,"value":1961}," false\n",{"type":27,"tag":229,"props":1963,"children":1965},{"class":231,"line":1964},121,[1966,1970,1974],{"type":27,"tag":229,"props":1967,"children":1968},{"style":236},[1969],{"type":33,"value":991},{"type":27,"tag":229,"props":1971,"children":1972},{"style":242},[1973],{"type":33,"value":245},{"type":27,"tag":229,"props":1975,"children":1976},{"style":268},[1977],{"type":33,"value":1000},{"type":27,"tag":229,"props":1979,"children":1981},{"class":231,"line":1980},122,[1982],{"type":27,"tag":229,"props":1983,"children":1984},{"emptyLinePlaceholder":258},[1985],{"type":33,"value":261},{"type":27,"tag":229,"props":1987,"children":1989},{"class":231,"line":1988},123,[1990,1994,1998,2002],{"type":27,"tag":229,"props":1991,"children":1992},{"style":309},[1993],{"type":33,"value":312},{"type":27,"tag":229,"props":1995,"children":1996},{"style":236},[1997],{"type":33,"value":695},{"type":27,"tag":229,"props":1999,"children":2000},{"style":242},[2001],{"type":33,"value":245},{"type":27,"tag":229,"props":2003,"children":2004},{"style":248},[2005],{"type":33,"value":2006}," Use outputs from build\n",{"type":27,"tag":229,"props":2008,"children":2010},{"class":231,"line":2009},124,[2011,2015],{"type":27,"tag":229,"props":2012,"children":2013},{"style":236},[2014],{"type":33,"value":1072},{"type":27,"tag":229,"props":2016,"children":2017},{"style":242},[2018],{"type":33,"value":276},{"type":27,"tag":229,"props":2020,"children":2022},{"class":231,"line":2021},125,[2023,2028,2032],{"type":27,"tag":229,"props":2024,"children":2025},{"style":236},[2026],{"type":33,"value":2027},"          SHA_SHORT",{"type":27,"tag":229,"props":2029,"children":2030},{"style":242},[2031],{"type":33,"value":245},{"type":27,"tag":229,"props":2033,"children":2034},{"style":248},[2035],{"type":33,"value":2036}," ${{ needs.build.outputs.sha_short }}\n",{"type":27,"tag":229,"props":2038,"children":2040},{"class":231,"line":2039},126,[2041,2046,2050],{"type":27,"tag":229,"props":2042,"children":2043},{"style":236},[2044],{"type":33,"value":2045},"          BRANCH",{"type":27,"tag":229,"props":2047,"children":2048},{"style":242},[2049],{"type":33,"value":245},{"type":27,"tag":229,"props":2051,"children":2052},{"style":248},[2053],{"type":33,"value":2054}," ${{ needs.build.outputs.branch }}\n",{"type":27,"tag":229,"props":2056,"children":2058},{"class":231,"line":2057},127,[2059,2063,2067],{"type":27,"tag":229,"props":2060,"children":2061},{"style":236},[2062],{"type":33,"value":770},{"type":27,"tag":229,"props":2064,"children":2065},{"style":242},[2066],{"type":33,"value":245},{"type":27,"tag":229,"props":2068,"children":2069},{"style":777},[2070],{"type":33,"value":780},{"type":27,"tag":229,"props":2072,"children":2074},{"class":231,"line":2073},128,[2075],{"type":27,"tag":229,"props":2076,"children":2077},{"style":248},[2078],{"type":33,"value":2079},"          echo \"SHA Short from build: $SHA_SHORT\"\n",{"type":27,"tag":229,"props":2081,"children":2083},{"class":231,"line":2082},129,[2084],{"type":27,"tag":229,"props":2085,"children":2086},{"style":248},[2087],{"type":33,"value":2088},"          echo \"Branch from build: $BRANCH\"\n",{"type":27,"tag":229,"props":2090,"children":2092},{"class":231,"line":2091},130,[2093],{"type":27,"tag":229,"props":2094,"children":2095},{"emptyLinePlaceholder":258},[2096],{"type":33,"value":261},{"type":27,"tag":229,"props":2098,"children":2100},{"class":231,"line":2099},131,[2101,2105,2109,2113],{"type":27,"tag":229,"props":2102,"children":2103},{"style":309},[2104],{"type":33,"value":312},{"type":27,"tag":229,"props":2106,"children":2107},{"style":236},[2108],{"type":33,"value":695},{"type":27,"tag":229,"props":2110,"children":2111},{"style":242},[2112],{"type":33,"value":245},{"type":27,"tag":229,"props":2114,"children":2115},{"style":248},[2116],{"type":33,"value":2117}," Write hash to file\n",{"type":27,"tag":229,"props":2119,"children":2121},{"class":231,"line":2120},132,[2122,2126],{"type":27,"tag":229,"props":2123,"children":2124},{"style":236},[2125],{"type":33,"value":1072},{"type":27,"tag":229,"props":2127,"children":2128},{"style":242},[2129],{"type":33,"value":276},{"type":27,"tag":229,"props":2131,"children":2133},{"class":231,"line":2132},133,[2134,2138,2142],{"type":27,"tag":229,"props":2135,"children":2136},{"style":236},[2137],{"type":33,"value":2027},{"type":27,"tag":229,"props":2139,"children":2140},{"style":242},[2141],{"type":33,"value":245},{"type":27,"tag":229,"props":2143,"children":2144},{"style":248},[2145],{"type":33,"value":2036},{"type":27,"tag":229,"props":2147,"children":2149},{"class":231,"line":2148},134,[2150],{"type":27,"tag":229,"props":2151,"children":2152},{"emptyLinePlaceholder":258},[2153],{"type":33,"value":261},{"type":27,"tag":229,"props":2155,"children":2157},{"class":231,"line":2156},135,[2158,2162,2166],{"type":27,"tag":229,"props":2159,"children":2160},{"style":236},[2161],{"type":33,"value":770},{"type":27,"tag":229,"props":2163,"children":2164},{"style":242},[2165],{"type":33,"value":245},{"type":27,"tag":229,"props":2167,"children":2168},{"style":777},[2169],{"type":33,"value":780},{"type":27,"tag":229,"props":2171,"children":2173},{"class":231,"line":2172},136,[2174],{"type":27,"tag":229,"props":2175,"children":2176},{"style":248},[2177],{"type":33,"value":2178},"          echo \"SHA_SHORT: $SHA_SHORT\"\n",{"type":27,"tag":229,"props":2180,"children":2182},{"class":231,"line":2181},137,[2183],{"type":27,"tag":229,"props":2184,"children":2185},{"style":248},[2186],{"type":33,"value":2187},"          echo $SHA_SHORT > ${{ env.HASH_FILE }}\n",{"type":27,"tag":229,"props":2189,"children":2191},{"class":231,"line":2190},138,[2192],{"type":27,"tag":229,"props":2193,"children":2194},{"emptyLinePlaceholder":258},[2195],{"type":33,"value":261},{"type":27,"tag":229,"props":2197,"children":2199},{"class":231,"line":2198},139,[2200,2204,2208,2212],{"type":27,"tag":229,"props":2201,"children":2202},{"style":309},[2203],{"type":33,"value":312},{"type":27,"tag":229,"props":2205,"children":2206},{"style":236},[2207],{"type":33,"value":695},{"type":27,"tag":229,"props":2209,"children":2210},{"style":242},[2211],{"type":33,"value":245},{"type":27,"tag":229,"props":2213,"children":2214},{"style":248},[2215],{"type":33,"value":2216}," Commit files\n",{"type":27,"tag":229,"props":2218,"children":2220},{"class":231,"line":2219},140,[2221,2225,2229],{"type":27,"tag":229,"props":2222,"children":2223},{"style":236},[2224],{"type":33,"value":770},{"type":27,"tag":229,"props":2226,"children":2227},{"style":242},[2228],{"type":33,"value":245},{"type":27,"tag":229,"props":2230,"children":2231},{"style":777},[2232],{"type":33,"value":780},{"type":27,"tag":229,"props":2234,"children":2236},{"class":231,"line":2235},141,[2237],{"type":27,"tag":229,"props":2238,"children":2239},{"style":248},[2240],{"type":33,"value":2241},"          git config --local user.email \"41898282+github-actions[bot]@users.noreply.github.com\"\n",{"type":27,"tag":229,"props":2243,"children":2245},{"class":231,"line":2244},142,[2246],{"type":27,"tag":229,"props":2247,"children":2248},{"style":248},[2249],{"type":33,"value":2250},"          git config --local user.name \"github-actions[bot]\"\n",{"type":27,"tag":229,"props":2252,"children":2254},{"class":231,"line":2253},143,[2255],{"type":27,"tag":229,"props":2256,"children":2257},{"style":248},[2258],{"type":33,"value":2259},"          git add ${{ env.HASH_FILE }}\n",{"type":27,"tag":229,"props":2261,"children":2263},{"class":231,"line":2262},144,[2264],{"type":27,"tag":229,"props":2265,"children":2266},{"style":248},[2267],{"type":33,"value":2268},"          git status\n",{"type":27,"tag":229,"props":2270,"children":2272},{"class":231,"line":2271},145,[2273],{"type":27,"tag":229,"props":2274,"children":2275},{"style":248},[2276],{"type":33,"value":2277},"          git commit -a -m \"Update hash file\"\n",{"type":27,"tag":229,"props":2279,"children":2281},{"class":231,"line":2280},146,[2282],{"type":27,"tag":229,"props":2283,"children":2284},{"style":248},[2285],{"type":33,"value":2286},"          \n",{"type":27,"tag":229,"props":2288,"children":2290},{"class":231,"line":2289},147,[2291,2295,2299,2303],{"type":27,"tag":229,"props":2292,"children":2293},{"style":309},[2294],{"type":33,"value":312},{"type":27,"tag":229,"props":2296,"children":2297},{"style":236},[2298],{"type":33,"value":695},{"type":27,"tag":229,"props":2300,"children":2301},{"style":242},[2302],{"type":33,"value":245},{"type":27,"tag":229,"props":2304,"children":2305},{"style":248},[2306],{"type":33,"value":2307}," Push changes\n",{"type":27,"tag":229,"props":2309,"children":2311},{"class":231,"line":2310},148,[2312,2316,2320],{"type":27,"tag":229,"props":2313,"children":2314},{"style":236},[2315],{"type":33,"value":713},{"type":27,"tag":229,"props":2317,"children":2318},{"style":242},[2319],{"type":33,"value":245},{"type":27,"tag":229,"props":2321,"children":2322},{"style":248},[2323],{"type":33,"value":2324}," ad-m/github-push-action@master\n",{"type":27,"tag":229,"props":2326,"children":2328},{"class":231,"line":2327},149,[2329,2333],{"type":27,"tag":229,"props":2330,"children":2331},{"style":236},[2332],{"type":33,"value":942},{"type":27,"tag":229,"props":2334,"children":2335},{"style":242},[2336],{"type":33,"value":276},{"type":27,"tag":229,"props":2338,"children":2340},{"class":231,"line":2339},150,[2341,2346,2350],{"type":27,"tag":229,"props":2342,"children":2343},{"style":236},[2344],{"type":33,"value":2345},"          github_token",{"type":27,"tag":229,"props":2347,"children":2348},{"style":242},[2349],{"type":33,"value":245},{"type":27,"tag":229,"props":2351,"children":2352},{"style":248},[2353],{"type":33,"value":1579},{"type":27,"tag":229,"props":2355,"children":2357},{"class":231,"line":2356},151,[2358,2363,2367],{"type":27,"tag":229,"props":2359,"children":2360},{"style":236},[2361],{"type":33,"value":2362},"          branch",{"type":27,"tag":229,"props":2364,"children":2365},{"style":242},[2366],{"type":33,"value":245},{"type":27,"tag":229,"props":2368,"children":2369},{"style":248},[2370],{"type":33,"value":2371}," ${{ github.ref }}\n",{"type":27,"tag":35,"props":2373,"children":2374},{},[2375,2377,2382],{"type":33,"value":2376},"这样就可以实现简单的构建并上传 Github Registry 镜像。你需要在仓库的 ",{"type":27,"tag":80,"props":2378,"children":2380},{"className":2379},[],[2381],{"type":33,"value":132},{"type":33,"value":2383}," 设置中配置以下机密变量：",{"type":27,"tag":61,"props":2385,"children":2386},{},[2387],{"type":27,"tag":65,"props":2388,"children":2389},{},[2390,2401],{"type":27,"tag":69,"props":2391,"children":2392},{},[2393,2399],{"type":27,"tag":80,"props":2394,"children":2396},{"className":2395},[],[2397],{"type":33,"value":2398},"GH_PAT",{"type":33,"value":2400},"：有权限访问 Shiroi 仓库的 Github Access Token",{"type":27,"tag":69,"props":2402,"children":2403},{},[2404,2410],{"type":27,"tag":80,"props":2405,"children":2407},{"className":2406},[],[2408],{"type":33,"value":2409},"DOCKER_NAMESPACE",{"type":33,"value":2411},"：镜像命名空间，全部小写，建议用个人 Github 用户名",{"type":27,"tag":200,"props":2413,"children":2414},{},[2415,2423],{"type":27,"tag":205,"props":2416,"children":2417},{"v-slot:title":7},[2418],{"type":27,"tag":35,"props":2419,"children":2420},{},[2421],{"type":33,"value":2422},"注意！",{"type":27,"tag":35,"props":2424,"children":2425},{},[2426],{"type":33,"value":2427},"由于 Github Action 的限制，仓库 3 个月无活动时，工作流会被禁用。\n@innei",{"type":27,"tag":35,"props":2429,"children":2430},{},[2431],{"type":33,"value":2432},"我们采用 innei 的办法，每次构建结束后上传一个存储哈希值的文件，保持仓库活跃。同时，构建前对仓库哈希值进行对比，避免重复构建。",{"type":27,"tag":35,"props":2434,"children":2435},{},[2436,2438,2443],{"type":33,"value":2437},"参考上述修改环境 ",{"type":27,"tag":80,"props":2439,"children":2441},{"className":2440},[],[2442],{"type":33,"value":132},{"type":33,"value":2444}," 后，运行工作流（注意先开启仓库设置中 Github Action 写入文件的权限），即可生成哈希值文件并构建镜像。",{"type":27,"tag":28,"props":2446,"children":2448},{"id":2447},"使用",[2449],{"type":33,"value":2447},{"type":27,"tag":35,"props":2451,"children":2452},{},[2453,2455,2461,2463,2469],{"type":33,"value":2454},"保存工作流文件，等待运行完毕后，你应该可以在仓库侧边栏的 ",{"type":27,"tag":80,"props":2456,"children":2458},{"className":2457},[],[2459],{"type":33,"value":2460},"Packages",{"type":33,"value":2462}," 或个人 Github 主页的 ",{"type":27,"tag":80,"props":2464,"children":2466},{"className":2465},[],[2467],{"type":33,"value":2468},"Package",{"type":33,"value":2470}," 里找到镜像文件。",{"type":27,"tag":35,"props":2472,"children":2473},{},[2474],{"type":33,"value":2475},"在服务器上拉取镜像前，需要先配置 Docker 私有仓库。注意，Gitea 实例必须为 HTTPS 地址，否则 Docker 会拒绝拉取不安全的私有仓库。",{"type":27,"tag":35,"props":2477,"children":2478},{},[2479],{"type":33,"value":2480},"在服务器上输入以下指令登录 Github Registry 私有仓库：",{"type":27,"tag":219,"props":2482,"children":2486},{"className":2483,"code":2484,"language":2485,"meta":7,"style":7},"language-bash shiki shiki-themes catppuccin-latte one-dark-pro","docker login ghcr.io\n","bash",[2487],{"type":27,"tag":80,"props":2488,"children":2489},{"__ignoreMap":7},[2490],{"type":27,"tag":229,"props":2491,"children":2492},{"class":231,"line":232},[2493,2499,2504],{"type":27,"tag":229,"props":2494,"children":2496},{"style":2495},"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit",[2497],{"type":33,"value":2498},"docker",{"type":27,"tag":229,"props":2500,"children":2501},{"style":248},[2502],{"type":33,"value":2503}," login",{"type":27,"tag":229,"props":2505,"children":2506},{"style":248},[2507],{"type":33,"value":1543},{"type":27,"tag":35,"props":2509,"children":2510},{},[2511],{"type":33,"value":2512},"输入账号和有访问权限的 Github Access Token，确认登录后即可拉取私有仓库镜像。如果你用的是 1Panel，可以在容器仓库设置中直接配置私有仓库。",{"type":27,"tag":35,"props":2514,"children":2515},{},[2516],{"type":33,"value":2517},"你也可以用如下 compose 文件配置安装 Shiroi：",{"type":27,"tag":219,"props":2519,"children":2521},{"className":221,"code":2520,"language":223,"meta":7,"style":7},"services:\n  shiro:\n    container_name: Shiroi\n    image:\n    restart: always\n    environment:\n      - NEXT_SHARP_PATH=/usr/local/lib/node_modules/sharp\n      - NEXT_PUBLIC_API_URL=https://api.example.com/api/v2\n      - NEXT_PUBLIC_GATEWAY_URL=https://api.example.com\n    ports:\n      - 127.0.0.1:2323:2323\n    networks:\n      - mx-network\n",[2522],{"type":27,"tag":80,"props":2523,"children":2524},{"__ignoreMap":7},[2525,2537,2549,2566,2578,2595,2607,2619,2631,2643,2655,2667,2679],{"type":27,"tag":229,"props":2526,"children":2527},{"class":231,"line":232},[2528,2533],{"type":27,"tag":229,"props":2529,"children":2530},{"style":236},[2531],{"type":33,"value":2532},"services",{"type":27,"tag":229,"props":2534,"children":2535},{"style":242},[2536],{"type":33,"value":276},{"type":27,"tag":229,"props":2538,"children":2539},{"class":231,"line":254},[2540,2545],{"type":27,"tag":229,"props":2541,"children":2542},{"style":236},[2543],{"type":33,"value":2544},"  shiro",{"type":27,"tag":229,"props":2546,"children":2547},{"style":242},[2548],{"type":33,"value":276},{"type":27,"tag":229,"props":2550,"children":2551},{"class":231,"line":264},[2552,2557,2561],{"type":27,"tag":229,"props":2553,"children":2554},{"style":236},[2555],{"type":33,"value":2556},"    container_name",{"type":27,"tag":229,"props":2558,"children":2559},{"style":242},[2560],{"type":33,"value":245},{"type":27,"tag":229,"props":2562,"children":2563},{"style":248},[2564],{"type":33,"value":2565}," Shiroi\n",{"type":27,"tag":229,"props":2567,"children":2568},{"class":231,"line":279},[2569,2574],{"type":27,"tag":229,"props":2570,"children":2571},{"style":236},[2572],{"type":33,"value":2573},"    image",{"type":27,"tag":229,"props":2575,"children":2576},{"style":242},[2577],{"type":33,"value":276},{"type":27,"tag":229,"props":2579,"children":2580},{"class":231,"line":292},[2581,2586,2590],{"type":27,"tag":229,"props":2582,"children":2583},{"style":236},[2584],{"type":33,"value":2585},"    restart",{"type":27,"tag":229,"props":2587,"children":2588},{"style":242},[2589],{"type":33,"value":245},{"type":27,"tag":229,"props":2591,"children":2592},{"style":248},[2593],{"type":33,"value":2594}," always\n",{"type":27,"tag":229,"props":2596,"children":2597},{"class":231,"line":305},[2598,2603],{"type":27,"tag":229,"props":2599,"children":2600},{"style":236},[2601],{"type":33,"value":2602},"    environment",{"type":27,"tag":229,"props":2604,"children":2605},{"style":242},[2606],{"type":33,"value":276},{"type":27,"tag":229,"props":2608,"children":2609},{"class":231,"line":320},[2610,2614],{"type":27,"tag":229,"props":2611,"children":2612},{"style":309},[2613],{"type":33,"value":312},{"type":27,"tag":229,"props":2615,"children":2616},{"style":248},[2617],{"type":33,"value":2618}," NEXT_SHARP_PATH=/usr/local/lib/node_modules/sharp\n",{"type":27,"tag":229,"props":2620,"children":2621},{"class":231,"line":333},[2622,2626],{"type":27,"tag":229,"props":2623,"children":2624},{"style":309},[2625],{"type":33,"value":312},{"type":27,"tag":229,"props":2627,"children":2628},{"style":248},[2629],{"type":33,"value":2630}," NEXT_PUBLIC_API_URL=https://api.example.com/api/v2\n",{"type":27,"tag":229,"props":2632,"children":2633},{"class":231,"line":356},[2634,2638],{"type":27,"tag":229,"props":2635,"children":2636},{"style":309},[2637],{"type":33,"value":312},{"type":27,"tag":229,"props":2639,"children":2640},{"style":248},[2641],{"type":33,"value":2642}," NEXT_PUBLIC_GATEWAY_URL=https://api.example.com\n",{"type":27,"tag":229,"props":2644,"children":2645},{"class":231,"line":364},[2646,2651],{"type":27,"tag":229,"props":2647,"children":2648},{"style":236},[2649],{"type":33,"value":2650},"    ports",{"type":27,"tag":229,"props":2652,"children":2653},{"style":242},[2654],{"type":33,"value":276},{"type":27,"tag":229,"props":2656,"children":2657},{"class":231,"line":377},[2658,2662],{"type":27,"tag":229,"props":2659,"children":2660},{"style":309},[2661],{"type":33,"value":312},{"type":27,"tag":229,"props":2663,"children":2664},{"style":248},[2665],{"type":33,"value":2666}," 127.0.0.1:2323:2323\n",{"type":27,"tag":229,"props":2668,"children":2669},{"class":231,"line":405},[2670,2675],{"type":27,"tag":229,"props":2671,"children":2672},{"style":236},[2673],{"type":33,"value":2674},"    networks",{"type":27,"tag":229,"props":2676,"children":2677},{"style":242},[2678],{"type":33,"value":276},{"type":27,"tag":229,"props":2680,"children":2681},{"class":231,"line":413},[2682,2686],{"type":27,"tag":229,"props":2683,"children":2684},{"style":309},[2685],{"type":33,"value":312},{"type":27,"tag":229,"props":2687,"children":2688},{"style":248},[2689],{"type":33,"value":2690}," mx-network\n",{"type":27,"tag":35,"props":2692,"children":2693},{},[2694,2700],{"type":27,"tag":80,"props":2695,"children":2697},{"className":2696},[],[2698],{"type":33,"value":2699},"image",{"type":33,"value":2701}," 填写你在软件包仓库看到的容器镜像信息。常规部署也可以用下面这个：",{"type":27,"tag":219,"props":2703,"children":2704},{"className":221,"code":2520,"language":223,"meta":7,"style":7},[2705],{"type":27,"tag":80,"props":2706,"children":2707},{"__ignoreMap":7},[2708,2719,2730,2745,2756,2771,2782,2793,2804,2815,2826,2837,2848],{"type":27,"tag":229,"props":2709,"children":2710},{"class":231,"line":232},[2711,2715],{"type":27,"tag":229,"props":2712,"children":2713},{"style":236},[2714],{"type":33,"value":2532},{"type":27,"tag":229,"props":2716,"children":2717},{"style":242},[2718],{"type":33,"value":276},{"type":27,"tag":229,"props":2720,"children":2721},{"class":231,"line":254},[2722,2726],{"type":27,"tag":229,"props":2723,"children":2724},{"style":236},[2725],{"type":33,"value":2544},{"type":27,"tag":229,"props":2727,"children":2728},{"style":242},[2729],{"type":33,"value":276},{"type":27,"tag":229,"props":2731,"children":2732},{"class":231,"line":264},[2733,2737,2741],{"type":27,"tag":229,"props":2734,"children":2735},{"style":236},[2736],{"type":33,"value":2556},{"type":27,"tag":229,"props":2738,"children":2739},{"style":242},[2740],{"type":33,"value":245},{"type":27,"tag":229,"props":2742,"children":2743},{"style":248},[2744],{"type":33,"value":2565},{"type":27,"tag":229,"props":2746,"children":2747},{"class":231,"line":279},[2748,2752],{"type":27,"tag":229,"props":2749,"children":2750},{"style":236},[2751],{"type":33,"value":2573},{"type":27,"tag":229,"props":2753,"children":2754},{"style":242},[2755],{"type":33,"value":276},{"type":27,"tag":229,"props":2757,"children":2758},{"class":231,"line":292},[2759,2763,2767],{"type":27,"tag":229,"props":2760,"children":2761},{"style":236},[2762],{"type":33,"value":2585},{"type":27,"tag":229,"props":2764,"children":2765},{"style":242},[2766],{"type":33,"value":245},{"type":27,"tag":229,"props":2768,"children":2769},{"style":248},[2770],{"type":33,"value":2594},{"type":27,"tag":229,"props":2772,"children":2773},{"class":231,"line":305},[2774,2778],{"type":27,"tag":229,"props":2775,"children":2776},{"style":236},[2777],{"type":33,"value":2602},{"type":27,"tag":229,"props":2779,"children":2780},{"style":242},[2781],{"type":33,"value":276},{"type":27,"tag":229,"props":2783,"children":2784},{"class":231,"line":320},[2785,2789],{"type":27,"tag":229,"props":2786,"children":2787},{"style":309},[2788],{"type":33,"value":312},{"type":27,"tag":229,"props":2790,"children":2791},{"style":248},[2792],{"type":33,"value":2618},{"type":27,"tag":229,"props":2794,"children":2795},{"class":231,"line":333},[2796,2800],{"type":27,"tag":229,"props":2797,"children":2798},{"style":309},[2799],{"type":33,"value":312},{"type":27,"tag":229,"props":2801,"children":2802},{"style":248},[2803],{"type":33,"value":2630},{"type":27,"tag":229,"props":2805,"children":2806},{"class":231,"line":356},[2807,2811],{"type":27,"tag":229,"props":2808,"children":2809},{"style":309},[2810],{"type":33,"value":312},{"type":27,"tag":229,"props":2812,"children":2813},{"style":248},[2814],{"type":33,"value":2642},{"type":27,"tag":229,"props":2816,"children":2817},{"class":231,"line":364},[2818,2822],{"type":27,"tag":229,"props":2819,"children":2820},{"style":236},[2821],{"type":33,"value":2650},{"type":27,"tag":229,"props":2823,"children":2824},{"style":242},[2825],{"type":33,"value":276},{"type":27,"tag":229,"props":2827,"children":2828},{"class":231,"line":377},[2829,2833],{"type":27,"tag":229,"props":2830,"children":2831},{"style":309},[2832],{"type":33,"value":312},{"type":27,"tag":229,"props":2834,"children":2835},{"style":248},[2836],{"type":33,"value":2666},{"type":27,"tag":229,"props":2838,"children":2839},{"class":231,"line":405},[2840,2844],{"type":27,"tag":229,"props":2841,"children":2842},{"style":236},[2843],{"type":33,"value":2674},{"type":27,"tag":229,"props":2845,"children":2846},{"style":242},[2847],{"type":33,"value":276},{"type":27,"tag":229,"props":2849,"children":2850},{"class":231,"line":413},[2851,2855],{"type":27,"tag":229,"props":2852,"children":2853},{"style":309},[2854],{"type":33,"value":312},{"type":27,"tag":229,"props":2856,"children":2857},{"style":248},[2858],{"type":33,"value":2690},{"type":27,"tag":28,"props":2860,"children":2862},{"id":2861},"后话",[2863],{"type":33,"value":2861},{"type":27,"tag":35,"props":2865,"children":2866},{},[2867],{"type":33,"value":2868},"这样你就算是简单完成了，本文本质上偏专业系，而非喂饭文。",{"type":27,"tag":35,"props":2870,"children":2871},{},[2872],{"type":33,"value":2873},"如有疑问，欢迎在评论区提问或结合搜索引擎查阅本文。",{"type":27,"tag":2875,"props":2876,"children":2877},"style",{},[2878],{"type":33,"value":2879},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":7,"searchDepth":279,"depth":279,"links":2881},[2882,2883,2884,2885,2886],{"id":30,"depth":254,"text":30},{"id":109,"depth":254,"text":109},{"id":142,"depth":254,"text":142},{"id":2447,"depth":254,"text":2447},{"id":2861,"depth":254,"text":2861},"markdown","content:posts:2024:10:shiroi-docker-deployment.md","content","posts/2024/10/shiroi-docker-deployment.md","posts/2024/10/shiroi-docker-deployment","md","/posts",[2895,2899],{"_path":2896,"title":2897,"date":2898},"/2024/10/write-1panel-app","编写1Panel应用商店第三方程序","2024-10-17T11:24:26.000Z",{"_path":2900,"title":2901,"date":2902},"/2024/12/break-change-2024","破坏型迁移：站点反复横跳与稳定工作","2024-12-07T10:24:26.000Z",1748876689388]